/* src/App.css
   ΦNet — Atlantean Banking Console Shell
   v26.0.1 — PERFORMANCE-HARDENED (same look, less paint, zero mount lag)

   ✅ Guarantees preserved:
   - App stays app-locked (no document scroll).
   - MAIN panel body scrolls only when needed; otherwise centered.
   - Mobile safe-areas respected (iOS/Android dynamic bars).
   - Explorer (ΦStream) + KaiKlok portals are true full-screen overlays.
   - Eternal KaiKlok close “X” always clickable (z-index + stacking fix).
   - Klock stage centers the clock MASSIVE (true hero square).
   - kk-pop matches Atlantean glass + breath.

   ⚡ Performance upgrades:
   - Removes breathing animations that tween filter/box-shadow (paint-heavy).
   - Moves “breath” to transform/opacity on pseudo-elements (compositor-friendly).
   - Mobile/Safari throttles: reduces blur + disables orbit spin on small screens if needed.
*/

/* ────────────────────────────────────────────────────────────────
   0) Tokens (Atlantean palette + security-grade UI)
   ─────────────────────────────────────────────────────────────── */

:root {
  color-scheme: dark;

  /* Core depths */
  --bg-0: #02030a;
  --bg-1: #03091b;
  --bg-2: #040f24;

  /* Accents */
  --accent-cyan: #33f6ff;
  --accent-teal: #26ffc4;
  --accent-violet: #9b5bff;
  --accent-gold: #ffd979;

  /* Semantic */
  --good: #26ffc4;
  --warn: #ffd979;
  --bad: #ff4d8d;

  /* Text */
  --text-main: #f5f7ff;
  --text-subtle: #c3c7e6;
  --text-dim: rgba(245, 247, 255, 0.72);

  /* Frame */
  --frame-border: rgba(176, 255, 247, 0.48);
  --frame-bg: rgba(6, 14, 35, 0.85);
  --frame-inner-bg: rgba(3, 8, 24, 0.96);

  /* Lines / surfaces */
  --line-soft: rgba(255, 255, 255, 0.06);
  --line-med: rgba(255, 255, 255, 0.1);
  --glass-0: rgba(10, 20, 48, 0.55);
  --glass-1: rgba(6, 14, 35, 0.72);
  --glass-2: rgba(3, 8, 24, 0.9);

  /* Shadows / halos */
  --shadow-soft: 0 0 40px rgba(0, 0, 0, 0.65);
  --shadow-halo: 0 0 120px rgba(51, 246, 255, 0.3);
  --shadow-hard: 0 24px 80px rgba(0, 0, 0, 0.7);

  /* Radii */
  --radius-xl: 32px;
  --radius-lg: 24px;
  --radius-md: 16px;
  --radius-sm: 12px;

  /* Blur */
  --blur-strong: 26px;
  --blur-soft: 18px;

  /* Motion (Breath) */
  --breath: 5.236s; /* golden breath cadence */
  --breath-s: var(--breath);
  --transition-fast: 180ms ease-out;
  --transition-med: 260ms ease-out;

  /* Layout */
  --topbar-h: 76px;
  --ring: 0 0 0 3px rgba(51, 246, 255, 0.24),
    0 0 0 1px rgba(255, 255, 255, 0.12) inset;

  /* Grid */
  --grid-line: rgba(117, 211, 255, 0.12);
  --grid-glow: rgba(95, 180, 255, 0.18);

  /* Safe area */
  --safe-bottom: env(safe-area-inset-bottom, 0px);

  /* Tighter shell controls */
  --stage-pad: clamp(1.05rem, 2.4vw, 2.5rem);
  --frame-pad: clamp(1.05rem, 2.1vw, 2rem);

  /* tighter atrium grid spacing */
  --workspace-gap: 0.85rem;

  /* Extra reach space ONLY when panel scrolls */
  --bottom-actions-reserve: 104px;

  /* Perf knobs (mobile throttles) */
  --orbit-blur: 40px;
  --glow-blur: 32px;
  --font-base: clamp(13px, 2.74vw, 18.6px);
    /* ── Chakra ink + chakra ark (arc) colors ───────────────────── */

  /* 0 Root */
  --chakra-ink-0: #ff3b6b;
  --chakra-ark-0: #ff6aa6;

  /* 1 Sacral */
  --chakra-ink-1: #ff8a3d;
  --chakra-ark-1: #ffc07a;

  /* 2 Solar */
  --chakra-ink-2: #ffd24a;
  --chakra-ark-2: #fff2a6;

  /* 3 Heart */
  --chakra-ink-3: #26ffc4;
  --chakra-ark-3: #a6ffe9;

  /* 4 Throat */
  --chakra-ink-4: #33f6ff;
  --chakra-ark-4: #a8fbff;

  /* 5 Third Eye */
  --chakra-ink-5: #7e86ff;
  --chakra-ark-5: #c6c9ff;

  /* 6 Crown */
  --chakra-ink-6: #c18bff;
  --chakra-ark-6: #ead8ff;
}
/* ─────────────────────────────────────────────────────────────
   GLOBAL DARK THEME LOCK — ignore device light mode everywhere
   (Also forces dark form controls / UA widgets)
───────────────────────────────────────────────────────────── */

html {
  color-scheme: dark;
  background-color: var(--bg-0);
  font-size: var(--font-base);
}

:root {
  color-scheme: dark;
}

/* If any file uses prefers-color-scheme(light), we re-assert dark */
@media (prefers-color-scheme: light) {
  html,
  :root {
    color-scheme: dark;
  }
}

/* Prevent “auto light” inputs on some mobile browsers */
input,
textarea,
select {
  color-scheme: dark;
}

/* ────────────────────────────────────────────────────────────────
   1) Reset + base
   ─────────────────────────────────────────────────────────────── */

*,
*::before,
*::after {
  box-sizing: border-box;
}

html,
body,
#root {
  margin: 0;
  padding: 0;
  height: 100%;
  width: 100%;
  min-width: 0;
}

@supports (min-height: 100svh) {
  html,
  body,
  #root {
    min-height: 100svh;
  }
}
@supports (height: 100dvh) {
  html,
  body,
  #root {
    height: 100dvh;
  }
}

/* prevent iOS text autosizing + input zoom */
html {
  -webkit-text-size-adjust: 100%;
}

input,
textarea,
select,
button {
  font-size: 16px;
  font: inherit;
  color: inherit;
}

body {
  font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont,
    "SF Pro Text", "Inter", "Segoe UI", sans-serif;
  background: radial-gradient(circle at top, #050819 0%, #02030a 52%, #000000);
  color: var(--text-main);
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;

  /* app lock */
  overflow: hidden;
  overscroll-behavior: none;
  touch-action: manipulation;

  -webkit-tap-highlight-color: rgba(51, 246, 255, 0.14);
}

img,
svg,
canvas,
video {
  max-width: 100%;
  height: auto;
}

::selection {
  background: rgba(51, 246, 255, 0.22);
}

:focus-visible {
  outline: none;
  box-shadow: var(--ring);
  border-radius: 10px;
}

a {
  color: var(--accent-cyan);
  text-decoration: none;
}
a:hover {
  text-decoration: underline;
}

.mono {
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "SF Mono", Consolas,
    "Liberation Mono", "Courier New", monospace;
  letter-spacing: 0.02em;
}

/* A11y helper */
.sr-only {
  position: absolute !important;
  width: 1px !important;
  height: 1px !important;
  padding: 0 !important;
  margin: -1px !important;
  overflow: hidden !important;
  clip: rect(0, 0, 0, 0) !important;
  white-space: nowrap !important;
  border: 0 !important;
}

/* ────────────────────────────────────────────────────────────────
   1b) First paint / navigation splash veil
   ─────────────────────────────────────────────────────────────── */

.kai-splash {
  position: fixed;
  inset: 0;
  z-index: 10000;
  display: grid;
  place-items: center;
  overflow: hidden;
  background:
    radial-gradient(circle at 18% 20%, rgba(51, 246, 255, 0.18) 0, transparent 34%),
    radial-gradient(circle at 78% 16%, rgba(155, 91, 255, 0.22) 0, transparent 40%),
    radial-gradient(circle at 50% 110%, rgba(38, 255, 196, 0.16) 0, transparent 52%),
    linear-gradient(132deg, #00060f 0%, #041227 40%, #071c37 76%, #041229 100%);
  color: var(--text-main);
  opacity: 0;
  transform: scale(1.01);
  pointer-events: none;
  transition: opacity 420ms ease, transform 620ms ease;
  --phi-breath: var(--breath-s, 5.236s);
  --phi-inhale-ratio: 61.8%;
}

.kai-splash[data-state="show"] {
  opacity: 1;
  transform: scale(1);
  pointer-events: auto;
}

.kai-splash[data-state="fade"],
.kai-splash[data-state="hidden"] {
  opacity: 0;
  transform: scale(1.012);
  pointer-events: none;
}

.kai-splash::before,
.kai-splash::after {
  content: "";
  position: absolute;
  inset: -30%;
  pointer-events: none;
}

.kai-splash::before {
  background: radial-gradient(circle at 50% 60%, rgba(51, 246, 255, 0.16), transparent 55%);
  filter: blur(70px);
  opacity: 0.85;
}

.kai-splash::after {
  background: conic-gradient(
    from 120deg,
    rgba(51, 246, 255, 0.1),
    rgba(155, 91, 255, 0.15),
    rgba(38, 255, 196, 0.1),
    rgba(51, 246, 255, 0.1)
  );
  filter: blur(120px);
  mix-blend-mode: screen;
  opacity: 0.6;
}

.kai-splash__grid {
  position: absolute;
  inset: -8%;
  background-image: linear-gradient(
      to right,
      transparent 0,
      transparent 90%,
      rgba(95, 180, 255, 0.25) 90%,
      rgba(95, 180, 255, 0.25) 100%
    ),
    linear-gradient(
      to bottom,
      transparent 0,
      transparent 90%,
      rgba(95, 180, 255, 0.2) 90%,
      rgba(95, 180, 255, 0.2) 100%
    );
  background-size: 120px 120px;
  opacity: 0.18;
  mask-image: radial-gradient(circle at center, black 20%, transparent 82%);
}

.kai-splash__halo {
  position: absolute;
  inset: 8%;
  border: 1px solid rgba(51, 246, 255, 0.2);
  border-radius: 36px;
  background: radial-gradient(circle at 50% 45%, rgba(51, 246, 255, 0.05), transparent 50%);
  backdrop-filter: blur(10px);
  opacity: 0.4;
}

.kai-splash__glow {
  position: absolute;
  inset: -14%;
  background: radial-gradient(circle at 50% 50%, rgba(0, 255, 196, 0.1), transparent 60%);
  mix-blend-mode: screen;
  filter: blur(90px);
}

.kai-splash__content {
  position: relative;
  z-index: 1;
  display: grid;
  gap: clamp(0.8rem, 2vw, 1.4rem);
  padding: clamp(1.25rem, 3vw, 2.5rem);
  width: min(540px, 92vw);
  border-radius: 26px;
  background: transparent;
  border: none;
  box-shadow: none;
  text-align: center;
  backdrop-filter: none;
}

@supports not (backdrop-filter: blur(12px)) {
  .kai-splash__content {
    background: transparent;
  }
}

.kai-splash__badge {
  position: relative;
  margin: 0 auto;
  width: clamp(120px, 20vw, 180px);
  aspect-ratio: 1 / 1;
  display: grid;
  place-items: center;
  isolation: isolate;
  filter: drop-shadow(0 0 32px rgba(51, 246, 255, 0.18));
  animation: kai-splash-hover var(--phi-breath) ease-in-out infinite;
}

.kai-splash__badge-core {
  position: relative;
  display: grid;
  place-items: center;
  width: 82%;
  height: 82%;
  border-radius: 50%;
  background:
    radial-gradient(circle at 35% 30%, rgba(255, 255, 255, 0.12), rgba(255, 255, 255, 0)),
    radial-gradient(circle at 72% 70%, rgba(51, 246, 255, 0.38), rgba(51, 246, 255, 0)),
    linear-gradient(200deg, rgba(0, 255, 196, 0.4), rgba(3, 9, 27, 0.9));
  border: 1px solid rgba(168, 241, 255, 0.45);
  box-shadow:
    0 0 0 12px rgba(51, 246, 255, 0.08),
    0 0 60px rgba(38, 255, 196, 0.25);
  overflow: hidden;
  animation: kai-splash-breathe var(--phi-breath) ease-in-out infinite;
}

.kai-splash__badge-core img {
  width: 58%;
  filter:
    drop-shadow(0 0 14px rgba(51, 246, 255, 0.65))
    drop-shadow(0 0 50px rgba(38, 255, 196, 0.45));
}

.kai-splash__badge-core-shine {
  position: absolute;
  inset: -18%;
  background: radial-gradient(circle at 50% 35%, rgba(255, 255, 255, 0.26), transparent 52%);
  mix-blend-mode: screen;
  filter: blur(28px);
  opacity: 0.65;
  animation: kai-splash-surge var(--phi-breath) ease-in-out infinite;
}

.kai-splash__badge-core::after {
  content: "";
  position: absolute;
  inset: -8%;
  background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.25), transparent 45%);
  mix-blend-mode: screen;
  filter: blur(18px);
  opacity: 0.7;
  animation: kai-splash-surge var(--phi-breath) ease-in-out infinite;
}

.kai-splash__badge-orb {
  position: absolute;
  inset: 18%;
  border-radius: 50%;
  background: radial-gradient(circle at 45% 35%, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0));
  mix-blend-mode: screen;
}

.kai-splash__ring {
  position: absolute;
  inset: 8%;
  border-radius: 50%;
  border: 1px solid rgba(51, 246, 255, 0.35);
  box-shadow:
    0 0 0 10px rgba(51, 246, 255, 0.12),
    0 0 0 1px rgba(255, 255, 255, 0.08) inset;
  animation: kai-splash-pulse var(--phi-breath) ease-in-out infinite;
}

.kai-splash__ring--inner {
  inset: 16%;
  border: 1px solid rgba(155, 91, 255, 0.35);
  box-shadow:
    0 0 0 8px rgba(155, 91, 255, 0.16),
    0 0 0 1px rgba(255, 255, 255, 0.05) inset;
  animation: kai-splash-pulse var(--phi-breath) ease-in-out infinite reverse;
}

.kai-splash__rays {
  position: absolute;
  inset: -40%;
  background: conic-gradient(
    from 120deg,
    rgba(51, 246, 255, 0.08),
    rgba(155, 91, 255, 0.18),
    rgba(38, 255, 196, 0.12),
    rgba(51, 246, 255, 0.08)
  );
  filter: blur(32px);
  mix-blend-mode: screen;
  border-radius: 50%;
  opacity: 0.9;
  animation: kai-splash-rotate calc(var(--phi-breath) * 3) linear infinite;
}

.kai-splash__flare {
  position: absolute;
  inset: 22% 6% auto 6%;
  height: 4px;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.8), transparent);
  filter: blur(3px);
  opacity: 0.65;
  transform: translateY(-60px) scaleX(0.4);
  transform-origin: center;
  animation: kai-splash-flare calc(var(--phi-breath) * 0.5) ease-in-out infinite;
}

@keyframes kai-splash-rotate {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

@keyframes kai-splash-surge {
  0% {
    opacity: 0.35;
    transform: scale(0.92);
  }
  61.8% {
    opacity: 0.95;
    transform: scale(1.08);
  }
  100% {
    opacity: 0.35;
    transform: scale(0.92);
  }
}

@keyframes kai-splash-flare {
  0% {
    opacity: 0.15;
    transform: translateY(-70px) scaleX(0.2);
  }
  61.8% {
    opacity: 0.82;
    transform: translateY(0) scaleX(1.04);
  }
  100% {
    opacity: 0.12;
    transform: translateY(-70px) scaleX(0.2);
  }
}

@keyframes kai-splash-hover {
  0% {
    transform: translateY(0px) scale(1);
  }
  61.8% {
    transform: translateY(-6px) scale(1.015);
  }
  100% {
    transform: translateY(0px) scale(1);
  }
}

@keyframes kai-splash-breathe {
  0% {
    transform: scale(1);
    box-shadow:
      0 0 0 12px rgba(51, 246, 255, 0.08),
      0 0 60px rgba(38, 255, 196, 0.25);
  }
  61.8% {
    transform: scale(1.04);
    box-shadow:
      0 0 0 16px rgba(51, 246, 255, 0.15),
      0 0 90px rgba(155, 91, 255, 0.25);
  }
  100% {
    transform: scale(1);
    box-shadow:
      0 0 0 12px rgba(51, 246, 255, 0.08),
      0 0 60px rgba(38, 255, 196, 0.25);
  }
}

@keyframes kai-splash-pulse {
  0% {
    transform: scale(1);
    opacity: 0.8;
  }
  50% {
    transform: scale(1.04);
    opacity: 1;
  }
  100% {
    transform: scale(1);
    opacity: 0.8;
  }
}

@media (max-width: 540px) {
  .kai-splash__content {
    padding: 1.15rem;
    border-radius: 18px;
  }

  .kai-splash__badge {
    width: clamp(110px, 34vw, 140px);
  }
}

@media (prefers-reduced-motion: reduce) {
  .kai-splash,
  .kai-splash[data-state="fade"],
  .kai-splash[data-state="show"] {
    transition: opacity 180ms ease, transform 200ms ease;
  }

  .kai-splash__rays,
  .kai-splash__ring {
    animation: none;
  }

  .kai-splash__badge-core::after,
  .kai-splash__flare {
    animation: none;
  }
}

/* ────────────────────────────────────────────────────────────────
   2) A11y — Skip link
   ─────────────────────────────────────────────────────────────── */

.skip-link {
  position: absolute;
  left: 1rem;
  top: 0.75rem;
  transform: translateY(-160%);
  background: rgba(10, 20, 48, 0.92);
  border: 1px solid rgba(170, 241, 255, 0.35);
  color: var(--text-main);
  padding: 0.6rem 0.85rem;
  border-radius: 12px;
  z-index: 9999;
  box-shadow: var(--shadow-soft);
  transition: transform var(--transition-fast);
}
.skip-link:focus {
  transform: translateY(0);
}

/* ────────────────────────────────────────────────────────────────
   Route Loader (lazy bundle fallback)
   ─────────────────────────────────────────────────────────────── */

.route-loader {
  position: fixed;
  inset: 0;
  z-index: 99999;
  display: grid;
  place-items: center;
  padding: 1.35rem;
  background: radial-gradient(circle at 25% 10%, rgba(51, 246, 255, 0.08), transparent 48%),
    radial-gradient(circle at 75% 85%, rgba(155, 91, 255, 0.12), transparent 58%),
    linear-gradient(160deg, rgba(2, 3, 10, 0.96), rgba(6, 14, 35, 0.96));
}

.route-loader__glow {
  position: absolute;
  inset: 0;
  background: radial-gradient(800px 520px at 50% 50%, rgba(51, 246, 255, 0.14), transparent 68%);
  filter: blur(14px);
  opacity: 0.6;
}

.route-loader__content {
  position: relative;
  display: inline-flex;
  align-items: center;
  gap: 0.75rem;
  padding: 0.92rem 1.05rem;
  border-radius: 18px;
  background: rgba(3, 8, 24, 0.9);
  border: 1px solid rgba(170, 241, 255, 0.28);
  box-shadow: 0 18px 40px rgba(0, 0, 0, 0.55), 0 0 0 1px rgba(255, 255, 255, 0.06) inset;
  color: var(--text-main);
  font-weight: 700;
  letter-spacing: 0.01em;
}

.route-loader__dot {
  width: 16px;
  height: 16px;
  border-radius: 999px;
  background: var(--accent-cyan);
  box-shadow:
    0 0 18px rgba(51, 246, 255, 0.5),
    0 0 36px rgba(155, 91, 255, 0.35);
  animation: routeLoaderPulse 1.05s ease-in-out infinite;
  transform: translateZ(0);
}

.route-loader__text {
  white-space: normal;
  font-size: 0.96rem;
  max-width: min(320px, 82vw);
}

@keyframes routeLoaderPulse {
  0% {
    transform: scale(0.92);
    opacity: 0.75;
  }
  50% {
    transform: scale(1.08);
    opacity: 1;
  }
  100% {
    transform: scale(0.92);
    opacity: 0.75;
  }
}

@media (prefers-reduced-motion: reduce) {
  .route-loader__dot {
    animation: none;
  }
}

/* ────────────────────────────────────────────────────────────────
   3) Atlantean App Shell + background layers
   ─────────────────────────────────────────────────────────────── */

.app-shell {
  position: fixed;
  inset: 0;
  width: 100%;

  /* VisualViewport height from App.tsx */
  height: var(--vvh-px, 100dvh);
  max-height: var(--vvh-px, 100dvh);

  display: flex;
  flex-direction: column;
  overflow: hidden;

  background: radial-gradient(
      circle at 10% -10%,
      rgba(0, 255, 196, 0.18) 0,
      transparent 55%
    ),
    radial-gradient(
      circle at 90% 110%,
      rgba(155, 91, 255, 0.24) 0,
      transparent 60%
    ),
    radial-gradient(
      circle at -20% 70%,
      rgba(0, 140, 255, 0.18) 0,
      transparent 60%
    ),
    linear-gradient(145deg, var(--bg-0), var(--bg-1), var(--bg-2));
  color: var(--text-main);
}

/* Subtle holographic grid */
.app-bg-grid {
  pointer-events: none;
  position: fixed;
  inset: -40px;
  opacity: 0.35;
  background-image: linear-gradient(
      to right,
      transparent 0,
      transparent 92%,
      var(--grid-line) 92%,
      var(--grid-line) 100%
    ),
    linear-gradient(
      to bottom,
      transparent 0,
      transparent 92%,
      var(--grid-line) 92%,
      var(--grid-line) 100%
    );
  background-size: 72px 72px;
  mix-blend-mode: screen;
  mask-image: radial-gradient(circle at center, black 0, transparent 80%);
  z-index: 0;
}

/* Perfect centered “×” close button (tap-safe, no drift) */
.kx-x {
  display: grid;
  place-items: center;

  width: 44px;
  height: 44px;
  padding: 0;
  margin: 0;

  appearance: none;
  -webkit-appearance: none;

  border: 1px solid var(--sx-border-strong, rgba(255, 255, 255, 0.22));
  border-radius: 999px;
  background: rgba(0, 0, 0, 0.38);
  color: rgba(255, 255, 255, 0.92);

  font-size: 28px;
  font-weight: 700;
  line-height: 1;
  letter-spacing: 0;

  cursor: pointer;
  user-select: none;
  -webkit-tap-highlight-color: transparent;
  transform: translateZ(0);
}

.kx-x:hover {
  background: rgba(0, 0, 0, 0.52);
}
.kx-x:active {
  transform: translateZ(0) translateY(1px);
}
.kx-x:focus-visible {
  outline: none;
  box-shadow: var(
    --sx-ring,
    0 0 0 2px rgba(55, 255, 228, 0.25),
    0 0 0 6px rgba(55, 255, 228, 0.12)
  );
}

/* Position the close button in the top-right of each popover panel */
.explorer-pop__panel,
.klock-pop__panel {
  position: relative;
}
.explorer-pop__close,
.klock-pop__close {
  position: absolute;
  top: 12px;
  right: 12px;
  z-index: 50;
}

/* Rotating halo ring (heavy) */
.app-bg-orbit {
  pointer-events: none;
  position: fixed;
  width: 120vmin;
  height: 120vmin;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%) translateZ(0);
  background: radial-gradient(
      circle at 50% 50%,
      rgba(0, 0, 0, 0.1) 0,
      transparent 60%
    ),
    conic-gradient(
      from 220deg,
      rgba(38, 255, 196, 0.32),
      rgba(51, 246, 255, 0),
      rgba(155, 91, 255, 0.4),
      rgba(255, 217, 121, 0.2),
      rgba(38, 255, 196, 0.32)
    );
  filter: blur(var(--orbit-blur));
  opacity: 0.65;
  animation: orbit-spin 64s linear infinite;
  z-index: 0;
  backface-visibility: hidden;
  will-change: transform;
}
@keyframes orbit-spin {
  from {
    transform: translate(-50%, -50%) rotate(0deg) translateZ(0);
  }
  to {
    transform: translate(-50%, -50%) rotate(360deg) translateZ(0);
  }
}

/* Vertical glow column (breath-synced) — PERF: animate opacity/transform only */
.app-bg-glow {
  pointer-events: none;
  position: fixed;
  left: 50%;
  top: -10%;
  width: 36vw;
  max-width: 520px;
  height: 140vh;
  transform: translateX(-50%) translateZ(0);
  background: radial-gradient(
      circle at 50% 0%,
      rgba(255, 255, 255, 0.38) 0,
      transparent 40%
    ),
    linear-gradient(
      to bottom,
      rgba(38, 255, 196, 0),
      rgba(38, 255, 196, 0.55),
      rgba(155, 91, 255, 0.4),
      rgba(255, 217, 121, 0.1),
      rgba(0, 0, 0, 0)
    );
  opacity: 0.58;
  filter: blur(var(--glow-blur));
  mix-blend-mode: screen;

  /* compositor-safe breath */
  animation: golden-breath var(--breath) ease-in-out infinite;
  transform-origin: 50% 30%;
  z-index: 0;
  backface-visibility: hidden;
  will-change: transform, opacity;
}
@keyframes golden-breath {
  0% {
    opacity: 0.42;
    transform: translateX(-50%) scaleY(0.985) translateZ(0);
  }
  50% {
    opacity: 0.7;
    transform: translateX(-50%) scaleY(1.04) translateZ(0);
  }
  100% {
    opacity: 0.45;
    transform: translateX(-50%) scaleY(0.995) translateZ(0);
  }
}

@media (prefers-reduced-motion: reduce) {
  .app-bg-orbit,
  .app-bg-glow {
    animation: none !important;
  }
}

/* Mobile throttle (keeps look, lowers paint cost) */
@media (max-width: 650px) {
  :root {
    --orbit-blur: 28px;
    --glow-blur: 22px;
  }
  .app-bg-orbit {
    opacity: 0.55;
    animation-duration: 92s;
  }
}

/* ────────────────────────────────────────────────────────────────
   4) Topbar
   ─────────────────────────────────────────────────────────────── */

.app-topbar {
  position: relative;
  z-index: 5;
  height: var(--topbar-h);
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: clamp(0.4rem, 1vw, 0.75rem);
  padding: 0.85rem clamp(1rem, 2.5vw, 1.75rem);
  border-bottom: 1px solid rgba(255, 255, 255, 0.08);
  background: radial-gradient(
      circle at 20% 0%,
      rgba(51, 246, 255, 0.12),
      transparent 55%
    ),
    radial-gradient(
      circle at 80% 100%,
      rgba(155, 91, 255, 0.1),
      transparent 60%
    ),
    linear-gradient(180deg, rgba(2, 6, 18, 0.88), rgba(2, 6, 18, 0.62));
  backdrop-filter: blur(var(--blur-soft)) saturate(140%);
  -webkit-backdrop-filter: blur(var(--blur-soft)) saturate(140%);
}

@supports not ((backdrop-filter: blur(1px))) {
  .app-topbar {
    background: rgba(2, 6, 18, 0.92);
  }
}

.topbar-left,
.topbar-right {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  min-width: 0;
}

.brand {
  display: flex;
  align-items: center;
  gap: 0.85rem;
  user-select: none;
  min-width: 0;
}

.brand__mark {
  width: 44px;
  height: 44px;
  border-radius: 14px;
  display: grid;
  place-items: center;
  font-weight: 800;
  letter-spacing: 0.03em;
  color: rgba(2, 6, 18, 0.95);
  background: radial-gradient(
      circle at 35% 25%,
      rgba(255, 255, 255, 0.85) 0,
      rgba(255, 217, 121, 0.55) 28%,
      rgba(51, 246, 255, 0.45) 55%,
      rgba(155, 91, 255, 0.35) 78%
    ),
    linear-gradient(
      135deg,
      rgba(38, 255, 196, 0.65),
      rgba(51, 246, 255, 0.55)
    );
  box-shadow: 0 10px 26px rgba(0, 0, 0, 0.55),
    0 0 0 1px rgba(255, 255, 255, 0.18) inset,
    0 0 40px rgba(255, 217, 121, 0.16);
  position: relative;
  overflow: hidden;
  transform: translateZ(0);
}

.brand__mark-img {
  width: 26px;
  height: 26px;
  display: block;
  filter: drop-shadow(0 8px 18px rgba(0, 0, 0, 0.45));
}

.brand__mark::after {
  content: "";
  position: absolute;
  inset: -40%;
  background: linear-gradient(
    120deg,
    transparent 0%,
    rgba(255, 255, 255, 0.35) 45%,
    transparent 70%
  );
  transform: rotate(18deg) translateX(-40%);
  animation: brand-sheen calc(var(--breath) * 2) ease-in-out infinite;
  opacity: 0.55;
  will-change: transform, opacity;
}
@keyframes brand-sheen {
  0% {
    transform: rotate(18deg) translateX(-55%);
    opacity: 0;
  }
  35% {
    opacity: 0.55;
  }
  70% {
    transform: rotate(18deg) translateX(55%);
    opacity: 0;
  }
  100% {
    opacity: 0;
  }
}

.brand__text {
  display: grid;
  gap: 0.12rem;
  min-width: 0;
}

.brand__title {
  font-size: clamp(0.96rem, 0.78rem + 0.7vw, 1.28rem);
  font-weight: 860;
  letter-spacing: 0.018em;
  line-height: 1.05;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: min(52vw, 360px);

  color: transparent;
  -webkit-text-fill-color: transparent;
  -webkit-background-clip: text;
  background-clip: text;

  background-image: linear-gradient(
    115deg,
    rgba(255, 80, 190, 0.98) 0%,
    rgba(120, 130, 255, 0.98) 18%,
    rgba(80, 220, 255, 0.98) 36%,
    rgba(120, 255, 210, 0.98) 54%,
    rgba(255, 245, 120, 0.98) 72%,
    rgba(255, 130, 70, 0.98) 86%,
    rgba(255, 80, 190, 0.98) 100%
  );
  background-size: 320% 320%;
  background-position: 0% 50%;

  /* PERF: keep shadows constant; animate bg-position only */
  text-shadow: 0 0 0.06em rgba(255, 255, 255, 0.32),
    0 0 0.22em rgba(120, 255, 240, 0.28),
    0 0 0.55em rgba(120, 130, 255, 0.16);

  animation: brandTextRainbow 13.09s linear infinite;
  will-change: background-position;
}
@keyframes brandTextRainbow {
  0% {
    background-position: 0% 50%;
  }
  50% {
    background-position: 100% 50%;
  }
  100% {
    background-position: 0% 50%;
  }
}

@media (prefers-reduced-motion: reduce) {
  .brand__title {
    animation: none;
  }
}

.brand__subtitle {
  font-size: clamp(0.74rem, 0.66rem + 0.35vw, 0.92rem);
  font-weight: 720;
  letter-spacing: 0.11em;
  text-transform: uppercase;
  line-height: 1.15;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: min(52vw, 360px);

  background-image: linear-gradient(
    105deg,
    rgba(255, 255, 255, 0.86) 0%,
    rgba(160, 255, 244, 0.84) 28%,
    rgba(150, 205, 255, 0.78) 58%,
    rgba(210, 170, 255, 0.72) 86%,
    rgba(255, 255, 255, 0.82) 100%
  );
  background-size: 240% 240%;
  background-position: 0% 50%;
  -webkit-background-clip: text;
  background-clip: text;
  -webkit-text-fill-color: transparent;

  opacity: 0.92;
  will-change: background-position;
  animation: brandSubtitleDrift 10.472s linear infinite;
}
@keyframes brandSubtitleDrift {
  0% {
    background-position: 0% 50%;
  }
  50% {
    background-position: 100% 50%;
  }
  100% {
    background-position: 0% 50%;
  }
}
@media (prefers-reduced-motion: reduce) {
  .brand__subtitle {
    animation: none;
  }
}

/* LIVE indicator (top right) */
.topbar-live {
  appearance: none;
  -webkit-appearance: none;
  
  

  display: flex;
  align-items: center;
  gap: 12px;

  padding: 8px 12px;
  border-radius: 999px;

  border: 1px solid rgba(0, 255, 160, 0.22);
  background: rgba(10, 14, 24, 0.45);

  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);

  cursor: pointer;
  text-align: left;
  user-select: none;

  transform: translateZ(0);
}
.topbar-live:focus-visible {
  outline: none;
  box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.14),
    0 0 0 6px rgba(120, 220, 255, 0.1);
    
}
/* Topbar time tint inputs (set from App.tsx via style vars) */
.topbar-live{
  --kai-chakra: var(--chakra-ink-3);
  --kai-ark:    var(--chakra-ark-3);
  --kai-month:  var(--chakra-ink-2);
}

/* Fine-grained time styling */
.kai-tag,
.kai-sep{
  color: rgba(245,247,255,0.62);
}

.kai-num{
  font-variant-numeric: tabular-nums;
}

.kai-num--chakra{
  color: var(--kai-chakra);
  text-shadow: 0 0 16px rgba(0,0,0,0.55);
}

.kai-num--ark{
  color: var(--kai-ark);
  text-shadow: 0 0 16px rgba(0,0,0,0.55);
}

.kai-num--month{
  color: var(--kai-month);
  text-shadow: 0 0 16px rgba(0,0,0,0.55);
}

/* PERF: glow via pseudo-element; animate opacity/scale only */
.live-orb {
  position: relative;
  width: 12px;
  height: 12px;
  border-radius: 50%;
  background: rgba(0, 255, 160, 0.95);
  box-shadow: 0 0 10px rgba(0, 255, 160, 0.55);
  transform: translateZ(0);
}
.live-orb::after {
  content: "";
  position: absolute;
  inset: -10px;
  border-radius: 999px;
  background: radial-gradient(
    circle,
    rgba(0, 255, 160, 0.55),
    transparent 62%
  );
  opacity: 0.55;
  transform: scale(0.92);
  animation: liveOrbBreath var(--breath-s) ease-in-out infinite;
  will-change: transform, opacity;
  pointer-events: none;
}
@keyframes liveOrbBreath {
  0%,
  100% {
    opacity: 0.45;
    transform: scale(0.9);
  }
  50% {
    opacity: 0.8;
    transform: scale(1.15);
  }
}

.live-text {
  display: flex;
  flex-direction: column;
  line-height: 1.05;
}
.live-title {
  font-weight: 800;
  letter-spacing: 0.12em;
}
.live-meta {
  opacity: 0.9;
  font-size: 12px;
}

/* ────────────────────────────────────────────────────────────────
   5) Stage + Sacred Frame
   ─────────────────────────────────────────────────────────────── */

.app-stage {
  position: relative;
  z-index: 1;
  flex: 1;
  min-height: 0;
  width: 100%;
  display: flex;
  align-items: center;
  justify-content: center;

  padding: var(--stage-pad);
  padding-bottom: calc(var(--stage-pad) + var(--safe-bottom));

  overflow: hidden;
}

.app-frame {
  position: relative;
  width: 100%;
  max-width: 1180px;
  height: 100%;
  border-radius: var(--radius-xl);
  background: radial-gradient(
      circle at top left,
      rgba(51, 246, 255, 0.19),
      transparent 55%
    ),
    radial-gradient(
      circle at top right,
      rgba(155, 91, 255, 0.16),
      transparent 52%
    ),
    radial-gradient(
      circle at 50% 100%,
      rgba(255, 217, 121, 0.1),
      transparent 60%
    ),
    linear-gradient(145deg, rgba(5, 14, 40, 0.96), rgba(1, 4, 16, 0.98));
  border: 1px solid rgba(157, 255, 244, 0.6);
  box-shadow: var(--shadow-hard), 0 0 0 1px rgba(255, 255, 255, 0.05),
    0 0 90px rgba(51, 246, 255, 0.24);
  overflow: hidden;
  backdrop-filter: blur(var(--blur-strong)) saturate(150%);
  -webkit-backdrop-filter: blur(var(--blur-strong)) saturate(150%);
}

.app-frame::before,
.app-frame::after {
  content: "";
  position: absolute;
  inset: 1px;
  border-radius: calc(var(--radius-xl) - 2px);
  pointer-events: none;
}
.app-frame::before {
  border: 1px solid rgba(255, 255, 255, 0.09);
  opacity: 0.85;
}
.app-frame::after {
  background: linear-gradient(
    120deg,
    rgba(255, 255, 255, 0.12),
    transparent 35%,
    transparent 65%,
    rgba(51, 246, 255, 0.25)
  );
  mix-blend-mode: soft-light;
  opacity: 0.32;
}

.app-frame-inner {
  position: relative;
  z-index: 1;
  padding: var(--frame-pad);
  border-radius: calc(var(--radius-xl) - 6px);
  background: radial-gradient(
      circle at 10% 0%,
      rgba(255, 255, 255, 0.06),
      transparent 55%
    ),
    radial-gradient(
      circle at 90% 100%,
      rgba(51, 246, 255, 0.15),
      transparent 60%
    ),
    radial-gradient(
      circle at 0% 100%,
      rgba(155, 91, 255, 0.18),
      transparent 65%
    ),
    linear-gradient(160deg, var(--frame-inner-bg), rgba(1, 4, 16, 0.98));
  overflow: hidden;
  height: 100%;
  min-width: 0;
}

.app-workspace {
  display: grid;
  grid-template-columns: 320px 1fr;
  grid-template-rows: auto minmax(0, 1fr);
  gap: var(--workspace-gap);
  height: 100%;
  min-height: 0;
  min-width: 0;
}

.workspace-topbar {
  grid-column: 1 / -1;
  border-radius: var(--radius-lg);
  border: 1px solid rgba(170, 241, 255, 0.22);
  background: radial-gradient(
      circle at 18% 0%,
      rgba(51, 246, 255, 0.12),
      transparent 58%
    ),
    radial-gradient(
      circle at 82% 100%,
      rgba(155, 91, 255, 0.1),
      transparent 60%
    ),
    linear-gradient(145deg, rgba(6, 14, 35, 0.62), rgba(3, 8, 24, 0.92));
  box-shadow: 0 18px 50px rgba(0, 0, 0, 0.55),
    0 0 0 1px rgba(255, 255, 255, 0.04) inset;
  overflow: visible;
  position: relative;
  padding: 0.68rem 0.75rem 0.75rem;
}
.workspace-topbar > * {
  width: 100%;
  min-width: 0;
}

/* ────────────────────────────────────────────────────────────────
   6) Navigation
   ─────────────────────────────────────────────────────────────── */

.app-nav {
  border-radius: var(--radius-lg);
  background: radial-gradient(
      circle at 30% 20%,
      rgba(51, 246, 255, 0.1),
      transparent 55%
    ),
    linear-gradient(145deg, rgba(6, 14, 35, 0.72), rgba(3, 8, 24, 0.92));
  border: 1px solid rgba(170, 241, 255, 0.22);
  box-shadow: 0 18px 50px rgba(0, 0, 0, 0.55),
    0 0 0 1px rgba(255, 255, 255, 0.04) inset;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  min-height: 0;
  height: 100%;
}

.nav-head {
  padding: 0.95rem 1rem 0.78rem;
  border-bottom: 1px solid rgba(255, 255, 255, 0.06);
  background: radial-gradient(
      circle at 20% 0%,
      rgba(255, 217, 121, 0.09),
      transparent 55%
    ),
    linear-gradient(180deg, rgba(10, 20, 48, 0.3), rgba(10, 20, 48, 0));
}

.nav-head__title {
  font-size: 0.92rem;
  font-weight: 900;
  letter-spacing: 0.12em;
  text-transform: uppercase;
  color: rgba(245, 247, 255, 0.92);
}
.nav-head__sub {
  margin-top: 0.22rem;
  font-size: 0.82rem;
  color: rgba(245, 247, 255, 0.68);
}

.nav-list {
  padding: 0.7rem;
  display: grid;
  gap: 0.5rem;
  overflow: hidden;
}

.nav-item {
  border-radius: 16px;
  padding: 0.78rem 0.8rem;
  border: 1px solid rgba(255, 255, 255, 0.08);
  background: radial-gradient(
      circle at 14% 20%,
      rgba(51, 246, 255, 0.08),
      transparent 55%
    ),
    linear-gradient(145deg, rgba(10, 20, 48, 0.25), rgba(10, 20, 48, 0.1));
  box-shadow: 0 10px 22px rgba(0, 0, 0, 0.35),
    0 0 0 1px rgba(255, 255, 255, 0.03) inset;
  transition: transform var(--transition-fast),
    border-color var(--transition-fast), background var(--transition-fast),
    box-shadow var(--transition-fast);
  transform: translateZ(0);
}

.nav-item__label {
  font-weight: 900;
  letter-spacing: 0.03em;
}
.nav-item__desc {
  margin-top: 0.16rem;
  font-size: 0.82rem;
  color: rgba(245, 247, 255, 0.68);
}

.nav-item:hover {
  text-decoration: none;
  transform: translateY(-1px) translateZ(0);
  border-color: rgba(51, 246, 255, 0.28);
  background: radial-gradient(
      circle at 14% 20%,
      rgba(51, 246, 255, 0.12),
      transparent 55%
    ),
    linear-gradient(145deg, rgba(10, 20, 48, 0.34), rgba(10, 20, 48, 0.14));
  box-shadow: 0 16px 30px rgba(0, 0, 0, 0.5),
    0 0 0 1px rgba(51, 246, 255, 0.08) inset,
    0 0 30px rgba(51, 246, 255, 0.08);
}

.nav-item--active {
  border-color: rgba(255, 217, 121, 0.42);
  background: radial-gradient(
      circle at 20% 0%,
      rgba(255, 217, 121, 0.16),
      transparent 62%
    ),
    radial-gradient(
      circle at 14% 20%,
      rgba(51, 246, 255, 0.14),
      transparent 55%
    ),
    linear-gradient(145deg, rgba(10, 20, 48, 0.42), rgba(10, 20, 48, 0.18));
  box-shadow: 0 18px 34px rgba(0, 0, 0, 0.55),
    0 0 0 1px rgba(255, 217, 121, 0.1) inset,
    0 0 46px rgba(255, 217, 121, 0.08);
}

.nav-foot {
  margin-top: auto;
  padding: 0.8rem 1rem 0.9rem;
  border-top: 1px solid rgba(255, 255, 255, 0.06);
  background: linear-gradient(
    180deg,
    rgba(10, 20, 48, 0),
    rgba(10, 20, 48, 0.22)
  );
}

.nav-foot__line {
  font-size: 0.78rem;
  color: rgba(245, 247, 255, 0.72);
  line-height: 1.35;
}
.nav-foot__line + .nav-foot__line {
  margin-top: 0.35rem;
}

/* ────────────────────────────────────────────────────────────────
   7) Panel — CENTER WHEN POSSIBLE, SCROLL WHEN NECESSARY
   ─────────────────────────────────────────────────────────────── */

.app-panel {
  border-radius: var(--radius-lg);
  background: radial-gradient(
      circle at 70% 20%,
      rgba(51, 246, 255, 0.1),
      transparent 55%
    ),
    radial-gradient(
      circle at 10% 0%,
      rgba(155, 91, 255, 0.1),
      transparent 62%
    ),
    linear-gradient(145deg, rgba(6, 14, 35, 0.72), rgba(3, 8, 24, 0.92));
  border: 1px solid rgba(170, 241, 255, 0.22);
  box-shadow: 0 18px 60px rgba(0, 0, 0, 0.62),
    0 0 0 1px rgba(255, 255, 255, 0.04) inset;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  min-height: 0;
  height: 100%;
  min-width: 0;
  width: 100%;
}

.panel-head {
  padding: 0.95rem 1.1rem;
  border-bottom: 1px solid rgba(255, 255, 255, 0.06);
  background: radial-gradient(
      circle at 50% 0%,
      rgba(255, 217, 121, 0.1),
      transparent 56%
    ),
    linear-gradient(180deg, rgba(10, 20, 48, 0.36), rgba(10, 20, 48, 0));
}

.panel-head__title {
  font-size: 1.05rem;
  font-weight: 900;
  letter-spacing: 0.02em;
}

.panel-head__meta {
  margin-top: 0.48rem;
  display: flex;
  flex-wrap: wrap;
  gap: 0.42rem;
}

.meta-chip {
  display: inline-flex;
  align-items: center;
  gap: 0.4rem;
  padding: 0.35rem 0.6rem;
  border-radius: 999px;
  border: 1px solid rgba(255, 255, 255, 0.1);
  background: rgba(10, 20, 48, 0.34);
  color: rgba(245, 247, 255, 0.84);
  font-size: 0.72rem;
  letter-spacing: 0.08em;
  text-transform: uppercase;
}

/* PANEL BODY */
.panel-body {
  flex: 1 1 auto;
  min-height: 0;
  padding: 0.92rem 1.1rem calc(1.05rem + var(--safe-bottom));
  overflow-y: auto;
  overflow-x: hidden;
  -webkit-overflow-scrolling: touch;
  overscroll-behavior: contain;
  scroll-padding-bottom: calc(1.05rem + var(--safe-bottom));
  scrollbar-gutter: stable both-edges;
  position: relative;

  scrollbar-width: thin;
  scrollbar-color: rgba(170, 241, 255, 0.18) transparent;
}
.panel-body::-webkit-scrollbar {
  width: 10px;
}
.panel-body::-webkit-scrollbar-track {
  background: transparent;
}
.panel-body::-webkit-scrollbar-thumb {
  background: rgba(170, 241, 255, 0.18);
  border: 2px solid transparent;
  background-clip: padding-box;
  border-radius: 999px;
}
.panel-body::-webkit-scrollbar-thumb:hover {
  background: rgba(170, 241, 255, 0.28);
}

/* extra reach space only when AppChrome says so */
.app-shell[data-panel-scroll="1"] .panel-body::after {
  content: "";
  display: block;
  height: var(--bottom-actions-reserve);
  width: 100%;
}

.panel-center {
  width: 100%;
  min-width: 0;
  min-height: 100%;
  display: flex;
}
.panel-center > * {
  width: 100%;
  max-width: 920px;
  min-width: 0;
  margin: auto;
  max-height: none;
  min-height: 0;
}

/* Footer (dock) */
.panel-foot {
  flex: 0 0 auto;
  padding: 0.72rem 1.1rem calc(0.72rem + var(--safe-bottom));
  border-top: 1px solid rgba(255, 255, 255, 0.06);
  display: flex;
  align-items: center;
  justify-content: space-between;
  background: linear-gradient(
    180deg,
    rgba(10, 20, 48, 0),
    rgba(10, 20, 48, 0.22)
  );
  color: rgba(245, 247, 255, 0.62);
  font-size: 0.78rem;
  position: relative;
  z-index: 4;
}

/* ────────────────────────────────────────────────────────────────
   8) Not Found
   ─────────────────────────────────────────────────────────────── */

.notfound {
  padding: 2.25rem 1.25rem;
  border-radius: var(--radius-md);
  border: 1px solid rgba(255, 255, 255, 0.1);
  background: radial-gradient(
      circle at 30% 10%,
      rgba(255, 77, 141, 0.1),
      transparent 60%
    ),
    radial-gradient(
      circle at 70% 0%,
      rgba(51, 246, 255, 0.1),
      transparent 60%
    ),
    linear-gradient(145deg, rgba(10, 20, 48, 0.35), rgba(10, 20, 48, 0.14));
  box-shadow: 0 20px 70px rgba(0, 0, 0, 0.65);
}

.notfound__code {
  font-size: 3.25rem;
  font-weight: 950;
  letter-spacing: 0.05em;
  line-height: 1;
}
.notfound__title {
  margin-top: 0.35rem;
  font-size: 1.1rem;
  font-weight: 900;
}
.notfound__hint {
  margin-top: 0.5rem;
  color: rgba(245, 247, 255, 0.72);
}
.notfound__actions {
  margin-top: 1.15rem;
}
.notfound__cta {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  padding: 0.75rem 0.95rem;
  border-radius: 14px;
  font-weight: 900;
  letter-spacing: 0.06em;
  text-transform: uppercase;
  color: rgba(2, 6, 18, 0.95);
  background: radial-gradient(
      circle at 35% 25%,
      rgba(255, 255, 255, 0.85) 0,
      rgba(255, 217, 121, 0.55) 26%,
      rgba(51, 246, 255, 0.4) 58%
    ),
    linear-gradient(
      135deg,
      rgba(38, 255, 196, 0.65),
      rgba(51, 246, 255, 0.55)
    );
  border: 1px solid rgba(255, 255, 255, 0.16);
  box-shadow: 0 16px 34px rgba(0, 0, 0, 0.55),
    0 0 0 1px rgba(255, 255, 255, 0.1) inset;
  transition: transform var(--transition-fast), box-shadow var(--transition-fast);
}
.notfound__cta:hover {
  text-decoration: none;
  transform: translateY(-1px) translateZ(0);
  box-shadow: 0 20px 46px rgba(0, 0, 0, 0.62),
    0 0 0 1px rgba(255, 255, 255, 0.14) inset,
    0 0 36px rgba(255, 217, 121, 0.1);
}

/* ────────────────────────────────────────────────────────────────
   9) Responsive — mobile becomes “mission control”
   ─────────────────────────────────────────────────────────────── */

@media (max-width: 980px) {
  :root {
    --workspace-gap: 0.78rem;
  }

  .app-stage {
    padding: 0.95rem;
    padding-bottom: calc(0.95rem + var(--safe-bottom));
  }

  .app-frame {
    border-radius: 24px;
  }

  .app-frame-inner {
    padding: 0.95rem;
  }

  .app-workspace {
    grid-template-columns: 1fr;
    grid-template-rows: auto auto minmax(0, 1fr);
    gap: var(--workspace-gap);
    height: 100%;
    min-height: 0;
  }

  .app-nav {
    min-height: 0;
    height: auto;
  }

  .nav-list {
    display: flex;
    flex-wrap: nowrap;
    align-items: stretch;
    gap: 0.5rem;

    padding: 0.7rem;
    padding-bottom: calc(0.85rem + var(--safe-bottom));

    overflow-x: auto;
    overflow-y: hidden;
    -webkit-overflow-scrolling: touch;
    overscroll-behavior-x: contain;

    scroll-snap-type: x mandatory;
    scroll-padding-left: 0.7rem;
    scroll-padding-right: 0.7rem;

    scrollbar-width: none;
    -ms-overflow-style: none;
    position: relative;
    isolation: isolate;
    touch-action: pan-x;
  }
  .nav-list::-webkit-scrollbar {
    height: 0px;
  }

  .nav-list::before,
  .nav-list::after {
    content: "";
    position: absolute;
    top: 0.55rem;
    bottom: 0.55rem;
    width: 22px;
    pointer-events: none;
    z-index: 2;
  }
  .nav-list::before {
    left: 0;
    background: linear-gradient(
      to right,
      rgba(6, 14, 35, 0.92),
      rgba(6, 14, 35, 0)
    );
  }
  .nav-list::after {
    right: 0;
    background: linear-gradient(
      to left,
      rgba(6, 14, 35, 0.92),
      rgba(6, 14, 35, 0)
    );
    display: flex;
    align-items: center;
    justify-content: flex-end;
    padding-right: 0.28rem;
    gap: 0.2rem;
    font-size: 0.72rem;
    font-weight: 800;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: rgba(245, 247, 255, 0.78);
    text-shadow: 0 0 8px rgba(51, 246, 255, 0.42);
    animation: nav-swipe-hint 3.6s ease-in-out infinite;
    content: "Swipe →";
  }

  .nav-item {
    flex: 0 0 clamp(130px, 38vw, 170px);
    height: auto;
    min-width: 0;
    display: flex;
    flex-direction: column;
    justify-content: center;
    gap: 0.3rem;
    padding: 0.62rem 0.66rem;

    scroll-snap-align: start;
    scroll-snap-stop: always;
    white-space: normal;
  }

  .panel-center > * {
    max-width: 100%;
  }

  .workspace-topbar {
    padding: 0.62rem 0.65rem 0.68rem;
  }
}

@media (max-width: 650px) {
  :root {
    --topbar-h: 72px;
    --bottom-actions-reserve: 112px;
    --workspace-gap: 0.72rem;
  }

  .app-frame {
    border-radius: 20px;
  }

  .app-frame-inner {
    padding: 0.85rem;
    border-radius: 16px;
  }

  .brand__subtitle {
    display: none;
  }

  .panel-head {
    padding: 0.82rem 0.95rem;
  }
  .panel-body {
    padding: 0.78rem 0.95rem calc(0.95rem + var(--safe-bottom));
    scroll-padding-bottom: calc(0.95rem + var(--safe-bottom));
  }
  .panel-foot {
    padding: 0.62rem 0.95rem calc(0.62rem + var(--safe-bottom));
    font-size: 0.72rem;
  }
  .nav-head {
    padding: 0.85rem 0.9rem 0.7rem;
  }
  .nav-foot {
    padding: 0.7rem 0.9rem 0.8rem;
  }
  .nav-foot__line {
    font-size: 0.72rem;
    line-height: 1.25;
  }

  .workspace-topbar {
    padding: 0.58rem 0.58rem 0.64rem;
  }
}

@media (max-width: 520px) {
  :root {
    --topbar-h: 68px;
    --stage-pad: clamp(0.78rem, 2vw, 1.05rem);
    --frame-pad: clamp(0.7rem, 2vw, 1.05rem);
    --workspace-gap: 0.6rem;
  }

  .app-topbar {
    padding: 0.7rem clamp(0.7rem, 3vw, 1.1rem);
  }

  .brand__mark {
    width: 38px;
    height: 38px;
  }

  .brand__title,
  .brand__subtitle {
    max-width: min(64vw, 300px);
  }

  .app-frame {
    border-radius: 14px;
  }

  .app-frame-inner {
    padding: 0.7rem;
    border-radius: 12px;
  }

  .app-panel,
  .app-nav,
  .workspace-topbar {
    border-radius: 14px;
  }

  .panel-head {
    padding: 0.7rem 0.85rem;
  }

  .panel-body {
    padding: 0.7rem 0.85rem calc(0.85rem + var(--safe-bottom));
    scroll-padding-bottom: calc(0.85rem + var(--safe-bottom));
  }

  .panel-foot {
    padding: 0.55rem 0.85rem calc(0.7rem + var(--safe-bottom));
    font-size: 0.72rem;
  }

  .nav-list {
    gap: 0.45rem;
    padding: 0.6rem;
    padding-bottom: calc(0.75rem + var(--safe-bottom));
  }

  .nav-item {
    flex: 0 0 clamp(120px, 48vw, 158px);
    height: auto;
  }
}

@media (max-width: 380px) {
  :root {
    --topbar-h: 64px;
    --workspace-gap: 0.52rem;
    --bottom-actions-reserve: 88px;
  }

  .app-topbar {
    padding: 0.6rem clamp(0.6rem, 3vw, 0.9rem);
    gap: 0.4rem;
  }

  .brand__mark {
    width: 34px;
    height: 34px;
  }

  .brand__title,
  .brand__subtitle {
    max-width: min(68vw, 240px);
  }

  .nav-item {
    flex: 0 0 clamp(112px, 60vw, 148px);
    height: auto;
  }

  .nav-head,
  .panel-head {
    padding: 0.64rem 0.78rem;
  }

  .panel-body {
    padding: 0.62rem 0.78rem calc(0.78rem + var(--safe-bottom));
  }

  .panel-foot {
    padding: 0.5rem 0.78rem calc(0.62rem + var(--safe-bottom));
  }
}

@keyframes nav-swipe-hint {
  0% {
    opacity: 0;
    transform: translateX(0);
  }
  15% {
    opacity: 0.9;
  }
  55% {
    opacity: 0.9;
    transform: translateX(-5px);
  }
  100% {
    opacity: 0;
    transform: translateX(0);
  }
}

/* HEIGHT-BASED SAFETY */
@media (max-height: 820px) {
  :root {
    --workspace-gap: 0.7rem;
    --stage-pad: 0.9rem;
    --frame-pad: 0.9rem;
  }

  .app-topbar {
    padding: 0.75rem 1rem;
  }

  .workspace-topbar {
    padding: 0.56rem 0.6rem 0.62rem;
  }

  .nav-head__sub {
    display: none;
  }
}

@media (max-height: 740px) {
  :root {
    --topbar-h: 68px;
    --workspace-gap: 0.64rem;
    --bottom-actions-reserve: 96px;
  }

  .app-stage {
    padding: 0.8rem;
    padding-bottom: calc(0.8rem + var(--safe-bottom));
  }

  .app-frame-inner {
    padding: 0.8rem;
  }

  .nav-foot {
    display: none;
  }

  .nav-list {
    gap: 0.45rem;
    padding: 0.62rem;
  }

  .nav-item {
    padding: 0.7rem 0.72rem;
  }

  .panel-head {
    padding: 0.78rem 0.9rem;
  }
  .panel-body {
    padding: 0.7rem 0.9rem calc(0.9rem + var(--safe-bottom));
    scroll-padding-bottom: calc(0.9rem + var(--safe-bottom));
  }
  .panel-foot {
    padding: 0.55rem 0.9rem calc(0.55rem + var(--safe-bottom));
  }
}

/* ────────────────────────────────────────────────────────────────
   10) Explorer full-screen portal (ΦStream / ExplorerRoute)
   ─────────────────────────────────────────────────────────────── */

.explorer-pop {
  position: fixed;
  inset: 0;
  z-index: 999999;
  display: grid;
  place-items: stretch;
  padding: 0;

  background: radial-gradient(
      1200px 900px at 18% 10%,
      rgba(51, 246, 255, 0.12),
      rgba(0, 0, 0, 0) 55%
    ),
    radial-gradient(
      1000px 800px at 85% 95%,
      rgba(155, 91, 255, 0.12),
      rgba(0, 0, 0, 0) 60%
    ),
    rgba(0, 0, 0, 0.62);

  backdrop-filter: blur(14px) saturate(130%);
  -webkit-backdrop-filter: blur(14px) saturate(130%);

  overscroll-behavior: contain;
  isolation: isolate;

  /* perf isolation */
  contain: layout paint;
  transform: translateZ(0);
  backface-visibility: hidden;
}
@supports not ((backdrop-filter: blur(1px))) {
  .explorer-pop {
    background: rgba(0, 0, 0, 0.78);
  }
}

.explorer-pop__panel {
  position: relative;
  width: 100%;
  height: 100%;
  border-radius: 0;
  overflow: hidden;

  border: 1px solid rgba(51, 246, 255, 0.22);

  background: radial-gradient(
      900px 420px at 18% 0%,
      rgba(51, 246, 255, 0.1),
      rgba(0, 0, 0, 0) 60%
    ),
    radial-gradient(
      820px 520px at 92% 110%,
      rgba(155, 91, 255, 0.14),
      rgba(0, 0, 0, 0) 62%
    ),
    linear-gradient(180deg, rgba(10, 16, 36, 0.94), rgba(3, 6, 16, 0.96));

  box-shadow: 0 30px 90px rgba(0, 0, 0, 0.58),
    0 0 0 1px rgba(255, 255, 255, 0.06) inset,
    0 0 70px rgba(51, 246, 255, 0.12);

  backdrop-filter: blur(18px) saturate(150%);
  -webkit-backdrop-filter: blur(18px) saturate(150%);

  display: grid;
  grid-template-rows: 1fr;
  min-height: 0;

  contain: layout paint;
  transform: translateZ(0);
  backface-visibility: hidden;
}

/* Optional inner rim */
.explorer-pop__panel::before {
  content: "";
  position: absolute;
  inset: 1px;
  pointer-events: none;
  border: 1px solid rgba(255, 255, 255, 0.1);
  opacity: 0.75;
}

/* PERF: sheen breath via transform/opacity only */
.explorer-pop__panel::after {
  content: "";
  position: absolute;
  inset: -30%;
  pointer-events: none;
  background: linear-gradient(
    120deg,
    transparent 0%,
    rgba(255, 255, 255, 0.16) 45%,
    transparent 70%
  );
  transform: rotate(18deg) translateX(-40%) translateZ(0);
  animation: explorerSheen calc(var(--breath) * 2) ease-in-out infinite;
  opacity: 0.45;
  mix-blend-mode: soft-light;
  will-change: transform, opacity;
}
@keyframes explorerSheen {
  0% {
    transform: rotate(18deg) translateX(-58%) translateZ(0);
    opacity: 0;
  }
  35% {
    opacity: 0.42;
  }
  70% {
    transform: rotate(18deg) translateX(58%) translateZ(0);
    opacity: 0;
  }
  100% {
    opacity: 0;
  }
}

/* SCROLLABLE BODY */
.explorer-pop__body {
  position: relative;
  min-height: 0;
  height: 100%;
  overflow: auto;
  -webkit-overflow-scrolling: touch;
  overscroll-behavior: contain;
  touch-action: pan-y;

  padding-bottom: env(safe-area-inset-bottom, 0px);
  scroll-padding-bottom: env(safe-area-inset-bottom, 0px);

  scrollbar-gutter: stable both-edges;
  scrollbar-width: thin;
  scrollbar-color: rgba(170, 241, 255, 0.18) transparent;
}
.explorer-pop__body::-webkit-scrollbar {
  width: 10px;
}
.explorer-pop__body::-webkit-scrollbar-track {
  background: transparent;
}
.explorer-pop__body::-webkit-scrollbar-thumb {
  background: rgba(170, 241, 255, 0.18);
  border: 2px solid transparent;
  background-clip: padding-box;
  border-radius: 999px;
}
.explorer-pop__body::-webkit-scrollbar-thumb:hover {
  background: rgba(170, 241, 255, 0.28);
}

/* CLOSE “X” — Explorer (keeps your look; perf-safe breath) */
.explorer-pop__close {
  --x-size: 44px;
  --x-pad: 14px;
  --x-top: calc(var(--x-pad) + env(safe-area-inset-top, 0px));
  --x-right: calc(var(--x-pad) + env(safe-area-inset-right, 0px));

  --x-border: rgba(170, 241, 255, 0.26);
  --x-border-hot: rgba(51, 246, 255, 0.42);
  --x-ink: rgba(245, 247, 255, 0.92);

  position: absolute;
  top: var(--x-top);
  right: var(--x-right);

  width: var(--x-size);
  height: var(--x-size);
  border-radius: 999px;

  display: grid;
  place-items: center;

  cursor: pointer;
  user-select: none;
  -webkit-tap-highlight-color: rgba(51, 246, 255, 0.18);
  touch-action: manipulation;

  border: 1px solid var(--x-border);

  background: radial-gradient(
      18px 18px at 28% 22%,
      rgba(255, 255, 255, 0.18),
      transparent 62%
    ),
    radial-gradient(
      28px 26px at 78% 84%,
      rgba(51, 246, 255, 0.14),
      transparent 64%
    ),
    linear-gradient(180deg, rgba(10, 20, 48, 0.78), rgba(3, 6, 16, 0.84));

  /* keep shadow constant; animate a halo pseudo-element instead */
  box-shadow: 0 18px 44px rgba(0, 0, 0, 0.62),
    0 0 0 1px rgba(255, 255, 255, 0.06) inset;

  backdrop-filter: blur(14px) saturate(160%);
  -webkit-backdrop-filter: blur(14px) saturate(160%);

  z-index: 20;
  isolation: isolate;

  color: var(--x-ink);
  font-weight: 950;
  font-size: 19px;
  line-height: 1;
  letter-spacing: -0.03em;
  text-rendering: geometricPrecision;
  -webkit-font-smoothing: antialiased;

  text-shadow: 0 12px 28px rgba(0, 0, 0, 0.68),
    0 0 18px rgba(51, 246, 255, 0.22),
    0 0 36px rgba(155, 91, 255, 0.12);

  transform: translateZ(0);
  transition: transform var(--transition-fast),
    border-color var(--transition-fast), box-shadow var(--transition-fast),
    background var(--transition-fast), filter var(--transition-fast);
}

.explorer-pop__close > span {
  display: block;
  line-height: 1;
  transform: translateY(-0.5px);
}

/* orbit halo */
.explorer-pop__close::before {
  content: "";
  position: absolute;
  inset: -8px;
  border-radius: 999px;
  pointer-events: none;

  background: conic-gradient(
    from 220deg,
    rgba(38, 255, 196, 0.3),
    rgba(51, 246, 255, 0.02),
    rgba(155, 91, 255, 0.32),
    rgba(255, 217, 121, 0.18),
    rgba(38, 255, 196, 0.3)
  );

  filter: blur(10px);
  opacity: 0.58;
  mix-blend-mode: screen;

  animation: xOrbit calc(var(--breath) * 6) linear infinite;
  will-change: transform;
}

/* sheen + breath halo (opacity/scale only) */
.explorer-pop__close::after {
  content: "";
  position: absolute;
  inset: 1px;
  border-radius: 999px;
  pointer-events: none;

  background: linear-gradient(
    120deg,
    rgba(255, 255, 255, 0.22),
    transparent 38%,
    transparent 66%,
    rgba(51, 246, 255, 0.14)
  );

  opacity: 0.38;
  mix-blend-mode: soft-light;
  animation: xSheen calc(var(--breath) * 2) ease-in-out infinite;
  will-change: opacity;
}

@keyframes xOrbit {
  from {
    transform: rotate(0deg) translateZ(0);
  }
  to {
    transform: rotate(360deg) translateZ(0);
  }
}
@keyframes xSheen {
  0%,
  100% {
    opacity: 0.3;
  }
  50% {
    opacity: 0.52;
  }
}

.explorer-pop__close:hover {
  transform: translateZ(0) translateY(-1px);
  border-color: var(--x-border-hot);
  filter: brightness(1.08);
  box-shadow: 0 24px 60px rgba(0, 0, 0, 0.7),
    0 0 0 1px rgba(51, 246, 255, 0.12) inset;
}
.explorer-pop__close:active {
  transform: translateZ(0) scale(0.98);
}
.explorer-pop__close:focus-visible {
  outline: none;
  box-shadow: var(--ring), 0 24px 60px rgba(0, 0, 0, 0.7);
}

@media (hover: none) and (pointer: coarse) {
  .explorer-pop__close:hover {
    transform: translateZ(0);
  }
}

@media (prefers-reduced-motion: reduce) {
  .explorer-pop__panel::after,
  .explorer-pop__close::before,
  .explorer-pop__close::after {
    animation: none !important;
  }
  .explorer-pop__close {
    transition: none !important;
  }
}

@media (max-width: 520px) {
  .explorer-pop__close {
    --x-size: 46px;
    --x-pad: 12px;
    font-size: 20px;
  }
}

/* ────────────────────────────────────────────────────────────────
   11) FULL-PAGE routes (SigilPage + SigilFeedPage): scrollable
   ─────────────────────────────────────────────────────────────── */

.fullpage-scroll {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100dvh;
  max-height: 100dvh;

  overflow: auto;
  -webkit-overflow-scrolling: touch;
  overscroll-behavior: contain;
  touch-action: pan-y;

  padding: clamp(1rem, 2.6vw, 2rem);
  padding-bottom: calc(clamp(1rem, 2.6vw, 2rem) + var(--safe-bottom));
  scroll-padding-bottom: calc(clamp(1rem, 2.6vw, 2rem) + var(--safe-bottom));

  background: radial-gradient(
      circle at 10% -10%,
      rgba(0, 255, 196, 0.14) 0,
      transparent 55%
    ),
    radial-gradient(
      circle at 90% 110%,
      rgba(155, 91, 255, 0.18) 0,
      transparent 60%
    ),
    linear-gradient(145deg, var(--bg-0), var(--bg-1), var(--bg-2));
  color: var(--text-main);
}
@supports not (height: 100dvh) {
  .fullpage-scroll {
    height: 100vh;
    max-height: 100vh;
  }
}
.fullpage-scroll > * {
  max-width: 1180px;
  margin: 0 auto;
}
.fullpage-scroll::-webkit-scrollbar {
  width: 10px;
}
.fullpage-scroll::-webkit-scrollbar-track {
  background: transparent;
}
.fullpage-scroll::-webkit-scrollbar-thumb {
  background: rgba(170, 241, 255, 0.18);
  border: 2px solid transparent;
  background-clip: padding-box;
  border-radius: 999px;
}
.fullpage-scroll::-webkit-scrollbar-thumb:hover {
  background: rgba(170, 241, 255, 0.28);
}

/* ─────────────────────────────────────────────────────────────
   12) MOBILE VISIBILITY GUARANTEE — Sovereign Declarations trigger
   ─────────────────────────────────────────────────────────────── */

@media (max-width: 980px), (max-height: 720px) {
  .nav-foot {
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
    pointer-events: auto !important;

    position: static !important;

    margin-top: 6px !important;
    margin-bottom: calc(2px + var(--safe-bottom, 0px)) !important;
    z-index: auto !important;
  }

  .nav-foot__toggle {
    width: min(720px, 100%);
    margin: 0 auto;
  }

  .app-nav {
    overflow-y: auto !important;
    overflow-x: hidden !important;
    -webkit-overflow-scrolling: touch !important;
    overscroll-behavior: contain !important;

    padding-bottom: calc(4px + var(--safe-bottom, 0px) + 2px) !important;
    min-height: 0 !important;
  }

  .app-workspace,
  .app-frame,
  .app-frame-inner {
    min-height: 0 !important;
  }

  .app-nav,
  .app-workspace,
  .app-frame,
  .app-frame-inner {
    overflow-x: visible !important;
  }
}

@media (max-width: 380px), (max-height: 640px) {
  .nav-foot__toggle {
    padding: 6px 9px !important;
    border-radius: 13px !important;
  }
  .nav-foot__badge {
    width: 26px !important;
    height: 26px !important;
  }
  .nav-foot__summary {
    font-size: 9px !important;
    line-height: 1.08 !important;
  }
  .nav-foot__chev {
    padding: 2px 5px !important;
    font-size: 7.75px !important;
  }
}

/* ─────────────────────────────────────────────────────────────
   13) Eternal KaiKlok Popover — TRUE FULLSCREEN + HUGE STAGE
   (Single source of truth; X is always clickable)
   ───────────────────────────────────────────────────────────── */

.klock-pop {
  position: fixed;
  inset: 0;
  z-index: 999999;
  display: grid;
  place-items: stretch;
  padding: 0;

  width: 100vw;
  height: 100vh;

  background: radial-gradient(
      1400px 900px at 18% 8%,
      rgba(255, 220, 140, 0.18),
      transparent 64%
    ),
    radial-gradient(
      1200px 820px at 82% 16%,
      rgba(120, 220, 255, 0.16),
      transparent 62%
    ),
    radial-gradient(
      900px 700px at 50% 110%,
      rgba(190, 130, 255, 0.1),
      transparent 60%
    ),
    rgba(2, 4, 8, 0.72);

  backdrop-filter: blur(14px);
  -webkit-backdrop-filter: blur(14px);

  overscroll-behavior: contain;
  isolation: isolate;

  contain: layout paint;
  transform: translateZ(0);
  backface-visibility: hidden;
}
@supports (height: 100dvh) {
  .klock-pop {
    height: 100dvh;
  }
}

.klock-pop__panel {
  position: relative;
  width: 100%;
  height: 100%;
  border-radius: 0;
  overflow: hidden;

  border: 1px solid rgba(255, 255, 255, 0.1);

  box-shadow: inset 0 0 0 1px rgba(255, 216, 120, 0.1),
    inset 0 0 0 2px rgba(120, 220, 255, 0.06), 0 40px 120px rgba(0, 0, 0, 0.55);

  background: radial-gradient(
      1600px 900px at 12% 6%,
      rgba(255, 210, 120, 0.16),
      transparent 68%
    ),
    radial-gradient(
      1400px 900px at 88% 10%,
      rgba(120, 220, 255, 0.12),
      transparent 66%
    ),
    linear-gradient(180deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.02));

  contain: layout paint;
  transform: translateZ(0);
  backface-visibility: hidden;
}

/* breath shimmer layer — PERF: opacity/transform only */
.klock-pop__panel::before {
  content: "";
  position: absolute;
  inset: -25%;
  background: radial-gradient(
      closest-side at 30% 30%,
      rgba(255, 231, 160, 0.16),
      transparent 62%
    ),
    radial-gradient(
      closest-side at 70% 40%,
      rgba(120, 220, 255, 0.12),
      transparent 60%
    );
  pointer-events: none;
  opacity: 0.9;
  transform: translateZ(0);
  animation: klock-breathe var(--klock-breath, var(--breath-s)) ease-in-out infinite;
  will-change: transform, opacity;
}

/* ultra-light rune-grid / glass grain layer */
.klock-pop__panel::after {
  content: "";
  position: absolute;
  inset: 0;
  pointer-events: none;
  opacity: 0.35;
  background: linear-gradient(transparent, rgba(255, 255, 255, 0.05)),
    repeating-linear-gradient(
      0deg,
      rgba(255, 255, 255, 0.05) 0 1px,
      transparent 1px 36px
    ),
    repeating-linear-gradient(
      90deg,
      rgba(255, 255, 255, 0.04) 0 1px,
      transparent 1px 44px
    );
  mix-blend-mode: overlay;
}

@keyframes klock-breathe {
  0% {
    transform: translate3d(0, 0, 0) scale(1);
    opacity: 0.82;
  }
  50% {
    transform: translate3d(0, -1.2%, 0) scale(1.03);
    opacity: 0.98;
  }
  100% {
    transform: translate3d(0, 0, 0) scale(1);
    opacity: 0.86;
  }
}

/* ✅ CLOSE BUTTON (FIXED): always above body/stage */
.klock-pop__close {
  position: absolute;
  top: calc(14px + env(safe-area-inset-top, 0px));
  right: calc(14px + env(safe-area-inset-right, 0px));

  width: 54px;
  height: 54px;
  border-radius: 999px;

  display: grid;
  place-items: center;

  cursor: pointer;
  user-select: none;
  touch-action: manipulation;
  -webkit-tap-highlight-color: rgba(255, 225, 150, 0.12);

  border: 1px solid var(--klock-border-strong, rgba(255, 231, 160, 0.62));
  background: rgba(8, 12, 20, 0.46);
  color: rgba(240, 246, 255, 0.96);

  box-shadow: 0 18px 60px rgba(0, 0, 0, 0.55),
    0 0 0 1px rgba(255, 255, 255, 0.1) inset;

  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);

  z-index: 50;
  transform: translateZ(0);
}
.klock-pop__close:focus-visible {
  outline: none;
  box-shadow: var(--klock-ring, 0 0 0 2px rgba(255, 225, 150, 0.22)),
    0 18px 60px rgba(0, 0, 0, 0.55);
}

/* BODY */
.klock-pop__body {
  position: relative;
  z-index: 1;
  height: 100%;
  overflow: hidden;
  padding: 0;

  display: flex;
  align-items: center;
  justify-content: center;
}

.klock-stage {
  height: 100%;
  width: 100%;
  display: grid;
  place-items: center;

  padding: calc(18px + env(safe-area-inset-top, 0px))
    calc(18px + env(safe-area-inset-right, 0px))
    calc(18px + env(safe-area-inset-bottom, 0px))
    calc(18px + env(safe-area-inset-left, 0px));
}

.klock-stage__inner {
  width: min(98vmin, 1280px);
  height: min(98vmin, 1280px);
  aspect-ratio: 1 / 1;

  display: grid;
  place-items: center;

  margin: 0 auto;

  filter: drop-shadow(0 30px 90px rgba(0, 0, 0, 0.55));
}

.klock-stage__inner > * {
  width: 100% !important;
  height: 100% !important;
  max-width: none !important;
  max-height: none !important;
  margin: 0 !important;
}
.klock-stage__inner :where(svg, canvas, img) {
  width: 100% !important;
  height: 100% !important;
  max-width: none !important;
  max-height: none !important;
  display: block;
}
.klock-stage__inner :where(.wrap, .container, .root) {
  height: 100% !important;
}

@media (max-width: 720px) {
  .klock-stage {
    padding: calc(12px + env(safe-area-inset-top, 0px))
      calc(12px + env(safe-area-inset-right, 0px))
      calc(12px + env(safe-area-inset-bottom, 0px))
      calc(12px + env(safe-area-inset-left, 0px));
  }
  .klock-stage__inner {
    width: min(98vmin, 1280px);
    height: min(98vmin, 1280px);
  }
}

.klock-pop .kai-klock-shell {
  max-width: none;
  width: clamp(360px, 88vmin, 1400px);
}

@media (prefers-reduced-motion: reduce) {
  .klock-pop__panel::before {
    animation: none;
  }
}

/* ─────────────────────────────────────────────
   14) Kai-Klok popover (Atlantean glass) — KaiStatus parity
   ───────────────────────────────────────────── */

.kk-pop {
  position: fixed;
  inset: 0;
  z-index: 999999; /* raised so it can’t ever sit behind anything */
  display: grid;
  place-items: center;
  padding: max(14px, env(safe-area-inset-top, 0px))
    max(12px, env(safe-area-inset-right, 0px))
    max(14px, env(safe-area-inset-bottom, 0px))
    max(12px, env(safe-area-inset-left, 0px));

  contain: layout paint;
  transform: translateZ(0);
  backface-visibility: hidden;
}

.kk-pop__backdrop {
  position: absolute;
  inset: 0;
  border: 0;
  background: radial-gradient(
      1200px 700px at 30% 10%,
      rgba(120, 220, 255, 0.14),
      rgba(0, 0, 0, 0.72) 55%,
      rgba(0, 0, 0, 0.86)
    );
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
}

.kk-pop__panel {
  position: relative;
  width: min(520px, 92vw);
  border-radius: 26px;
  border: 1px solid rgba(255, 255, 255, 0.14);
  background: linear-gradient(
        180deg,
        rgba(255, 255, 255, 0.08),
        rgba(255, 255, 255, 0.03)
      )
      padding-box,
    radial-gradient(
        1200px 500px at 20% 0%,
        rgba(255, 220, 120, 0.18),
        rgba(120, 220, 255, 0.12),
        transparent 70%
      )
      border-box;
  box-shadow: 0 22px 80px rgba(0, 0, 0, 0.55),
    0 0 0 1px rgba(255, 255, 255, 0.06) inset;
  overflow: hidden;

  /* instant open */
  transform: translateZ(0);
  backface-visibility: hidden;
  contain: layout paint;
  will-change: transform, opacity;
}

.kk-pop__head {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 14px 8px;
}

.kk-pop__title {
  font-weight: 900;
  letter-spacing: 0.3px;
  color: rgba(240, 246, 255, 0.96);
  text-shadow: 0 0 18px rgba(255, 220, 120, 0.18);
}

.kk-pop__close {
  border: 0;
  border-radius: 12px;
  padding: 8px 10px;
  background: rgba(255, 255, 255, 0.06);
  color: rgba(240, 246, 255, 0.92);
  cursor: pointer;
  font-weight: 700;
}
.kk-pop__close:hover {
  background: rgba(255, 255, 255, 0.1);
}

.kk-pop__meta {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  padding: 0 14px 10px;
}

.kk-pop__pill {
  font-size: 12px;
  padding: 6px 10px;
  border-radius: 999px;
  border: 1px solid rgba(255, 255, 255, 0.12);
  background: rgba(0, 0, 0, 0.22);
  color: rgba(230, 240, 255, 0.92);
}

.kk-pop__dial {
  padding: 10px 14px 14px;
  display: grid;
  place-items: center;
}

/* PERF: gentle transform/opacity only */
.kk-pop__dial > * {
  width: min(360px, 70vw);
  max-width: 360px;
  animation: kk-dial-breath var(--breath-s) ease-in-out infinite;
  transform-origin: 50% 50%;
  will-change: transform, opacity;
}

@keyframes kk-dial-breath {
  0%,
  100% {
    transform: translateZ(0) scale(1);
    opacity: 0.98;
  }
  50% {
    transform: translateZ(0) scale(1.02);
    opacity: 1;
  }
}

.kk-pop__foot {
  padding: 0 14px 14px;
  display: flex;
  justify-content: center;
}

.kk-pop__hint {
  font-size: 12px;
  color: rgba(198, 212, 235, 0.78);
  text-align: center;
}

@media (prefers-reduced-motion: reduce) {
  .kk-pop__dial > * {
    animation: none;
  }
}
/* ─────────────────────────────────────────────────────────────
   Footer: FORCE single-row (no wrap) + auto-shrink typography
────────────────────────────────────────────────────────────── */
.panel-foot{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;

  flex-wrap:nowrap;         /* never wrap */
  white-space:nowrap;       /* never wrap */

  /* shrink on small screens instead of wrapping */
  font-size:clamp(8px, 2.15vw, 12px);
  line-height:1;
  overflow:visible;
}

.panel-foot__left{
  display:flex;
  align-items:center;
  gap:6px;
  flex-wrap:nowrap;         /* never wrap */
  white-space:nowrap;
  min-width:0;
  overflow:visible;
}

.panel-foot__right{
  flex:0 0 auto;
  white-space:nowrap;
}

/* ─────────────────────────────────────────────────────────────
   DNS copy chip — ATLANTEAN BREATH (thin, minimal, insane)
   - Keeps height razor-thin
   - No width jump when icon swaps
   - "Copied" toast floats (no footer reflow)
   - Breath cadence locked to 5.236s
────────────────────────────────────────────────────────────── */

.dns-copy{
  position:relative;
  display:inline-flex;
  align-items:center;
  gap:5px;

  padding:0 6px;
  min-height:16px;
  border-radius:999px;
  line-height:1;

  /* Neon-glass ritual palette */
  --kai-gold: 255, 213, 74;     /* golden breath */
  --kai-neon: 70, 211, 255;     /* atlantean cyan */
  --kai-violet: 193, 139, 255;  /* crown tint */
  --kai-glass: 255, 255, 255;

  font-size:inherit;
  letter-spacing:-0.01em;
  font-variant-numeric:tabular-nums;

  /* Gradient border without changing box model */
  border:1px solid transparent;
  background:
    /* inner glass */
    radial-gradient(120% 220% at 15% 40%,
      rgba(var(--kai-gold), 0.14), transparent 55%
    ),
    radial-gradient(120% 220% at 85% 60%,
      rgba(var(--kai-neon), 0.12), transparent 55%
    ),
    rgba(var(--kai-glass), 0.028) padding-box,
    /* border aura */
    linear-gradient(90deg,
      rgba(var(--kai-gold), 0.45),
      rgba(var(--kai-neon), 0.34),
      rgba(var(--kai-violet), 0.30)
    ) border-box;

  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);

  color: inherit;
  opacity:0.92;
  cursor:pointer;
  user-select:none;
  -webkit-user-select:none;
  -webkit-tap-highlight-color:transparent;

  /* Ritual glow (subtle at rest) */
  box-shadow:
    0 0 0 1px rgba(255,255,255,0.06),
    0 8px 22px rgba(0,0,0,0.18),
    0 0 14px rgba(var(--kai-gold), 0.10),
    0 0 16px rgba(var(--kai-neon), 0.08);

  transition:
    transform 120ms ease,
    opacity 140ms ease,
    box-shadow 180ms ease,
    background 180ms ease,
    filter 180ms ease;

  /* Breath (Kai cadence) */
  animation: dns-breath 5.236s ease-in-out infinite;
  will-change: box-shadow, filter, transform;
}

.dns-copy:hover{
  opacity:1;
  filter: brightness(1.06);
  box-shadow:
    0 0 0 1px rgba(255,255,255,0.08),
    0 10px 26px rgba(0,0,0,0.20),
    0 0 18px rgba(var(--kai-gold), 0.14),
    0 0 20px rgba(var(--kai-neon), 0.11);
}

.dns-copy:active{
  transform: translateY(0.5px) scale(0.995);
}

.dns-copy:focus-visible{
  outline:2px solid rgba(var(--kai-neon), 0.28);
  outline-offset:2px;
}

/* ICON — fixed width so swapping ⧉ → ✓ never changes chip width */
.dns-copy::before{
  content:"⧉";
  display:inline-flex;
  align-items:center;
  justify-content:center;
  width:10px;                 /* <- prevents width jump */
  opacity:0.62;
  font-size:0.95em;
  line-height:1;
  transform: translateY(-0.5px);
  text-shadow:
    0 0 10px rgba(var(--kai-neon), 0.18),
    0 0 10px rgba(var(--kai-gold), 0.14);
}

/* REMEMBERED toast — absolute, so it never reflows footer */
.dns-copy::after{
  content:"Remembered";
  position:absolute;
  left:50%;
  bottom:calc(100% + 6px);
  transform:translateX(-50%) translateY(4px);
  pointer-events:none;

  padding:2px 7px;
  border-radius:999px;

  font-size:0.9em;
  line-height:1;
  letter-spacing:0;

  border:1px solid rgba(255,255,255,0.14);
  background:
    radial-gradient(140% 180% at 20% 30%,
      rgba(var(--kai-gold), 0.22), transparent 60%
    ),
    rgba(0,0,0,0.46);

  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);

  opacity:0;
  box-shadow:
    0 0 0 1px rgba(255,255,255,0.05),
    0 10px 26px rgba(0,0,0,0.22),
    0 0 18px rgba(var(--kai-gold), 0.12),
    0 0 18px rgba(var(--kai-neon), 0.10);

  transition: opacity 140ms ease, transform 140ms ease;
}

/* COPIED STATE — unmistakable but still minimal */
.dns-copy.is-copied,
.dns-copy[data-copied="1"]{
  opacity:1;
  filter: brightness(1.08);
  box-shadow:
    0 0 0 1px rgba(255,255,255,0.09),
    0 10px 28px rgba(0,0,0,0.22),
    0 0 22px rgba(var(--kai-gold), 0.18),
    0 0 24px rgba(var(--kai-neon), 0.14);
}

/* swap icon to checkmark (same width) */
.dns-copy.is-copied::before,
.dns-copy[data-copied="1"]::before{
  content:"✓";
  opacity:0.92;
  text-shadow:
    0 0 12px rgba(var(--kai-gold), 0.22),
    0 0 14px rgba(var(--kai-neon), 0.18);
}

/* show toast */
.dns-copy.is-copied::after,
.dns-copy[data-copied="1"]::after{
  opacity:1;
  transform:translateX(-50%) translateY(0);
}

/* Breath animation — subtle “golden inhale / neon exhale” */
@keyframes dns-breath{
  0%, 100%{
    filter: brightness(1.00);
    box-shadow:
      0 0 0 1px rgba(255,255,255,0.06),
      0 8px 22px rgba(0,0,0,0.18),
      0 0 14px rgba(var(--kai-gold), 0.10),
      0 0 16px rgba(var(--kai-neon), 0.08);
  }
  50%{
    filter: brightness(1.05);
    box-shadow:
      0 0 0 1px rgba(255,255,255,0.08),
      0 10px 26px rgba(0,0,0,0.20),
      0 0 18px rgba(var(--kai-gold), 0.16),
      0 0 20px rgba(var(--kai-neon), 0.12);
  }
}

/* Respect reduced motion */
@media (prefers-reduced-motion: reduce){
  .dns-copy{ animation:none; }
}

/* tighter on very small screens (still one row, still readable) */
@media (max-width: 420px){
  .panel-foot{ gap:8px; font-size:clamp(7.5px, 2.35vw, 11px); }
  .panel-foot__left{ gap:5px; }
  .dns-copy{ padding:0 5px; min-height:15px; gap:4px; }
}


/* ─────────────────────────────────────────────────────────────
   PERFORMANCE GATE — auto + optional hard flag
   Auto triggers on:
   - reduced motion / transparency / data
   - slow update devices (when supported)
   Manual trigger:
   - <html data-perf="low">  (recommended for older iPhones / low-end)
───────────────────────────────────────────────────────────── */

/* Manual flag (you can set this from App.tsx for older iPhones) */
html[data-perf="low"] {
  /* cheaper glass: keep vibe, reduce GPU cost */
  --blur-soft: 10px;
  --blur-strong: 12px;

  /* soften expensive halos */
  --shadow-halo: 0 0 0 rgba(0, 0, 0, 0);
}

/* Auto gate (when the OS/browser asks for less) */
@media (prefers-reduced-motion: reduce),
       (prefers-reduced-transparency: reduce),
       (prefers-reduced-data: reduce),
       (update: slow) {

  :root {
    --blur-soft: 10px;
    --blur-strong: 12px;
    --shadow-halo: 0 0 0 rgba(0, 0, 0, 0);
  }

  /* kill the most expensive continuous animations */
  .app-bg-orbit,
  .app-bg-glow,
  .brand__title,
  .brand__subtitle,
  .live-orb {
    animation: none !important;
  }

  /* keep the grid, but reduce blend/overdraw */
  .app-bg-grid {
    mix-blend-mode: normal !important;
    opacity: 0.22 !important;
  }

  /* orbit/glow layers: reduce paint cost */
  .app-bg-orbit {
    filter: blur(24px) !important;
    opacity: 0.35 !important;
  }
  .app-bg-glow {
    filter: blur(20px) !important;
    opacity: 0.38 !important;
  }

  /* sheen overlays can be costly on mobile GPUs */
  .explorer-pop__panel::after,
  .klock-pop__panel::before,
  .explorer-pop__close::before,
  .explorer-pop__close::after {
    animation: none !important;
    opacity: 0.22 !important;
  }

  /* backdrop-filter is a top jank source on older iOS:
     keep glass look by making backgrounds more opaque */
  .app-topbar,
  .app-frame,
  .workspace-topbar,
  .app-nav,
  .app-panel,
  .explorer-pop,
  .explorer-pop__panel,
  .klock-pop,
  .klock-pop__panel,
  .kk-pop__backdrop,
  .kk-pop__panel {
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
  }

  /* compensate: slightly more opaque surfaces (keeps “glass” feel) */
  .app-topbar {
    background: rgba(2, 6, 18, 0.92) !important;
  }
  .app-frame {
    box-shadow: 0 24px 80px rgba(0, 0, 0, 0.68) !important;
  }
  .workspace-topbar,
  .app-nav,
  .app-panel {
    box-shadow: 0 18px 50px rgba(0, 0, 0, 0.6) !important;
  }
}

/* If you manually flag low perf, apply the same heavy-effect limits */
html[data-perf="low"] .app-bg-orbit,
html[data-perf="low"] .app-bg-glow,
html[data-perf="low"] .brand__title,
html[data-perf="low"] .brand__subtitle,
html[data-perf="low"] .live-orb {
  animation: none !important;
}

html[data-perf="low"] .explorer-pop__panel::after,
html[data-perf="low"] .klock-pop__panel::before,
html[data-perf="low"] .explorer-pop__close::before,
html[data-perf="low"] .explorer-pop__close::after {
  animation: none !important;
  opacity: 0.22 !important;
}

html[data-perf="low"] .app-topbar,
html[data-perf="low"] .app-frame,
html[data-perf="low"] .workspace-topbar,
html[data-perf="low"] .app-nav,
html[data-perf="low"] .app-panel,
html[data-perf="low"] .explorer-pop,
html[data-perf="low"] .explorer-pop__panel,
html[data-perf="low"] .klock-pop,
html[data-perf="low"] .klock-pop__panel,
html[data-perf="low"] .kk-pop__backdrop,
html[data-perf="low"] .kk-pop__panel {
  backdrop-filter: none !important;
  -webkit-backdrop-filter: none !important;
}


/* ─────────────────────────────────────────────────────────────
   ZERO-LAG PORTAL POLICY — targeted (no heavy universal selector)
───────────────────────────────────────────────────────────── */
:where(
  .explorer-pop,
  .klock-pop,
  .kk-pop,
  .explorer-pop__panel,
  .klock-pop__panel,
  .kk-pop__panel,
  .explorer-pop__close,
  .klock-pop__close,
  .kk-pop__close
) {
  animation-delay: 0ms !important;
  transition-delay: 0ms !important;
}
/* ─────────────────────────────────────────────────────────────
   v28.6.x — KAI PILL: ALWAYS ONE LINE (auto-shrink on small)
   - never wraps
   - text scales down smoothly instead of stacking
   - pill hugs content + stays right-justified
────────────────────────────────────────────────────────────── */

.topbar-live{
  min-width: 0 !important;
  width: max-content;
  max-width: 76vw;

  display: inline-flex;
  align-items: center;
  justify-content: flex-end;

  /* padding + gap also shrink on small screens */
  padding: clamp(4px, 1.2vw, 6px) clamp(8px, 2.2vw, 12px);
  gap: clamp(6px, 1.8vw, 12px);
  min-height: 38px;
}

.live-scroll{
  display: inline-flex;
  align-items: center;
  min-width: 0;
  max-width: 100%;
  overflow-x: auto;
  overflow-y: hidden;
  -webkit-overflow-scrolling: touch;
  scrollbar-width: thin;
  scroll-behavior: smooth;
  padding-bottom: 2px; /* keeps scrollbar off text */
}
.live-scroll::-webkit-scrollbar{
  height: 6px;
}
.live-scroll::-webkit-scrollbar-thumb{
  background: rgba(120,220,255,0.35);
  border-radius: 999px;
}
.live-scroll::-webkit-scrollbar-track{
  background: transparent;
}

.live-orb{ flex: 0 0 auto; }

.live-text{
  display: inline-flex;
  flex-direction: row !important;
  align-items: baseline !important;
  gap: clamp(6px, 1.8vw, 12px);

  white-space: nowrap;      /* hard lock: one line */
  line-height: 1;
  min-width: 0;             /* allow shrink */
  overflow: hidden;         /* safety: never break layout */
}

/* One typographic system + tabular numerics = baseline stays perfect */
.live-title,
.live-meta{
  display: inline-flex;
  align-items: baseline;
  line-height: 1;
  white-space: nowrap;

  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, "SF Mono", Consolas,
    "Liberation Mono", "Courier New", monospace;
  font-variant-numeric: tabular-nums;
  text-transform: uppercase;
}

/* ✅ Auto-shrink text size + spacing as viewport shrinks */
.live-title{
  font-size: clamp(10px, 2.2vw, 13px);
  letter-spacing: clamp(0.08em, 0.6vw, 0.14em);
}

.live-meta{
  font-size: clamp(9px, 2.0vw, 12px);
  letter-spacing: clamp(0.06em, 0.55vw, 0.12em);
  opacity: 0.86;
}

/* Resist squeezing by letting the pill scroll instead of wrapping */
@media (max-width: 560px){
  .topbar-live{ max-width: 84vw; }
  .live-scroll{ margin-right: -2px; }
}

/* If meta still gets long, it trims (still ONE line) */
.live-meta{
  min-width: 0;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* Ultra-tight phones: tighten spacing more */
@media (max-width: 420px){
  .topbar-live{ max-width: 70vw; }
  .topbar-live{ gap: 8px; }
  .live-text{ gap: 8px; }
}
/* ──────────────────────────────────────────────────────────────────────────────
   v28.7.x — MOBILE HEIGHT ALLOCATION (Atrium stays tight; Verifier owns the screen)
   FIXES:
   ✅ Removes the “dead air” under Sovereign Writ on mobile PWA
   ✅ Stops grid/flex stretching that makes Atrium taller than its content
   ✅ Verifier panel gets the remaining height (moves up + feels bigger)
   ✅ Nav still caps + scrolls if content truly overflows
────────────────────────────────────────────────────────────────────────────── */

:root{
  /* Cap Atrium (nav) so Verifier (panel) owns the rest of the viewport */
  --nav-max-h-mobile: clamp(220px, 40svh, 380px);

  /* Keep Sovereign Writ slim inside Atrium */
  --writ-max-h-mobile: clamp(72px, 14svh, 140px);
}

/* Fallback if svh isn’t supported */
@supports not (height: 1svh){
  :root{
    --nav-max-h-mobile: clamp(220px, 40vh, 380px);
    --writ-max-h-mobile: clamp(72px, 14vh, 140px);
  }
}

/* ✅ New wrapper slot (keeps same function; prevents flex math from “eating” height) */
.nav-writ-slot{
  flex: 0 0 auto;
  min-height: 0;
  width: 100%;
  min-width: 0;

  border-top: 1px solid rgba(255,255,255,0.06);
  background: linear-gradient(
    180deg,
    rgba(10, 20, 48, 0.00),
    rgba(10, 20, 48, 0.18)
  );
}

/* ─────────────────────────────────────────────────────────────
   MOBILE: Atrium must NOT stretch; Panel must.
───────────────────────────────────────────────────────────── */
@media (max-width: 980px){

  /* Force the nav row to size to content (prevents “stretch tall” Atrium) */
  .app-workspace{
    grid-template-rows: auto max-content minmax(0, 1fr);
  }

  /* CRITICAL: stop grid stretch so Atrium doesn’t become taller than its content */
  .app-nav{
    align-self: start;            /* <- kills dead air under Sovereign Writ */
    height: auto;                 /* content-height */
    max-height: var(--nav-max-h-mobile);

    overflow-y: auto !important;
    overflow-x: hidden !important;
    -webkit-overflow-scrolling: touch !important;
    overscroll-behavior: contain !important;

    /* Remove compounded safe-area padding that inflates blank space */
    padding-bottom: 0 !important;
  }

  /* Tiles row should not inject safe-bottom padding (Atrium is NOT bottom-of-screen) */
  .nav-list{
    flex: 0 0 auto;
    padding-bottom: 0.7rem !important;
  }

  /* Sovereign Writ stays slim; scrolls inside itself if it truly overflows */
  .nav-writ-slot{
    max-height: var(--writ-max-h-mobile);
    overflow: auto;
    -webkit-overflow-scrolling: touch;
    overscroll-behavior: contain;
  }

  /* Kill any “push-to-bottom” + extra bottom spacing inside the Writ */
  .nav-writ-slot .nav-foot{
    margin-top: 0 !important;
    margin-bottom: 0 !important;

    /* keep it tight (no safe-area here) */
    padding: 0.68rem 0.9rem 0.78rem !important;
  }

  .nav-writ-slot .nav-foot__line{
    font-size: 0.74rem;
    line-height: 1.25;
  }

  /* Ensure Verifier panel is the one that expands */
  .app-panel{
    align-self: stretch;
    min-height: 0;
    height: 100%;
  }
}


/* ──────────────────────────────────────────────────────────────────────────────
   v28.7.x — FINISH: Nav Writ Slot parity + no double borders + desktop anchor
   - Keeps your mobile caps/behavior exactly
   - Restores “Writ at bottom” feel on desktop WITHOUT reintroducing mobile dead air
   - Prevents double border/background now that .nav-foot lives inside .nav-writ-slot
────────────────────────────────────────────────────────────────────────────── */

/* Writ wrapper should own the rim + tint; inner .nav-foot becomes “content only” */
.nav-writ-slot{
  display:flex;
  flex-direction:column;
  min-height:0;
}

.nav-writ-slot .nav-foot{
  margin-top:0;                 /* kill legacy push-to-bottom behavior */
  border-top:0;                 /* wrapper already provides the top rim */
  background:transparent;       /* wrapper already provides the tint */
}

/* Desktop/tablet: keep Atrium full height, but pin Writ to the bottom cleanly */
@media (min-width: 981px){
  .nav-writ-slot{
    margin-top:auto;            /* “Sovereign Writ” docks at bottom again */
  }

  /* Optional: let the nav list be the flexible middle (no hidden overflow) */
  .nav-list{
    flex: 1 1 auto;
    min-height: 0;

    overflow: auto;             /* only scroll if it truly needs it */
    overscroll-behavior: contain;
    -webkit-overflow-scrolling: touch;

    scrollbar-width: thin;
    scrollbar-color: rgba(170, 241, 255, 0.18) transparent;
  }
  .nav-list::-webkit-scrollbar{ width:10px; }
  .nav-list::-webkit-scrollbar-track{ background:transparent; }
  .nav-list::-webkit-scrollbar-thumb{
    background: rgba(170, 241, 255, 0.18);
    border: 2px solid transparent;
    background-clip: padding-box;
    border-radius: 999px;
  }
  .nav-list::-webkit-scrollbar-thumb:hover{
    background: rgba(170, 241, 255, 0.28);
  }
}

/* Mobile: ensure the wrapper NEVER “pushes” (your cap logic stays in control) */
@media (max-width: 980px){
  .nav-writ-slot{
    margin-top: 0;              /* hard stop: no auto spacing injection */
  }
}

/* ─────────────────────────────────────────────────────────────
   SHORT SCREENS: tighten caps so Verifier stays usable
───────────────────────────────────────────────────────────── */
@media (max-width: 980px) and (max-height: 740px){
  :root{
    --nav-max-h-mobile: clamp(190px, 36svh, 320px);
    --writ-max-h-mobile: clamp(64px, 12svh, 120px);
  }
}
@supports not (height: 1svh){
  @media (max-width: 980px) and (max-height: 740px){
    :root{
      --nav-max-h-mobile: clamp(190px, 36vh, 320px);
      --writ-max-h-mobile: clamp(64px, 12vh, 120px);
    }
  }
}

/* ─────────────────────────────────────────────────────────────
   ROOMY DESKTOP/TABLET: nav shouldn’t stretch tall; panel owns space
───────────────────────────────────────────────────────────── */
@media (min-width: 981px){
  .app-shell[data-roomy="1"] .app-nav{
    height: auto;
    max-height: none;
    align-self: start;
  }
}
/* ─────────────────────────────────────────────────────────────
   KAI SPLASH SCREEN — full viewport, centered, fade out on load
   - circular badge with halos + rays
   - subtle background grid
   - no blur boxes (performance safe)
────────────────────────────────────────────────────────────── */ 
.kai-splash{
  position: fixed;
  inset: 0;
  z-index: 2147483646;
  display: grid;
  place-items: center;

  width: 100dvw;
  height: 100dvh;

  padding:
    env(safe-area-inset-top)
    env(safe-area-inset-right)
    env(safe-area-inset-bottom)
    env(safe-area-inset-left);

overflow: hidden; /* iOS/WebKit: prevents square tile artifacts */

  background:
    radial-gradient(900px circle at 50% 42%, rgba(120, 210, 255, 0.12), rgba(0,0,0,0) 62%),
    radial-gradient(1200px circle at 50% 55%, rgba(170, 120, 255, 0.10), rgba(0,0,0,0) 70%),
    var(--bg-0, #040f24);

  -webkit-font-smoothing: antialiased;
  isolation: isolate;
}

.kai-splash[data-state="show"]{ opacity: 1; }
.kai-splash[data-state="fade"]{
  opacity: 0;
  transition: opacity 260ms ease;
  pointer-events: none;
}
.kai-splash[data-state="hidden"]{
  opacity: 0;
  pointer-events: none;
}

@media (prefers-reduced-motion: reduce){
  .kai-splash[data-state="fade"]{ transition-duration: 140ms; }
}

/* subtle background grid (safe, no blur boxes) */
.kai-splash__grid{
  position: absolute;
  inset: 0;
  opacity: 0.18;
  background-image:
    linear-gradient(to right, rgba(255,255,255,0.055) 1px, transparent 1px),
    linear-gradient(to bottom, rgba(255,255,255,0.055) 1px, transparent 1px);
  background-size: 34px 34px;
  mask-image: radial-gradient(circle at 50% 45%, #000 0 55%, transparent 72%);
  pointer-events: none;
}

.kai-splash__content{
  position: relative;
  display: grid;
  place-items: center;
  width: min(84vw, 320px);
  aspect-ratio: 1;
}

.kai-splash__badge{
  position: relative;
  width: clamp(160px, 44vw, 240px);
  aspect-ratio: 1;
  border-radius: 9999px;
  display: grid;
  place-items: center;
  isolation: isolate;
}

/* ✅ ALWAYS CIRCULAR — no rectangles, no blur bounding boxes */
.kai-splash__badge-halo,
.kai-splash__badge-glow{
  position: absolute;
  left: 50%;
  top: 50%;
  border-radius: 9999px;
  transform: translate(-50%, -50%) translateZ(0);
  pointer-events: none;
}

/* outer halo */
.kai-splash__badge-halo{
  width: 138%;
  height: 138%;
  opacity: 0.85;
  background: radial-gradient(circle,
    rgba(120, 210, 255, 0.26) 0%,
    rgba(120, 210, 255, 0.10) 34%,
    rgba(0,0,0,0) 68%);
}

/* tighter inner glow (still circular) */
.kai-splash__badge-glow{
  width: 110%;
  height: 110%;
  opacity: 0.65;
  background: radial-gradient(circle,
    rgba(170, 120, 255, 0.22) 0%,
    rgba(170, 120, 255, 0.08) 38%,
    rgba(0,0,0,0) 70%);
  mix-blend-mode: screen;
}

/* rays ring */
.kai-splash__rays{
  position: absolute;
  inset: -12%;
  border-radius: 9999px;
  opacity: 0.35;
  background:
    conic-gradient(
      from 0deg,
      rgba(255,255,255,0.18),
      rgba(255,255,255,0) 14%,
      rgba(255,255,255,0.12) 28%,
      rgba(255,255,255,0) 42%,
      rgba(255,255,255,0.16) 56%,
      rgba(255,255,255,0) 70%,
      rgba(255,255,255,0.12) 84%,
      rgba(255,255,255,0) 100%
    );
  mask-image: radial-gradient(circle, transparent 0 55%, #000 60% 72%, transparent 78%);
}

/* core is a perfect circle (no box glow here) */
.kai-splash__badge-core{
  position: relative;
  width: 56%;
  aspect-ratio: 1;
  border-radius: 9999px;
  display: grid;
  place-items: center;
  background:
    radial-gradient(circle at 30% 30%, rgba(255,255,255,0.12), rgba(255,255,255,0.03) 50%, rgba(0,0,0,0.20) 100%);
  border: 1px solid rgba(255,255,255,0.14);
  box-shadow: 0 10px 30px rgba(0,0,0,0.28);
}

/* ✅ THIS is the key: glow hugs the SVG alpha, not its box */
.kai-splash__phi{
  width: 62%;
  height: auto;
  display: block;
  transform: translateZ(0);
  filter:
    drop-shadow(0 0 10px rgba(120, 210, 255, 0.55))
    drop-shadow(0 0 22px rgba(170, 120, 255, 0.22));
}

/* tiny orb + shine (both circular) */
.kai-splash__badge-orb{
  position: absolute;
  width: 22%;
  aspect-ratio: 1;
  border-radius: 9999px;
  left: 62%;
  top: 26%;
  background: radial-gradient(circle, rgba(255,255,255,0.22), rgba(255,255,255,0) 62%);
  opacity: 0.9;
}

.kai-splash__badge-core-shine{
  position: absolute;
  inset: 0;
  border-radius: 9999px;
  background: radial-gradient(circle at 30% 22%, rgba(255,255,255,0.22), rgba(255,255,255,0) 58%);
  pointer-events: none;
}

/* rings */
.kai-splash__ring{
  position: absolute;
  inset: -6%;
  border-radius: 9999px;
  border: 1px solid rgba(255,255,255,0.14);
  opacity: 0.55;
}
.kai-splash__ring--inner{
  inset: 6%;
  opacity: 0.45;
  border-color: rgba(255,255,255,0.10);
}

/* flare (circular + masked so it can’t square out) */
.kai-splash__flare{
  position: absolute;
  inset: -18%;
  border-radius: 9999px;
  opacity: 0.35;
  background: radial-gradient(circle at 50% 45%, rgba(255,255,255,0.16), rgba(0,0,0,0) 62%);
  mask-image: radial-gradient(circle, #000 0 62%, transparent 78%);
}

@media (prefers-reduced-motion: no-preference){
  .kai-splash__rays{
    animation: kai-splash-spin 3.6s linear infinite;
  }
  .kai-splash__badge-glow{
    animation: kai-splash-breathe 2.2s ease-in-out infinite;
  }
}
@keyframes kai-splash-spin{
  to{ transform: translateZ(0) rotate(360deg); }
}
@keyframes kai-splash-breathe{
  0%,100%{ opacity: 0.55; }
  50%{ opacity: 0.78; }
}

/* ─────────────────────────────────────────────────────────────
   MOBILE SAFARI HARDENING — removes square compositing artifacts
   (paste at end of file)
────────────────────────────────────────────────────────────── */

/* Make masks behave correctly on WebKit + prevent any tiling edges */
.kai-splash__grid{
  -webkit-mask-image: radial-gradient(circle at 50% 45%, #000 0 55%, transparent 72%);
  -webkit-mask-repeat: no-repeat;
  -webkit-mask-size: 100% 100%;
          mask-repeat: no-repeat;
          mask-size: 100% 100%;
}

.kai-splash__rays{
  overflow: hidden;                 /* conic-gradient must be hard clipped */
  -webkit-mask-image: radial-gradient(circle, transparent 0 55%, #000 60% 72%, transparent 78%);
  -webkit-mask-repeat: no-repeat;
  -webkit-mask-size: 100% 100%;
          mask-repeat: no-repeat;
          mask-size: 100% 100%;

  transform: translateZ(0);
  will-change: transform;
}

.kai-splash__flare{
  overflow: hidden;                 /* radial flare must be hard clipped */
  -webkit-mask-image: radial-gradient(circle, #000 0 62%, transparent 78%);
  -webkit-mask-repeat: no-repeat;
  -webkit-mask-size: 100% 100%;
          mask-repeat: no-repeat;
          mask-size: 100% 100%;

  transform: translateZ(0);
}

/* iOS/WebKit specific: blend-mode + svg filters are the #1 source of square tiles */
@supports (-webkit-touch-callout: none){
  .kai-splash__badge-glow{
    mix-blend-mode: normal;         /* kills the square “screen blend” tile */
  }

  .kai-splash__phi{
    -webkit-filter: none !important; /* kills square filter backing surface */
            filter: none !important;
  }

  /* replace lost svg glow with safe circular core glow */
  .kai-splash__badge-core{
    box-shadow:
      0 10px 30px rgba(0,0,0,0.28),
      0 0 18px rgba(120, 210, 255, 0.34),
      0 0 44px rgba(170, 120, 255, 0.18);
  }
}
