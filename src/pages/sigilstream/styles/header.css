/* ─────────────────────────────────────────────────────────────
   SigilStreamRoot — Header + Shell
   Targets:
     <main class="sf" data-weekday="Kaelith" data-chakra="Third Eye" style="--sigil-tint: ...">
       <header class="sf-head"><h1>Memory Stream</h1></header>

   Goals:
   - Atlantean krystal glass, aurora rim, breath shimmer
   - Weekday + Chakra theming via data-attrs
   - Uses inline style vars (sigilTintStyle) if present:
       --sigil-tint (rgb or rgba)  OR  --sigil-tint-rgb (e.g. "120 190 255")
   - Zero overflow, iOS safe-areas, crisp type
   ───────────────────────────────────────────────────────────── */

/* ====== 0) Root tokens (safe defaults) ====== */
:root{
  --phi: 1.61803398875;
  --pulse-dur: 5.2360679s;

  --bg0: 10, 14, 22;      /* deep night */
  --ink0: 240, 246, 255;  /* near white */
  --muted0: 188, 202, 226;

  --glass: 255,255,255;
  --ring: rgba(255,255,255,0.14);

  /* fallback tint (used if sigilTintStyle missing) */
  --sigil-tint-rgb: 120 190 255; /* space-separated for modern rgb() */
  --sigil-tint: rgba(120,190,255,0.75); /* fallback */
}

/* ====== 1) Main shell (.sf) ====== */
.sf{
  /* let inline style override these if provided */
  --tint-rgb: var(--sigil-tint-rgb);
  --tint: var(--sigil-tint);

  /* derived accents */
  --a1: rgba(var(--tint-rgb), 0.18);
  --a2: rgba(var(--tint-rgb), 0.08);

  --ink: rgba(var(--ink0), 0.96);
  --muted: rgba(var(--muted0), 0.84);

  --r: 26px;
  --padX: clamp(14px, 3.6vw, 20px);
  --padY: clamp(14px, 3.6vw, 20px);

  /* subtle, alive background field */
  background:
    radial-gradient(140% 120% at 12% -12%,
      rgba(255,255,255,0.10),
      rgba(255,255,255,0.00) 58%),
    radial-gradient(130% 160% at 84% 118%,
      rgba(var(--tint-rgb), 0.12),
      rgba(255,255,255,0.00) 62%),
    radial-gradient(120% 180% at 40% 42%,
      rgba(255,255,255,0.05),
      rgba(255,255,255,0.00) 56%),
    linear-gradient(180deg,
      rgba(255,255,255,0.04),
      rgba(255,255,255,0.015)),
    rgb(var(--bg0));

  color: var(--ink);
  min-height: 100dvh; /* modern viewport */
  padding:
    calc(var(--padY) + env(safe-area-inset-top))
    var(--padX)
    calc(var(--padY) + env(safe-area-inset-bottom))
    var(--padX);

  /* keep everything inside safe */
  width: 100%;
  max-width: 100%;
  overflow-x: hidden;

  /* typography */
  -webkit-font-smoothing: antialiased;
  text-rendering: geometricPrecision;

  /* create its own paint layer (faster on mobile) */
  contain: paint;
}

/* ====== 2) Header container (.sf-head) ====== */
.sf-head{
  position: sticky;
  top: 0;
  z-index: 20;

  /* sticky glass bar */
  border-radius: calc(var(--r) + 6px);
  border: 1px solid rgba(255,255,255,0.14);

  padding: clamp(14px, 3.2vw, 18px) clamp(14px, 3.2vw, 18px);
  margin: 0 0 clamp(14px, 3.2vw, 18px) 0;

  /* krystal glass */
  background:
    radial-gradient(120% 170% at 18% 0%,
      rgba(255,255,255,0.10),
      rgba(255,255,255,0.00) 64%),
    radial-gradient(160% 220% at 82% 120%,
      rgba(var(--tint-rgb), 0.16),
      rgba(255,255,255,0.00) 62%),
    linear-gradient(135deg,
      rgba(255,255,255,0.085),
      rgba(255,255,255,0.028));

  box-shadow:
    0 18px 56px rgba(0,0,0,0.52),
    inset 0 1px 0 rgba(255,255,255,0.12);

  backdrop-filter: blur(18px) saturate(1.25);
  -webkit-backdrop-filter: blur(18px) saturate(1.25);

  overflow: hidden;
}

/* aurora rim highlight */
.sf-head::after{
  content:"";
  position:absolute;
  inset: 0;
  pointer-events:none;
  border-radius: inherit;
  background:
    linear-gradient(180deg,
      rgba(255,255,255,0.20),
      rgba(255,255,255,0.04) 32%,
      rgba(0,0,0,0.00) 72%),
    radial-gradient(140% 180% at 50% 0%,
      rgba(var(--tint-rgb), 0.22),
      rgba(255,255,255,0.00) 60%);
  mix-blend-mode: overlay;
  opacity: 0.55;
}

/* breath shimmer sheet (phase-locked) */
.sf-head::before{
  content:"";
  position:absolute;
  inset:-2px;
  pointer-events:none;

  background:
    linear-gradient(115deg,
      rgba(255,255,255,0.00) 0%,
      rgba(255,255,255,0.13) 20%,
      rgba(255,255,255,0.00) 40%,
      rgba(var(--tint-rgb), 0.12) 62%,
      rgba(255,255,255,0.00) 86%);

  opacity: 0.40;
  transform: translate3d(-36%, 0, 0);
  animation: sf-head-shimmer var(--pulse-dur) linear infinite;
}
@keyframes sf-head-shimmer{
  0%   { transform: translate3d(-40%, 0, 0); }
  100% { transform: translate3d( 40%, 0, 0); }
}

/* ====== 3) Title styling (.sf-head h1) ====== */
.sf-head h1{
  margin: 0;
  line-height: 1.06;

  font-weight: 920;
  letter-spacing: 0.01em;

  font-size: clamp(28px, 6.6vw, 42px);

  /* luminous type */
  color: rgba(var(--ink0), 0.98);
  text-shadow:
    0 1px 0 rgba(0,0,0,0.22),
    0 10px 30px rgba(0,0,0,0.38);

  /* gradient ink (subtle) */
  background:
    linear-gradient(180deg,
      rgba(255,255,255,0.98),
      rgba(210,224,245,0.92));
  -webkit-background-clip: text;
  background-clip: text;
  -webkit-text-fill-color: transparent;

  position: relative;
}

/* tiny sigil flare behind title */
.sf-head h1::after{
  content:"";
  position:absolute;
  left: -10px;
  top: 50%;
  width: 54px;
  height: 54px;
  transform: translateY(-50%);
  border-radius: 999px;

  background:
    radial-gradient(circle at 50% 50%,
      rgba(var(--tint-rgb), 0.24),
      rgba(255,255,255,0.00) 66%);
  filter: blur(0.2px);
  opacity: 0.9;
  pointer-events: none;
}

/* ====== 4) Weekday / Chakra theming (data attrs) ====== */
/* Weekday tints (soft modifiers) */
.sf[data-weekday="Solhara"]  { --sigil-tint-rgb: 255 196 120; }
.sf[data-weekday="Aquaris"]  { --sigil-tint-rgb: 120 190 255; }
.sf[data-weekday="Flamora"]  { --sigil-tint-rgb: 255 132 170; }
.sf[data-weekday="Verdari"]  { --sigil-tint-rgb: 120 255 196; }
.sf[data-weekday="Sonari"]   { --sigil-tint-rgb: 250 220 120; }
.sf[data-weekday="Kaelith"]  { --sigil-tint-rgb: 178 150 255; }

/* Chakra tints (override weekday if you want chakra to lead) */
.sf[data-chakra="Root"]         { --sigil-tint-rgb: 255 92 92; }
.sf[data-chakra="Sacral"]       { --sigil-tint-rgb: 255 154 92; }
.sf[data-chakra="Solar Plexus"] { --sigil-tint-rgb: 255 230 92; }
.sf[data-chakra="Heart"]        { --sigil-tint-rgb: 92 255 170; }
.sf[data-chakra="Throat"]       { --sigil-tint-rgb: 92 200 255; }
.sf[data-chakra="Third Eye"]    { --sigil-tint-rgb: 148 120 255; }
.sf[data-chakra="Crown"],
.sf[data-chakra="Krown"]        { --sigil-tint-rgb: 210 200 255; }

/* ====== 5) Sticky safety on iOS + dark bars ====== */
@supports (-webkit-touch-callout: none){
  .sf-head{
    top: env(safe-area-inset-top);
  }
}

/* ====== 6) Motion safety ====== */
@media (prefers-reduced-motion: reduce){
  .sf-head::before{ animation: none !important; }
}

/* ====== 7) Backdrop fallback ====== */
@supports not ((backdrop-filter: blur(1px)) or (-webkit-backdrop-filter: blur(1px))){
  .sf-head{
    background:
      radial-gradient(130% 180% at 18% 0%,
        rgba(255,255,255,0.10),
        rgba(255,255,255,0.00) 62%),
      linear-gradient(135deg,
        rgba(40,52,78,0.84),
        rgba(20,26,40,0.76));
  }
}
