/* src/pages/SigilExplorer.css
   Kairos Keystream Explorer — KRYSTAL ETCH v3 (Atlantean Glass)
   ✅ Mobile scroll fix: viewport is HARD-LOCKED to .sigil-explorer; ONLY .explorer-scroll scrolls.
   - Per-node chakra tint (root/sacral/solar/heart/throat/thirdEye/crown)
   - Etched refraction + caustic drift + micro-noise overlay
   - Breath motion (φ cadence) with reduced-motion compliance
   - Transfer-ready UI polish (Φ send/receive rows, statuses, mobile-safe)
   - Fully scoped to .sigil-explorer
*/

/* ─────────────────────────────────────────────────────────────
   MOBILE BODY-SCROLL LOCK (scoped via :has)
   (extra safety on iOS/Android browsers that still try to scroll the page)
   ───────────────────────────────────────────────────────────── */
@supports selector(:has(*)){
  html:has(.sigil-explorer),
  body:has(.sigil-explorer){
    height: 100%;
    margin: 0;
    overflow: hidden;
    overscroll-behavior: none;
  }
}

/* ─────────────────────────────────────────────────────────────
   ROOT / THEME TOKENS (scoped)
   ───────────────────────────────────────────────────────────── */
.sigil-explorer{
  /* HARD viewport lock (prevents page scroll on mobile) */
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100vh;   /* fallback */
  height: 100svh;  /* stable “small viewport” on mobile */
  overflow: hidden;
  overscroll-behavior: none;

  /* IMPORTANT: ensure the scroll child can actually shrink */
  min-height: 0;
  min-width: 0;

  /* Grid: header + scroll area. minmax(0,1fr) is the mobile scroll fix. */
  display: grid;
  grid-template-rows: auto minmax(0, 1fr);

  /* Ink */
  --sx-text: #ecffff;
  --sx-text-dim: #a9f6ee;

  /* Atlantean triad */
  --sx-accent: #23fff0;
  --sx-accent-2: #b7a3ff;
  --sx-accent-3: #62daff;

  /* Chakra defaults (used if node doesn’t override --sx-chakra) */
  --sx-chakra: var(--sx-accent);
  /* Optional Android/WebView fallback (set per-node via inline style):
     --sx-chakra-rgb: 35,255,240; */

  /* Φ / Transfers */
  --sx-phi: #ffd780;
  --sx-phi-rgb: 255, 215, 128;
  --sx-ok: #63ffb0;
  --sx-ok-rgb: 99, 255, 176;
  --sx-warn: #ffcd4a;
  --sx-warn-rgb: 255, 205, 74;
  --sx-bad: #ff5f7a;
  --sx-bad-rgb: 255, 95, 122;

  /* Kai breath */
  --sx-breath: 5.236s;

  /* Mono */
  --sx-mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;

  /* Background glass */
  --sx-bg: rgba(6, 10, 14, 0.76);
  --sx-bg-tint-top: rgba(14, 30, 36, 0.68);
  --sx-bg-tint-bot: rgba(6, 10, 14, 0.70);

  /* Borders / rings */
  --sx-border: rgba(35, 255, 240, 0.34);
  --sx-border-soft: rgba(255, 255, 255, 0.11);
  --sx-border-strong: rgba(35, 255, 240, 0.66);

  --sx-shadow: 0 30px 80px rgba(0, 0, 0, 0.55),
    inset 0 1px 0 rgba(255, 255, 255, 0.04);
  --sx-shadow-card: 0 18px 40px rgba(0, 0, 0, 0.55);

  --sx-ring: 0 0 0 2px rgba(35, 255, 240, 0.25),
    0 0 0 6px rgba(35, 255, 240, 0.12);

  --sx-radius: 18px;
  --sx-radius-sm: 12px;
  --sx-pad: clamp(10px, 3vw, 18px);
  --sx-maxw: 1100px;

  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial,
    "Apple Color Emoji", "Segoe UI Emoji";
  color: var(--sx-text);

  background:
    radial-gradient(1200px 800px at 50% -10%, rgba(0, 0, 0, 0.64), #000000a6 60%),
    radial-gradient(1200px 800px at 50% 20%, rgba(35, 255, 240, 0.13), transparent 60%),
    radial-gradient(800px 600px at 10% 90%, rgba(98, 218, 255, 0.12), transparent 60%),
    radial-gradient(900px 700px at 90% 80%, rgba(183, 163, 255, 0.12), transparent 60%),
    linear-gradient(180deg, var(--sx-bg-tint-top), var(--sx-bg-tint-bot));

  /* compositor stability */
  isolation: isolate;
}

@supports (height: 100dvh){
  .sigil-explorer{ height: 100dvh; }
}

.sigil-explorer *{ box-sizing: border-box; }

/* Ensure content sits above overlays */
.kx-toolbar,
.explorer-scroll{ position: relative; z-index: 1; }

/* ─────────────────────────────────────────────────────────────
   GLOBAL KRYSTAL OVERLAY (etched + caustic drift)
   NOTE: absolute (not fixed) to avoid mobile body scroll / flicker paths.
   ───────────────────────────────────────────────────────────── */
.sigil-explorer::before,
.sigil-explorer::after{
  content:"";
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 0;

  transform: translate3d(0,0,0);
  -webkit-transform: translate3d(0,0,0);
  will-change: transform, opacity;
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;
}

.sigil-explorer::before{
  /* micro-noise + etch lines */
  background:
    repeating-linear-gradient(
      180deg,
      rgba(255,255,255,0.022) 0px,
      rgba(255,255,255,0.022) 1px,
      rgba(0,0,0,0.00) 3px,
      rgba(0,0,0,0.00) 7px
    ),
    repeating-linear-gradient(
      90deg,
      rgba(255,255,255,0.012) 0px,
      rgba(255,255,255,0.012) 1px,
      rgba(0,0,0,0.00) 5px,
      rgba(0,0,0,0.00) 11px
    );
  mix-blend-mode: overlay;
  opacity: .35;
  will-change: opacity;
}

.sigil-explorer::after{
  /* caustic aurora drift */
  background:
    radial-gradient(900px 600px at 30% 20%, rgba(35,255,240,0.10), transparent 60%),
    radial-gradient(800px 620px at 80% 70%, rgba(183,163,255,0.10), transparent 60%),
    radial-gradient(760px 560px at 15% 85%, rgba(98,218,255,0.08), transparent 62%);
  filter: blur(10px) saturate(1.05);
  opacity: .55;
  animation: sx-aurora var(--sx-breath) ease-in-out infinite;
  will-change: transform, opacity, filter;
}

@keyframes sx-aurora{
  0%   { transform: translate3d(0,0,0) scale(1); opacity:.48; }
  50%  { transform: translate3d(0,-10px,0) scale(1.03); opacity:.62; }
  100% { transform: translate3d(0,0,0) scale(1); opacity:.48; }
}

/* ─────────────────────────────────────────────────────────────
   TOOLBAR (stays visible because ONLY the content pane scrolls)
   ───────────────────────────────────────────────────────────── */
.kx-toolbar{
  position: relative;
  z-index: 10;
  -webkit-backdrop-filter: blur(14px) saturate(140%);
  backdrop-filter: blur(14px) saturate(140%);
  background:
    linear-gradient(180deg, rgba(255, 255, 255, 0.07), rgba(255, 255, 255, 0.02)) border-box,
    linear-gradient(180deg, rgba(10, 18, 22, 0.82), rgba(6, 10, 14, 0.78));
  border-bottom: 1px solid rgba(255,255,255,0.10);
  box-shadow: var(--sx-shadow);

  transform: translate3d(0,0,0);
  -webkit-transform: translate3d(0,0,0);
  will-change: transform;
}

@supports not ((backdrop-filter: blur(1px)) or (-webkit-backdrop-filter: blur(1px))){
  .kx-toolbar{
    background: linear-gradient(180deg, rgba(10, 18, 22, 0.92), rgba(6, 10, 14, 0.88));
  }
}

.kx-toolbar-inner{
  max-width: var(--sx-maxw);
  margin: 0 auto;
  padding: var(--sx-pad);
  display: grid;
  grid-template-columns: 1fr;
  gap: 12px;
}

@media (min-width: 860px){
  .kx-toolbar-inner{
    grid-template-columns: 1fr auto;
    align-items: center;
  }
}

/* Brand */
.kx-brand{
  display: grid;
  grid-template-columns: auto 1fr;
  align-items: center;
  gap: 12px;
  min-width: 0;
}

.kx-glyph{
  width: 40px;
  height: 40px;
  border-radius: 12px;
  background:
    radial-gradient(120% 120% at 50% 0%, rgba(55,255,228,0.35), rgba(255,255,255,0) 62%),
    conic-gradient(
      from 220deg,
      rgba(55,255,228,0.10),
      rgba(92,225,255,0.10),
      rgba(167,139,250,0.12),
      rgba(55,255,228,0.10)
    ),
    linear-gradient(180deg, rgba(255,255,255,0.14), rgba(255,255,255,0.05));
  border: 1px solid rgba(255,255,255,0.14);
  box-shadow:
    inset 0 0 0 1px rgba(255,255,255,0.18),
    0 12px 30px rgba(0,0,0,0.44);
  position: relative;
  overflow: hidden;
}

.kx-glyph::after{
  content:"";
  position:absolute;
  inset:-40%;
  background:
    radial-gradient(closest-side, rgba(255,255,255,0.16), rgba(255,255,255,0) 70%);
  transform: translate3d(-20%, -18%, 0) rotate(18deg);
  opacity:.7;
  filter: blur(10px);
  animation: sx-glyph-sheen calc(var(--sx-breath) * 1.2) ease-in-out infinite;
}

@keyframes sx-glyph-sheen{
  0%   { transform: translate3d(-22%, -20%, 0) rotate(16deg); opacity:.55; }
  50%  { transform: translate3d(6%, 2%, 0) rotate(20deg); opacity:.78; }
  100% { transform: translate3d(-22%, -20%, 0) rotate(16deg); opacity:.55; }
}

.kx-title{ display: grid; gap: 6px; min-width: 0; }

.kx-title h1{
  margin: 0;
  font-size: clamp(18px, 3.2vw, 24px);
  letter-spacing: 0.14em;
  word-spacing: 0.1em;
}

.kx-title h1 span{
  color: var(--sx-accent);
  text-shadow: 0 0 1px var(--sx-accent), 0 0 22px rgba(55,255,228,0.25);
  letter-spacing: 0.02em;
}

.kx-tagline{
  color: var(--sx-text-dim);
  font-size: 12px;
  opacity: 0.92;
}

/* Controls */
.kx-controls{
  display: grid;
  gap: 10px;
  grid-template-columns: 1fr;
}

@media (min-width: 680px){
  .kx-controls{
    grid-template-columns: 1fr auto auto;
    align-items: center;
  }
}

/* Add form */
.kx-add-form{
  display: grid;
  grid-template-columns: 1fr auto;
  gap: 8px;
}

.kx-input{
  width: 100%;
  padding: 11px 14px;
  border-radius: 14px;
  border: 1px solid rgba(255,255,255,0.14);
  background:
    radial-gradient(140% 220% at 0% 0%, rgba(55,255,228,0.08), transparent 55%),
    linear-gradient(180deg, rgba(7,12,14,0.74), rgba(7,12,14,0.52));
  color: var(--sx-text);
  box-shadow: inset 0 1px 0 rgba(255,255,255,0.06);
  outline: none;
  min-width: 0;
  font-size: 13px;
}

.kx-input::placeholder{
  color: color-mix(in oklab, var(--sx-text-dim) 70%, transparent);
}

.kx-input:focus-visible{
  border-color: rgba(255,255,255,0.22);
  box-shadow: var(--sx-ring);
}

/* Primary button */
.kx-button{
  padding: 11px 16px;
  border-radius: 14px;
  border: 1px solid rgba(255,255,255,0.20);
  color: #081917;
  font-weight: 900;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  cursor: pointer;
  background:
    radial-gradient(120% 160% at 0% 0%, rgba(55,255,228,0.28), transparent 42%),
    linear-gradient(180deg, rgba(55,255,228,0.22), rgba(55,255,228,0.10));
  text-shadow: 0 1px 0 rgba(255,255,255,0.30);
  box-shadow:
    0 14px 34px rgba(55,255,228,0.20),
    inset 0 1px 0 rgba(255,255,255,0.26);
  transition: transform .12s ease, box-shadow .18s ease, filter .18s ease;
}

.kx-button:hover{
  transform: translateY(-1px);
  filter: saturate(1.06) brightness(1.03);
  box-shadow:
    0 18px 44px rgba(55,255,228,0.24),
    inset 0 1px 0 rgba(255,255,255,0.32);
}

/* Import / export */
.kx-io{
  display: grid;
  grid-auto-flow: column;
  gap: 8px;
  justify-content: start;
  align-items: center;
}

.kx-import,
.kx-export{
  padding: 10px 14px;
  border-radius: 14px;
  border: 1px solid rgba(255,255,255,0.14);
  background:
    radial-gradient(120% 180% at 0% 0%, rgba(183,163,255,0.08), transparent 55%),
    linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
  color: var(--sx-text);
  cursor: pointer;
  box-shadow:
    inset 0 0 0 1px rgba(255,255,255,0.04),
    0 6px 18px rgba(0,0,0,0.35);
  transition: transform .1s ease, box-shadow .2s ease, border-color .2s ease, color .15s ease;
  font-size: 12px;
}

.kx-import:hover,
.kx-export:hover{
  transform: translateY(-1px);
  border-color: rgba(255,255,255,0.24);
  color: var(--sx-accent);
}

.kx-import{
  position: relative;
  display: inline-flex;
  align-items: center;
}

.kx-import input[type="file"]{
  position: absolute;
  inset: 0;
  opacity: 0;
  cursor: pointer;
}

/* Stats */
.kx-stats{
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  justify-content: flex-end;
}

.kx-pill{
  padding: 6px 10px;
  border-radius: 999px;
  border: 1px solid rgba(255,255,255,0.14);
  background:
    radial-gradient(140% 240% at 0% 0%, rgba(98,218,255,0.08), transparent 58%),
    linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
  color: var(--sx-text-dim);
  font-size: 11px;
  white-space: nowrap;
}

.kx-pill.subtle{ opacity: 0.88; }

/* ─────────────────────────────────────────────────────────────
   SCROLL VIEWPORT (ONLY SCROLLER)
   ───────────────────────────────────────────────────────────── */
.explorer-scroll{
  /* CRITICAL: allow the grid row to constrain this element */
  min-height: 0;
  min-width: 0;

  overflow: auto;
  padding: var(--sx-pad);
  padding-bottom: max(var(--sx-pad), env(safe-area-inset-bottom, 0px));
  display: grid;
  gap: 14px;
  -webkit-overflow-scrolling: touch;
  overscroll-behavior: contain;
  touch-action: pan-y pinch-zoom;
  scroll-behavior: smooth;

  scrollbar-gutter: stable both-edges;
}

.explorer-inner{
  max-width: var(--sx-maxw);
  margin: 0 auto;
  width: 100%;
  display: grid;
  gap: 14px;
  min-width: 0;
}

/* ─────────────────────────────────────────────────────────────
   EMPTY STATE
   ───────────────────────────────────────────────────────────── */
.kx-empty{
  border: 1px dashed rgba(255,255,255,0.18);
  border-radius: var(--sx-radius);
  background:
    radial-gradient(120% 200% at 0% 0%, rgba(35,255,240,0.10), transparent 58%),
    linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
  padding: 16px 14px 18px;
  color: var(--sx-text-dim);
  font-size: 13px;
}

.kx-empty p{ margin: 0 0 6px; }
.kx-empty ol{ margin: 6px 0 0; padding-left: 20px; }

/* ─────────────────────────────────────────────────────────────
   FOREST / ORIGINS (chakra-tinted)
   ───────────────────────────────────────────────────────────── */
.forest{ display: grid; gap: 14px; }

.origin{
  border: 1px solid rgba(255,255,255,0.16);
  border-radius: var(--sx-radius);
  background:
    radial-gradient(120% 180% at 0% 0%, color-mix(in oklab, var(--sx-chakra) 18%, transparent), transparent 60%),
    radial-gradient(120% 180% at 100% 100%, color-mix(in oklab, var(--sx-chakra) 10%, transparent), transparent 62%),
    linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
  -webkit-backdrop-filter: blur(18px) saturate(170%);
  backdrop-filter: blur(18px) saturate(170%);
  box-shadow: var(--sx-shadow-card);
  overflow: clip;
  position: relative;
  animation: sx-card-breathe var(--sx-breath) ease-in-out infinite;

  transform: translateZ(0);
  -webkit-transform: translateZ(0);
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;
}

@supports not (overflow: clip){
  .origin{ overflow: hidden; }
}

.origin::before{
  content:"";
  position:absolute;
  inset: 0;
  pointer-events:none;
  background:
    radial-gradient(900px 420px at 20% 10%, rgba(255,255,255,0.10), transparent 60%),
    repeating-linear-gradient(
      135deg,
      rgba(255,255,255,0.05) 0px,
      rgba(255,255,255,0.05) 1px,
      rgba(0,0,0,0.0) 10px,
      rgba(0,0,0,0.0) 16px
    );
  mix-blend-mode: overlay;
  opacity: .35;
}

@keyframes sx-card-breathe{
  0%   { filter: brightness(1) saturate(1); }
  50%  { filter: brightness(1.04) saturate(1.06); }
  100% { filter: brightness(1) saturate(1); }
}

/* Origin header */
.origin-head{
  display: grid;
  gap: 8px;
  padding: 11px 14px;
  border-bottom: 1px dashed rgba(255,255,255,0.10);
  background:
    radial-gradient(140% 240% at 0% 0%, color-mix(in oklab, var(--sx-chakra) 16%, transparent), transparent 60%),
    linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.03));
  grid-template-columns: 1fr;
}

@media (min-width: 720px){
  .origin-head{ grid-template-columns: 1fr auto; align-items: center; }
}

.o-meta{
  display: flex;
  gap: 10px;
  align-items: center;
  flex-wrap: wrap;
  min-width: 0;
}

.o-title{
  font-weight: 900;
  letter-spacing: 0.14em;
  text-transform: uppercase;
  color: color-mix(in oklab, var(--sx-chakra) 78%, var(--sx-text));
  font-size: 11px;
}

.o-link{
  color: var(--sx-text);
  text-decoration: none;
  border-bottom: 1px dashed rgba(255,255,255,0.18);
  max-width: 60ch;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  font-weight: 700;
}

.o-link:hover{
  color: var(--sx-accent-3);
  text-shadow: 0 0 14px rgba(92,225,255,0.30);
}

.o-chakra{
  padding: 5px 9px;
  border-radius: 999px;
  border: 1px solid color-mix(in oklab, var(--sx-chakra) 55%, rgba(255,255,255,0.12));
  background:
    radial-gradient(120% 200% at 0% 0%, color-mix(in oklab, var(--sx-chakra) 22%, transparent), transparent 60%),
    linear-gradient(180deg, color-mix(in oklab, var(--sx-chakra) 26%, transparent), rgba(255,255,255,0.02));
  color: #f8fbff;
  font-size: 11px;
  white-space: nowrap;
  text-shadow: 0 1px 0 rgba(0,0,0,0.25);
}

.o-right{
  display: flex;
  gap: 8px;
  align-items: center;
  flex-wrap: wrap;
  justify-content: flex-end;
}

.o-count{ color: var(--sx-text-dim); font-size: 11px; }

.o-copy{
  padding: 7px 11px;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,0.14);
  background:
    radial-gradient(140% 220% at 0% 0%, color-mix(in oklab, var(--sx-chakra) 12%, transparent), transparent 60%),
    linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
  color: var(--sx-text);
  cursor: pointer;
  box-shadow:
    inset 0 0 0 1px rgba(255,255,255,0.04),
    0 6px 18px rgba(0,0,0,0.35);
  font-size: 11px;
  transition: transform .12s ease, filter .18s ease, border-color .18s ease;
}

.o-copy:hover{
  transform: translateY(-1px);
  border-color: color-mix(in oklab, var(--sx-chakra) 60%, rgba(255,255,255,0.16));
  filter: saturate(1.06) brightness(1.03);
}

/* Origin body */
.origin-body{
  padding: 8px 9px 10px;
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  scrollbar-gutter: stable both-edges;
}

/* ─────────────────────────────────────────────────────────────
   TREE / NODES (chakra-tinted, etched, breathing)
   ───────────────────────────────────────────────────────────── */
.tree{
  display: flex;
  flex-direction: column;
  gap: 7px;
  min-width: min-content;
}

.node{
  border-radius: var(--sx-radius-sm);
  border: 1px solid rgba(255,255,255,0.16);
  background:
    radial-gradient(140% 260% at 0% 0%, color-mix(in oklab, var(--sx-chakra) 22%, transparent), transparent 58%),
    radial-gradient(160% 240% at 110% 100%, color-mix(in oklab, var(--sx-chakra) 12%, transparent), transparent 62%),
    linear-gradient(180deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02));
  box-shadow:
    0 14px 34px rgba(0,0,0,0.58),
    inset 0 1px 0 rgba(255,255,255,0.06);
  position: relative;
  overflow: hidden;
  animation: sx-node-breathe var(--sx-breath) ease-in-out infinite;

  transform: translateZ(0);
  -webkit-transform: translateZ(0);
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;
  will-change: transform, filter;
}

.node::before{
  content:"";
  position:absolute;
  inset: 0;
  pointer-events:none;
  background:
    radial-gradient(900px 420px at 20% 10%, rgba(255,255,255,0.10), transparent 62%),
    radial-gradient(620px 320px at 90% 80%, color-mix(in oklab, var(--sx-chakra) 14%, transparent), transparent 65%),
    repeating-linear-gradient(
      135deg,
      rgba(255,255,255,0.05) 0px,
      rgba(255,255,255,0.05) 1px,
      rgba(0,0,0,0.0) 11px,
      rgba(0,0,0,0.0) 18px
    );
  mix-blend-mode: overlay;
  opacity: .34;
}

.node::after{
  content:"";
  position:absolute;
  inset:-40%;
  pointer-events:none;
  background:
    conic-gradient(
      from 180deg,
      rgba(255,255,255,0.00),
      color-mix(in oklab, var(--sx-chakra) 14%, transparent),
      rgba(255,255,255,0.00),
      color-mix(in oklab, var(--sx-chakra) 10%, transparent),
      rgba(255,255,255,0.00)
    );
  filter: blur(18px);
  opacity: .26;
  transform: translate3d(-8%, -10%, 0);
  animation: sx-node-caustic calc(var(--sx-breath) * 1.4) ease-in-out infinite;
}

@keyframes sx-node-breathe{
  0%   { filter: brightness(1) saturate(1); }
  50%  { filter: brightness(1.05) saturate(1.08); }
  100% { filter: brightness(1) saturate(1); }
}

@keyframes sx-node-caustic{
  0%   { transform: translate3d(-10%, -12%, 0) rotate(0deg); opacity:.20; }
  50%  { transform: translate3d(6%, 4%, 0) rotate(6deg); opacity:.34; }
  100% { transform: translate3d(-10%, -12%, 0) rotate(0deg); opacity:.20; }
}

/* Optional: if your TS adds either .has-phi or data-has-phi="1" */
.node.has-phi,
.node[data-has-phi="1"]{
  border-color: rgba(var(--sx-phi-rgb), 0.65);
  box-shadow:
    0 16px 42px rgba(0,0,0,0.58),
    0 0 0 1px rgba(var(--sx-phi-rgb), 0.18) inset,
    0 0 22px rgba(var(--sx-phi-rgb), 0.10);
}

/* Node row layout (desktop = 2 columns, mobile = stacked) */
.node-row{
  display: grid;
  grid-template-columns: minmax(0, 2.2fr) minmax(0, 2fr);
  gap: 8px 10px;
  align-items: center;
  padding: 8px 10px;
}

@media (max-width: 760px){
  .node-row{ grid-template-columns: minmax(0, 1fr); }
  .node-meta{ justify-content: flex-start; }
}

/* Left */
.node-main{
  display: flex;
  align-items: center;
  gap: 8px;
  min-width: 0;
}

/* Right */
.node-meta{
  display: flex;
  align-items: center;
  flex-wrap: wrap;
  justify-content: flex-end;
  gap: 6px;
}

/* Twirl */
.twirl{
  width: 30px;
  height: 30px;
  border-radius: 999px;
  border: 1px solid rgba(255,255,255,0.18);
  background:
    radial-gradient(140% 240% at 0% 0%, color-mix(in oklab, var(--sx-chakra) 14%, transparent), transparent 60%),
    linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.03));
  color: var(--sx-text);
  display: inline-grid;
  place-items: center;
  cursor: pointer;
  flex-shrink: 0;
  transition: transform .12s ease, filter .16s ease, border-color .16s ease;
}

.twirl:hover{
  transform: translateY(-1px);
  filter: brightness(1.05) saturate(1.06);
  border-color: color-mix(in oklab, var(--sx-chakra) 55%, rgba(255,255,255,0.14));
}

.tw{
  width: 10px;
  height: 10px;
  border-right: 2px solid currentColor;
  border-bottom: 2px solid currentColor;
  transform: rotate(-45deg);
  transition: transform .18s ease, color .18s ease;
  opacity: .92;
}

.tw.open{
  transform: rotate(45deg);
  color: color-mix(in oklab, var(--sx-chakra) 80%, white);
}

/* Node link */
.node-link{
  min-width: 0;
  color: var(--sx-text);
  text-decoration: none;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  font-weight: 700;
}

.node-link span{
  padding: 6px 9px;
  border-radius: 10px;
  background:
    radial-gradient(140% 220% at 0% 0%, color-mix(in oklab, var(--sx-chakra) 32%, transparent), transparent 60%),
    linear-gradient(180deg, color-mix(in oklab, var(--sx-chakra) 16%, transparent), rgba(255,255,255,0.02));
  border: 1px solid color-mix(in oklab, var(--sx-chakra) 70%, rgba(255,255,255,0.14));
  text-shadow:
    0 0 18px color-mix(in oklab, var(--sx-chakra) 35%, transparent),
    0 1px 0 rgba(0,0,0,0.25);
}

.node-link:hover{ color: var(--sx-accent-3); }

/* Kai time pills */
.k-stamp{
  display: inline-flex;
  gap: 6px;
  align-items: center;
  flex-wrap: wrap;
  font-size: 11px;
  color: var(--sx-text-dim);
}

.k-pill{
  padding: 5px 8px;
  border-radius: 999px;
  border: 1px solid rgba(255,255,255,0.15);
  background:
    radial-gradient(140% 220% at 0% 0%, rgba(255,255,255,0.05), transparent 60%),
    linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
  white-space: nowrap;
}

.k-dot{ opacity: 0.6; }

/* Chakra badge */
.chakra{
  padding: 5px 9px;
  border-radius: 999px;
  border: 1px solid color-mix(in oklab, var(--sx-chakra) 55%, rgba(255,255,255,0.12));
  background:
    radial-gradient(140% 220% at 0% 0%, color-mix(in oklab, var(--sx-chakra) 22%, transparent), transparent 60%),
    linear-gradient(180deg, color-mix(in oklab, var(--sx-chakra) 18%, transparent), rgba(255,255,255,0.02));
  color: #f8fbff;
  font-size: 11px;
  white-space: nowrap;
  text-shadow: 0 1px 0 rgba(0,0,0,0.25);
}

/* Φ pill */
.phi-pill{
  padding: 5px 9px;
  border-radius: 999px;
  border: 1px solid rgba(255, 215, 128, 0.62);
  background:
    radial-gradient(140% 220% at 0% 0%, rgba(255,215,128,0.22), transparent 62%),
    linear-gradient(180deg, rgba(255,215,128,0.22), rgba(255,215,128,0.06));
  color: #fff8e0;
  font-size: 11px;
  white-space: nowrap;
  text-shadow: 0 1px 0 rgba(0,0,0,0.25);
}

/* Copy button */
.node-copy{
  width: 30px;
  height: 30px;
  border-radius: 10px;
  border: 1px solid rgba(255,255,255,0.16);
  background:
    radial-gradient(140% 220% at 0% 0%, color-mix(in oklab, var(--sx-chakra) 14%, transparent), transparent 62%),
    linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
  color: var(--sx-text);
  cursor: pointer;
  box-shadow:
    inset 0 0 0 1px rgba(255,255,255,0.04),
    0 6px 18px rgba(0,0,0,0.35);
  flex-shrink: 0;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  font-size: 13px;
  transition: transform .12s ease, filter .16s ease, border-color .16s ease;
}

.node-copy:hover{
  transform: translateY(-1px);
  border-color: color-mix(in oklab, var(--sx-chakra) 60%, rgba(255,255,255,0.14));
  filter: brightness(1.05) saturate(1.06);
}

/* Open area */
.node-open{
  border-top: 1px dashed rgba(255,255,255,0.14);
}

/* Detail panel */
.node-detail,
.node-details{
  padding: 8px 10px 10px;
  font-size: 11px;
  color: var(--sx-text-dim);
  background:
    radial-gradient(140% 220% at 0% 0%, color-mix(in oklab, var(--sx-chakra) 12%, transparent), transparent 62%),
    linear-gradient(180deg, rgba(5,10,11,0.92), rgba(5,10,11,0.82));
}

.node-detail-grid,
.node-details-grid{
  display: grid;
  grid-template-columns: auto minmax(0, 1fr);
  column-gap: 10px;
  row-gap: 4px;
  align-items: baseline;
}

@media (max-width: 640px){
  .node-detail-grid,
  .node-details-grid{ grid-template-columns: minmax(0, 1fr); }
}

.detail-label{
  opacity: 0.82;
  text-transform: uppercase;
  letter-spacing: 0.14em;
  font-weight: 700;
  font-size: 10px;
}

.detail-value{
  font-family: var(--sx-mono);
  min-width: 0;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.detail-value strong{ font-weight: 700; color: var(--sx-text); }

.node-detail-empty{
  opacity: 0.88;
  padding: 4px 0 2px;
}

/* Children rail */
.node-children{
  margin: 6px 0 8px 20px;
  padding: 8px 0 4px 12px;
  display: flex;
  flex-direction: column;
  gap: 7px;
  position: relative;
}

.node-children::before{
  content: "";
  position: absolute;
  left: 0;
  top: 6px;
  bottom: 10px;
  width: 2px;
  background: linear-gradient(
    180deg,
    color-mix(in oklab, var(--sx-chakra) 70%, transparent),
    rgba(0,0,0,0)
  );
  border-radius: 1px;
  box-shadow:
    0 0 18px color-mix(in oklab, var(--sx-chakra) 26%, transparent);
}

/* Empty branch inside origin */
.origin-body .kx-empty{ margin: 4px 2px 6px; }

/* ─────────────────────────────────────────────────────────────
   TRANSFER READY UI (Φ send/receive/status rows)
   ───────────────────────────────────────────────────────────── */
.tx{
  display: grid;
  gap: 8px;
  margin-top: 10px;
  padding-top: 8px;
  border-top: 1px dashed rgba(255,255,255,0.12);
}

.tx-head{
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
  flex-wrap: wrap;
}

.tx-title{
  font-size: 10px;
  letter-spacing: 0.16em;
  text-transform: uppercase;
  color: color-mix(in oklab, var(--sx-phi) 70%, var(--sx-text));
  font-weight: 900;
}

.tx-badges{
  display: inline-flex;
  gap: 6px;
  align-items: center;
  flex-wrap: wrap;
}

.tx-badge{
  padding: 5px 9px;
  border-radius: 999px;
  border: 1px solid rgba(var(--sx-phi-rgb), 0.55);
  background:
    radial-gradient(140% 220% at 0% 0%, rgba(var(--sx-phi-rgb), 0.18), transparent 62%),
    linear-gradient(180deg, rgba(var(--sx-phi-rgb), 0.14), rgba(255,255,255,0.02));
  color: #fff8e0;
  font-size: 11px;
  white-space: nowrap;
  text-shadow: 0 1px 0 rgba(0,0,0,0.25);
}

.tx-row{
  display: grid;
  grid-template-columns: 1fr auto;
  gap: 8px;
  align-items: center;
}

@media (max-width: 640px){
  .tx-row{ grid-template-columns: 1fr; }
}

.tx-input{
  width: 100%;
  padding: 10px 12px;
  border-radius: 14px;
  border: 1px solid rgba(255,255,255,0.14);
  background:
    radial-gradient(140% 240% at 0% 0%, rgba(var(--sx-phi-rgb), 0.10), transparent 58%),
    linear-gradient(180deg, rgba(7,12,14,0.76), rgba(7,12,14,0.54));
  color: var(--sx-text);
  outline: none;
  font-size: 12px;
  box-shadow: inset 0 1px 0 rgba(255,255,255,0.06);
}

.tx-input::placeholder{
  color: color-mix(in oklab, var(--sx-text-dim) 72%, transparent);
}

.tx-input:focus-visible{
  border-color: rgba(var(--sx-phi-rgb), 0.50);
  box-shadow:
    0 0 0 2px rgba(var(--sx-phi-rgb), 0.18),
    0 0 0 6px rgba(var(--sx-phi-rgb), 0.10);
}

.tx-actions{
  display: inline-flex;
  gap: 8px;
  align-items: center;
  flex-wrap: wrap;
  justify-content: flex-end;
}

.tx-btn{
  padding: 10px 12px;
  border-radius: 14px;
  border: 1px solid rgba(255,255,255,0.18);
  cursor: pointer;
  font-weight: 900;
  letter-spacing: 0.08em;
  text-transform: uppercase;
  font-size: 11px;
  transition: transform .12s ease, filter .18s ease, box-shadow .18s ease, border-color .18s ease;
  user-select: none;
}

.tx-btn:active{ transform: translateY(0); }

.tx-btn.send{
  color: #2b1b00;
  background:
    radial-gradient(140% 220% at 0% 0%, rgba(var(--sx-phi-rgb), 0.34), transparent 56%),
    linear-gradient(180deg, rgba(var(--sx-phi-rgb), 0.26), rgba(var(--sx-phi-rgb), 0.10));
  box-shadow:
    0 14px 34px rgba(var(--sx-phi-rgb), 0.12),
    inset 0 1px 0 rgba(255,255,255,0.28);
}

.tx-btn.send:hover{
  transform: translateY(-1px);
  filter: brightness(1.03) saturate(1.06);
  border-color: rgba(var(--sx-phi-rgb), 0.45);
  box-shadow:
    0 18px 44px rgba(var(--sx-phi-rgb), 0.16),
    inset 0 1px 0 rgba(255,255,255,0.32);
}

.tx-btn.cancel{
  color: var(--sx-text);
  background:
    radial-gradient(140% 220% at 0% 0%, rgba(255,255,255,0.06), transparent 62%),
    linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
  box-shadow:
    inset 0 0 0 1px rgba(255,255,255,0.04),
    0 6px 18px rgba(0,0,0,0.35);
}

.tx-btn.cancel:hover{
  transform: translateY(-1px);
  border-color: rgba(255,255,255,0.24);
  color: var(--sx-accent);
}

/* Status line */
.tx-status{
  display: flex;
  gap: 8px;
  align-items: center;
  flex-wrap: wrap;
  color: var(--sx-text-dim);
  font-size: 11px;
}

.tx-status .dot{ opacity: 0.65; }

.tx-status.ok{
  color: color-mix(in oklab, var(--sx-ok) 72%, var(--sx-text));
}

.tx-status.warn{
  color: color-mix(in oklab, var(--sx-warn) 70%, var(--sx-text));
}

.tx-status.bad{
  color: color-mix(in oklab, var(--sx-bad) 70%, var(--sx-text));
}

.tx-hash{
  font-family: var(--sx-mono);
  padding: 4px 8px;
  border-radius: 999px;
  border: 1px solid rgba(255,255,255,0.14);
  background:
    radial-gradient(140% 220% at 0% 0%, rgba(255,255,255,0.05), transparent 60%),
    linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
  white-space: nowrap;
  max-width: 100%;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* ─────────────────────────────────────────────────────────────
   FOOTER — ULTRA SLIM
   ───────────────────────────────────────────────────────────── */
.kx-footer{
  color: var(--sx-text-dim);
  text-align: center;
  font-size: 11px;
  padding: 6px 4px 4px;
  opacity: 0.9;
}

.kx-footer .row{
  display: inline-flex;
  gap: 8px;
  align-items: center;
  flex-wrap: wrap;
}

.kx-footer .dot{ opacity: 0.6; }

/* ─────────────────────────────────────────────────────────────
   SCROLLBAR POLISH (scoped)
   ───────────────────────────────────────────────────────────── */
.explorer-scroll,
.origin-body{
  scrollbar-width: thin;
  scrollbar-color: rgba(55, 255, 228, 0.5) transparent;
}

.explorer-scroll::-webkit-scrollbar,
.origin-body::-webkit-scrollbar{
  height: 8px;
  width: 8px;
}

.explorer-scroll::-webkit-scrollbar-thumb,
.origin-body::-webkit-scrollbar-thumb{
  background: linear-gradient(180deg, rgba(55,255,228,0.35), rgba(55,255,228,0.15));
  border-radius: 999px;
  border: 2px solid transparent;
  background-clip: padding-box;
}

.explorer-scroll::-webkit-scrollbar-track,
.origin-body::-webkit-scrollbar-track{
  background: transparent;
}

/* ─────────────────────────────────────────────────────────────
   A11Y / MOTION
   ───────────────────────────────────────────────────────────── */
.sigil-explorer :is(button, a, input){
  outline: none;
}

.sigil-explorer :is(button, a, input):focus-visible{
  box-shadow: var(--sx-ring);
  border-color: rgba(255,255,255,0.24);
}

@media (prefers-reduced-motion: reduce){
  .sigil-explorer::after,
  .origin,
  .node,
  .kx-button,
  .tw,
  .kx-glyph::after{
    transition: none !important;
    animation: none !important;
  }
}

/* ─────────────────────────────────────────────────────────────
   ANDROID / WEBVIEW COLOR-MIX FALLBACK
   ───────────────────────────────────────────────────────────── */
@supports not (background: color-mix(in oklab, white 50%, transparent)){
  .origin{
    background:
      radial-gradient(120% 180% at 0% 0%, rgba(var(--sx-chakra-rgb, 35,255,240), 0.18), transparent 60%),
      radial-gradient(120% 180% at 100% 100%, rgba(var(--sx-chakra-rgb, 35,255,240), 0.10), transparent 62%),
      linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
  }

  .origin-head{
    background:
      radial-gradient(140% 240% at 0% 0%, rgba(var(--sx-chakra-rgb, 35,255,240), 0.16), transparent 60%),
      linear-gradient(180deg, rgba(255,255,255,0.08), rgba(255,255,255,0.03));
  }

  .o-chakra,
  .chakra{
    border-color: rgba(var(--sx-chakra-rgb, 35,255,240), 0.55);
    background:
      radial-gradient(120% 200% at 0% 0%, rgba(var(--sx-chakra-rgb, 35,255,240), 0.22), transparent 60%),
      linear-gradient(180deg, rgba(var(--sx-chakra-rgb, 35,255,240), 0.18), rgba(255,255,255,0.02));
  }

  .node{
    background:
      radial-gradient(140% 260% at 0% 0%, rgba(var(--sx-chakra-rgb, 35,255,240), 0.22), transparent 58%),
      radial-gradient(160% 240% at 110% 100%, rgba(var(--sx-chakra-rgb, 35,255,240), 0.12), transparent 62%),
      linear-gradient(180deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02));
  }

  .node::before{
    background:
      radial-gradient(900px 420px at 20% 10%, rgba(255,255,255,0.10), transparent 62%),
      radial-gradient(620px 320px at 90% 80%, rgba(var(--sx-chakra-rgb, 35,255,240), 0.14), transparent 65%),
      repeating-linear-gradient(
        135deg,
        rgba(255,255,255,0.05) 0px,
        rgba(255,255,255,0.05) 1px,
        rgba(0,0,0,0.0) 11px,
        rgba(0,0,0,0.0) 18px
      );
  }

  .node::after{
    background:
      conic-gradient(
        from 180deg,
        rgba(255,255,255,0.00),
        rgba(var(--sx-chakra-rgb, 35,255,240), 0.14),
        rgba(255,255,255,0.00),
        rgba(var(--sx-chakra-rgb, 35,255,240), 0.10),
        rgba(255,255,255,0.00)
      );
  }

  .node-link span{
    background:
      radial-gradient(140% 220% at 0% 0%, rgba(var(--sx-chakra-rgb, 35,255,240), 0.32), transparent 60%),
      linear-gradient(180deg, rgba(var(--sx-chakra-rgb, 35,255,240), 0.16), rgba(255,255,255,0.02));
    border-color: rgba(var(--sx-chakra-rgb, 35,255,240), 0.70);
  }

  .node-children::before{
    background: linear-gradient(
      180deg,
      rgba(var(--sx-chakra-rgb, 35,255,240), 0.70),
      rgba(0,0,0,0)
    );
    box-shadow: 0 0 18px rgba(var(--sx-chakra-rgb, 35,255,240), 0.26);
  }
}

/* ─────────────────────────────────────────────────────────────
   COARSE-POINTER WEBVIEW STABILITY PATCH (no visual change)
   ───────────────────────────────────────────────────────────── */
@media (hover: none) and (pointer: coarse){
  .sigil-explorer::after,
  .sigil-explorer::before,
  .kx-toolbar,
  .origin,
  .node{
    transform: translateZ(0);
    -webkit-transform: translateZ(0);
    backface-visibility: hidden;
    -webkit-backface-visibility: hidden;
  }

  .sigil-explorer::after{ will-change: transform, opacity, filter; }
  .sigil-explorer::before{ will-change: opacity; }

  .origin,
  .node{
    outline: 1px solid transparent; /* prevents 1px seam flashes */
  }
}
.sigil-explorer{
  display: flex;
  flex-direction: column;
  gap: 12px;
  font-family: var(--sx-sans);
  font-size: 13px;
  color: var(--sx-text);
  line-height: 1.4;
  user-select: none;
  position: relative;
  perspective: 1000px;
  -webkit-perspective: 1000px;
  transform-style: preserve-3d;
  -webkit-transform-style: preserve-3d;
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;  
  will-change: transform, filter;
} 


/* ─────────────────────────────────────────────────────────────
   TOOLBAR — ULTRA COMPACT HEIGHT PATCH (same layout, tighter)
   Paste at END of file (replaces previous compact patch)
   ───────────────────────────────────────────────────────────── */

.kx-toolbar-inner{
  padding: clamp(6px, 1.9vw, 11px);
  gap: 8px;
}

.kx-brand{ gap: 8px; }

.kx-glyph{
  width: 30px;
  height: 30px;
  border-radius: 10px;
}

.kx-title{ gap: 3px; }
.kx-title h1{
  line-height: 1.04;
  margin: 0;
}

.kx-tagline{
  font-size: 11px;
  opacity: 0.88;
}

.kx-controls{ gap: 7px; }
.kx-add-form{ gap: 5px; }

.kx-input{
  padding: 8px 10px;
  border-radius: 11px;
  font-size: 12.5px;
}

.kx-button{
  padding: 8px 12px;
  border-radius: 11px;
  font-size: 12px;
}

.kx-import,
.kx-export{
  padding: 7px 10px;
  border-radius: 11px;
  font-size: 11.5px;
}

.kx-stats{ gap: 5px; }
.kx-pill{
  padding: 4px 8px;
  font-size: 10.5px;
}

/* Ultra-tight on very small phones */
@media (max-width: 420px){
  .kx-toolbar-inner{ padding: 6px; gap: 7px; }
  .kx-glyph{ width: 28px; height: 28px; }
  .kx-input{ padding: 7px 9px; }
  .kx-button{ padding: 7px 11px; }
  .kx-import,
  .kx-export{ padding: 6px 9px; }
}


/* ─────────────────────────────────────────────────────────────
   TOOLBAR — KEYS INLINE + CLOSE BUTTON NUDGE
   Paste at END of file (after the ultra-compact patch)
   ───────────────────────────────────────────────────────────── */

/* On phones: put KEYS pill on the SAME row as Inhale/Exhale */
@media (max-width: 679px){
  .kx-controls{
    grid-template-columns: 1fr auto;
    align-items: center;
    column-gap: 10px;
    row-gap: 7px;
  }

  /* keep the input + big INHALE spanning full width */
  .kx-add-form{
    grid-column: 1 / -1;
  }

  /* inhale/exhale (import/export) on left */
  .kx-io{
    grid-column: 1;
    justify-content: start;
  }

  /* KEYS pill on right, vertically centered */
  .kx-stats{
    grid-column: 2;
    justify-content: flex-end;
    align-self: center;
    margin: 0;
  }
}

/* Nudge the X (close) button up slightly (safe multi-selector) */
.kx-toolbar :where(.kx-close, .kx-dismiss, .kx-x, .close, .close-btn, .toolbar-close){
  transform: translate3d(0, -2px, 0);
  will-change: transform;
}

/* If it’s just a button with an aria-label/title, catch that too */
.kx-toolbar :where(button[aria-label="Close"], button[title="Close"], button[aria-label="close"], button[title="close"]){
  transform: translate3d(0, -2px, 0);
  will-change: transform;
}
/* ─────────────────────────────────────────────────────────────
   ORIGIN CONTAINER (chakra-tinted, etched, breathing)
   ───────────────────────────────────────────────────────────── */
.origin{
  border-radius: var(--sx-radius-md);
  border: 1px solid rgba(255,255,255,0.16);
  background:
    radial-gradient(120% 180% at 0% 0%, color-mix(in oklab, var(--sx-chakra) 18%, transparent), transparent 60%),
    radial-gradient(120% 180% at 100% 100%, color-mix(in oklab, var(--sx-chakra) 12%, transparent), transparent 62%),
    linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
  box-shadow:
    0 16px 42px rgba(0,0,0,0.58),
    inset 0 1px 0 rgba(255,255,255,0  
,0.06);
  position: relative;
  overflow: hidden;
  animation: sx-origin-breathe var(--sx-breath) ease-in-out infinite;     
  transform: translateZ(0);
  -webkit-transform: translateZ(0);
  backface-visibility: hidden;
  -webkit-backface-visibility: hidden;
  will-change: transform, filter;
}