import{E as e,N as t,t as n}from"./index-CXsyZOAh.js";import"./prop-types-DsGQMKcL.js";import{c as r}from"./sigilUtils-B1nNcyDC.js";import{t as i}from"./VerifierFrame-CZDtNfOC.js";var a=t(e(),1),o=t(n(),1);function s(e){return typeof e==`object`&&!!e}function c(e){let t=decodeURIComponent(e||``).trim(),n=t.match(/^(\d+)-([A-Za-z0-9]+)$/);if(!n)return{raw:t,pulse:null,shortSig:null};let r=Number(n[1]);return{raw:t,pulse:Number.isFinite(r)&&r>0?r:null,shortSig:n[2]?String(n[2]):null}}function l(){if(typeof window>`u`)return``;let e=window.location.pathname||``,t=window.location.hash||``,n=e.match(/\/verify\/([^/?#]+)/);if(n&&n[1])return n[1];let r=t.match(/\/verify\/([^/?#]+)/);return r&&r[1]?r[1]:``}function u(e){let t=e.match(/<metadata[^>]*>([\s\S]*?)<\/metadata>/i);return t?(t[1]??``).trim():null}function d(e){let t=e.trim();if(!t)return null;try{return JSON.parse(t)}catch{return null}}function f(e){if(!s(e))return{raw:e};let t=typeof e.kaiSignature==`string`?e.kaiSignature:void 0,n=typeof e.pulse==`number`&&Number.isFinite(e.pulse)?e.pulse:void 0,r=typeof e.chakraDay==`string`?e.chakraDay:void 0,i=typeof e.timestamp==`string`?e.timestamp:void 0,a=typeof e.phiKey==`string`?e.phiKey:void 0,o=typeof e.userPhiKey==`string`?e.userPhiKey:void 0;return{pulse:n,chakraDay:r,kaiSignature:t,phiKey:a&&!a.startsWith(`φK-`)?a:o,timestamp:i,verifierUrl:typeof e.verifierUrl==`string`?e.verifierUrl:void 0,raw:e}}function p(e){let t=u(e);if(t){let e=d(t);if(e)return f(e)}let n=e.indexOf(`"kaiSignature"`);if(n>=0){let t=e.slice(Math.max(0,n-800),Math.min(e.length,n+2e3)).match(/\{[\s\S]*\}/);if(t&&t[0]){let e=d(t[0]);if(e)return f(e)}}return{}}function m(e,t){return e.length<=t?e:e.slice(0,t)}async function h(e){return await new Promise((t,n)=>{let r=new FileReader;r.onerror=()=>n(Error(`Failed to read file.`)),r.onload=()=>t(String(r.result??``)),r.readAsText(e)})}function g(){let e=(0,a.useMemo)(()=>l(),[]),t=(0,a.useMemo)(()=>c(e),[e]),[n,s]=(0,a.useState)(``),[u,d]=(0,a.useState)({status:`idle`}),[f,g]=(0,a.useState)(!1),_=(0,a.useMemo)(()=>({pulse:t.pulse??0,kaiSignature:t.shortSig??`unknown-signature`,phiKey:`—`}),[t.pulse,t.shortSig]),v=(0,a.useCallback)(async()=>{let e=n.trim();if(!e){d({status:`error`,message:`Paste the sealed SVG text or upload the sealed SVG file first.`,slug:t});return}g(!0);try{let n=p(e),i=(n.kaiSignature??``).trim();if(!i){d({status:`error`,message:`No kaiSignature found in the SVG metadata.`,slug:t,embedded:n});return}let a=await r(i),o=(n.phiKey??``).trim(),s=n.pulse,c={hasSignature:!0,slugPulseMatches:t.pulse==null||s==null?null:t.pulse===s,slugShortSigMatches:t.shortSig==null?null:t.shortSig===m(i,t.shortSig.length),derivedPhiKeyMatchesEmbedded:o.length===0?null:a===o};if(c.slugPulseMatches===!1||c.slugShortSigMatches===!1||c.derivedPhiKeyMatchesEmbedded===!1){d({status:`error`,message:`Verification failed: one or more checks did not match.`,slug:t,embedded:n,derivedPhiKey:a,checks:c});return}d({status:`ok`,slug:t,embedded:{...n,phiKey:o.length>0?o:a},derivedPhiKey:a,checks:c})}catch(e){d({status:`error`,message:e instanceof Error?e.message:`Verification failed.`,slug:t})}finally{g(!1)}},[t,n]),y=(0,a.useCallback)(async e=>{if(!e.name.toLowerCase().endsWith(`.svg`)){d({status:`error`,message:`Upload a sealed .svg (this verifier reads embedded <metadata> JSON).`,slug:t});return}s(await h(e)),d({status:`idle`})},[t]);return(0,o.jsxs)(`div`,{className:`verify-page`,children:[(0,o.jsxs)(`header`,{className:`verify-hero`,children:[(0,o.jsx)(`h1`,{className:`verify-title`,children:`Kai-Sigil Verifier`}),(0,o.jsx)(`p`,{className:`verify-subtitle`,children:`Open a sealed memory and verify its human origin by Kai Signature → Φ-Key.`}),(0,o.jsxs)(`div`,{className:`verify-slug`,children:[(0,o.jsx)(`span`,{className:`verify-slug-label`,children:`Link:`}),(0,o.jsxs)(`code`,{className:`verify-slug-value`,children:[`/verify/`,t.raw||`—`]})]})]}),(0,o.jsxs)(`main`,{className:`verify-main`,children:[(0,o.jsxs)(`section`,{className:`verify-card`,children:[(0,o.jsx)(`h2`,{className:`verify-card-title`,children:`1) Provide the sealed post`}),(0,o.jsxs)(`div`,{className:`verify-upload-row`,children:[(0,o.jsxs)(`label`,{className:`verify-upload`,children:[(0,o.jsx)(`input`,{type:`file`,accept:`.svg,image/svg+xml`,onChange:e=>{let t=e.currentTarget.files?.[0];t&&y(t),e.currentTarget.value=``}}),`Upload sealed SVG`]}),(0,o.jsx)(`button`,{type:`button`,className:`verify-btn`,onClick:()=>void v(),disabled:f,children:f?`Verifying…`:`Verify`})]}),(0,o.jsx)(`textarea`,{className:`verify-textarea`,value:n,onChange:e=>s(e.currentTarget.value),placeholder:`Or paste the sealed SVG text here (must include <metadata>{...}</metadata> with kaiSignature + pulse + userPhiKey/phiKey).`,spellCheck:!1})]}),(0,o.jsxs)(`section`,{className:`verify-card`,children:[(0,o.jsx)(`h2`,{className:`verify-card-title`,children:`2) Proof capsule`}),u.status===`ok`?(0,o.jsx)(i,{pulse:u.embedded.pulse??t.pulse??0,kaiSignature:u.embedded.kaiSignature??t.shortSig??`unknown`,phiKey:u.derivedPhiKey,chakraDay:u.embedded.chakraDay,compact:!1}):(0,o.jsx)(i,{pulse:_.pulse,kaiSignature:_.kaiSignature,phiKey:_.phiKey,compact:!1}),(0,o.jsx)(`div`,{className:`verify-status`,children:u.status===`idle`?(0,o.jsx)(`p`,{className:`verify-muted`,children:`Upload/paste a sealed SVG, then click Verify.`}):u.status===`ok`?(0,o.jsxs)(`div`,{className:`verify-ok`,children:[(0,o.jsx)(`div`,{className:`verify-badge verify-badge--ok`,children:`Verified`}),(0,o.jsxs)(`p`,{className:`verify-line`,children:[`Sealed by Φ-Key: `,(0,o.jsx)(`code`,{children:u.derivedPhiKey})]}),(0,o.jsxs)(`ul`,{className:`verify-checks`,children:[(0,o.jsxs)(`li`,{children:[`slug pulse match:`,` `,(0,o.jsx)(`strong`,{children:u.checks.slugPulseMatches===null?`n/a`:String(u.checks.slugPulseMatches)})]}),(0,o.jsxs)(`li`,{children:[`slug shortSig match:`,` `,(0,o.jsx)(`strong`,{children:u.checks.slugShortSigMatches===null?`n/a`:String(u.checks.slugShortSigMatches)})]}),(0,o.jsxs)(`li`,{children:[`derived Φ-Key matches embedded:`,` `,(0,o.jsx)(`strong`,{children:u.checks.derivedPhiKeyMatchesEmbedded===null?`n/a (embed omitted phiKey)`:String(u.checks.derivedPhiKeyMatchesEmbedded)})]})]})]}):(0,o.jsxs)(`div`,{className:`verify-fail`,children:[(0,o.jsx)(`div`,{className:`verify-badge verify-badge--fail`,children:`Not verified`}),(0,o.jsx)(`p`,{className:`verify-line`,children:u.message}),u.checks?(0,o.jsxs)(`ul`,{className:`verify-checks`,children:[(0,o.jsxs)(`li`,{children:[`slug pulse match:`,` `,(0,o.jsx)(`strong`,{children:u.checks.slugPulseMatches===null?`n/a`:String(u.checks.slugPulseMatches)})]}),(0,o.jsxs)(`li`,{children:[`slug shortSig match:`,` `,(0,o.jsx)(`strong`,{children:u.checks.slugShortSigMatches===null?`n/a`:String(u.checks.slugShortSigMatches)})]}),(0,o.jsxs)(`li`,{children:[`derived Φ-Key matches embedded:`,` `,(0,o.jsx)(`strong`,{children:u.checks.derivedPhiKeyMatchesEmbedded===null?`n/a (embed omitted phiKey)`:String(u.checks.derivedPhiKeyMatchesEmbedded)})]})]}):null]})})]})]})]})}export{g as default};