import{En as e,Mn as t,bt as n,cn as r,hn as i,tn as a,un as o,yt as s}from"./index-CvQmBZRM.js";import{t as c}from"./prop-types-DnFuTjrj.js";var l=t(e(),1),u=`clover`,d=function(e){return e===3?`v3`:e},f=`https://js.stripe.com`,p=`${f}/${u}/stripe.js`,ee=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,m=/^https:\/\/js\.stripe\.com\/(v3|[a-z]+)\/stripe\.js(\?.*)?$/,h=`loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used`,g=function(e){return ee.test(e)||m.test(e)},_=function(){for(var e=document.querySelectorAll(`script[src^="${f}"]`),t=0;t<e.length;t++){var n=e[t];if(g(n.src))return n}return null},v=function(e){var t=e&&!e.advancedFraudSignals?`?advancedFraudSignals=false`:``,n=document.createElement(`script`);n.src=`${p}${t}`;var r=document.head||document.body;if(!r)throw Error(`Expected document.body not to be null. Stripe.js requires a <body> element.`);return r.appendChild(n),n},te=function(e,t){!e||!e._registerWrapper||e._registerWrapper({name:`stripe-js`,version:`8.5.3`,startTime:t})},y=null,b=null,x=null,S=function(e){return function(t){e(Error(`Failed to load Stripe.js`,{cause:t}))}},C=function(e,t){return function(){window.Stripe?e(window.Stripe):t(Error(`Stripe.js not available`))}},w=function(e){return y===null?(y=new Promise(function(t,n){if(typeof window>`u`||typeof document>`u`){t(null);return}if(window.Stripe&&e&&console.warn(h),window.Stripe){t(window.Stripe);return}try{var r=_();if(r&&e)console.warn(h);else if(!r)r=v(e);else if(r&&x!==null&&b!==null){var i;r.removeEventListener(`load`,x),r.removeEventListener(`error`,b),(i=r.parentNode)==null||i.removeChild(r),r=v(e)}x=C(t,n),b=S(n),r.addEventListener(`load`,x),r.addEventListener(`error`,b)}catch(e){n(e);return}}),y.catch(function(e){return y=null,Promise.reject(e)})):y},T=function(e,t,n){if(e===null)return null;var r=t[0].match(/^pk_test/),i=d(e.version),a=u;r&&i!==a&&console.warn(`Stripe.js@${i} was loaded on the page, but @stripe/stripe-js@8.5.3 expected Stripe.js@${a}. This may result in unexpected behavior. For more information, see https://docs.stripe.com/sdks/stripejs-versioning`);var o=e.apply(void 0,t);return te(o,n),o},E,D=!1,O=function(){return E||(E=w(null).catch(function(e){return E=null,Promise.reject(e)}),E)};Promise.resolve().then(function(){return O()}).catch(function(e){D||console.warn(e)});var ne=function(){var e=[...arguments];D=!0;var t=Date.now();return O().then(function(n){return T(n,e,t)})},k=t(c(),1);function A(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function j(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]==null?{}:arguments[t];t%2?A(Object(n),!0).forEach(function(t){N(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):A(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function M(e){"@babel/helpers - typeof";return M=typeof Symbol==`function`&&typeof Symbol.iterator==`symbol`?function(e){return typeof e}:function(e){return e&&typeof Symbol==`function`&&e.constructor===Symbol&&e!==Symbol.prototype?`symbol`:typeof e},M(e)}function N(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function re(e,t){if(e==null)return{};var n={},r=Object.keys(e),i,a;for(a=0;a<r.length;a++)i=r[a],!(t.indexOf(i)>=0)&&(n[i]=e[i]);return n}function ie(e,t){if(e==null)return{};var n=re(e,t),r,i;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)r=a[i],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function P(e,t){return ae(e)||F(e,t)||I(e,t)||se()}function ae(e){if(Array.isArray(e))return e}function F(e,t){var n=e&&(typeof Symbol<`u`&&e[Symbol.iterator]||e[`@@iterator`]);if(n!=null){var r=[],i=!0,a=!1,o,s;try{for(n=n.call(e);!(i=(o=n.next()).done)&&(r.push(o.value),!(t&&r.length===t));i=!0);}catch(e){a=!0,s=e}finally{try{!i&&n.return!=null&&n.return()}finally{if(a)throw s}}return r}}function I(e,t){if(e){if(typeof e==`string`)return oe(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n===`Object`&&e.constructor&&(n=e.constructor.name),n===`Map`||n===`Set`)return Array.from(e);if(n===`Arguments`||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return oe(e,t)}}function oe(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function se(){throw TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var L=function(e,t,n){var r=!!n,i=l.useRef(n);l.useEffect(function(){i.current=n},[n]),l.useEffect(function(){if(!r||!e)return function(){};var n=function(){i.current&&i.current.apply(i,arguments)};return e.on(t,n),function(){e.off(t,n)}},[r,t,e,i])},R=function(e){var t=l.useRef(e);return l.useEffect(function(){t.current=e},[e]),t.current},z=function(e){return e!==null&&M(e)===`object`},B=function(e){return z(e)&&typeof e.then==`function`},ce=function(e){return z(e)&&typeof e.elements==`function`&&typeof e.createToken==`function`&&typeof e.createPaymentMethod==`function`&&typeof e.confirmCardPayment==`function`},le=`[object Object]`,ue=function e(t,n){if(!z(t)||!z(n))return t===n;var r=Array.isArray(t);if(r!==Array.isArray(n))return!1;var i=Object.prototype.toString.call(t)===le;if(i!==(Object.prototype.toString.call(n)===le))return!1;if(!i&&!r)return t===n;var a=Object.keys(t),o=Object.keys(n);if(a.length!==o.length)return!1;for(var s={},c=0;c<a.length;c+=1)s[a[c]]=!0;for(var l=0;l<o.length;l+=1)s[o[l]]=!0;var u=Object.keys(s);if(u.length!==a.length)return!1;var d=t,f=n;return u.every(function(t){return e(d[t],f[t])})},de=function(e,t,n){return z(e)?Object.keys(e).reduce(function(r,i){var a=!z(t)||!ue(e[i],t[i]);return n.includes(i)?(a&&console.warn(`Unsupported prop change: options.${i} is not a mutable property.`),r):a?j(j({},r||{}),{},N({},i,e[i])):r},null):null},V="Invalid prop `stripe` supplied to `Elements`. We recommend using the `loadStripe` utility from `@stripe/stripe-js`. See https://stripe.com/docs/stripe-js/react#elements-props-stripe for details.",H=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:V;if(e===null||ce(e))return e;throw Error(t)},U=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:V;if(B(e))return{tag:`async`,stripePromise:Promise.resolve(e).then(function(e){return H(e,t)})};var n=H(e,t);return n===null?{tag:`empty`}:{tag:`sync`,stripe:n}},fe=function(e){!e||!e._registerWrapper||!e.registerAppInfo||(e._registerWrapper({name:`react-stripe-js`,version:`5.4.1`}),e.registerAppInfo({name:`react-stripe-js`,version:`5.4.1`,url:`https://stripe.com/docs/stripe-js/react`}))},pe=l.createContext(null);pe.displayName=`ElementsContext`;var W=function(e,t){if(!e)throw Error(`Could not find Elements context; You need to wrap the part of your app that ${t} in an <Elements> provider.`);return e},me=function(e){var t=e.stripe,n=e.options,r=e.children,i=l.useMemo(function(){return U(t)},[t]),a=P(l.useState(function(){return{stripe:i.tag===`sync`?i.stripe:null,elements:i.tag===`sync`?i.stripe.elements(n):null}}),2),o=a[0],s=a[1];l.useEffect(function(){var e=!0,t=function(e){s(function(t){return t.stripe?t:{stripe:e,elements:e.elements(n)}})};return i.tag===`async`&&!o.stripe?i.stripePromise.then(function(n){n&&e&&t(n)}):i.tag===`sync`&&!o.stripe&&t(i.stripe),function(){e=!1}},[i,o,n]);var c=R(t);l.useEffect(function(){c!==null&&c!==t&&console.warn("Unsupported prop change on Elements: You cannot change the `stripe` prop after setting it.")},[c,t]);var u=R(n);return l.useEffect(function(){if(o.elements){var e=de(n,u,[`clientSecret`,`fonts`]);e&&o.elements.update(e)}},[n,u,o.elements]),l.useEffect(function(){fe(o.stripe)},[o.stripe]),l.createElement(pe.Provider,{value:o},r)};me.propTypes={stripe:k.default.any,options:k.default.object};var he=function(e){return W(l.useContext(pe),e)},ge=function(){return he(`calls useElements()`).elements},G=function(e){var t=e.children;return t(he(`mounts <ElementsConsumer>`))};G.propTypes={children:k.default.func.isRequired};var K=l.createContext(null);K.displayName=`CheckoutContext`,k.default.any,k.default.shape({clientSecret:k.default.oneOfType([k.default.string,k.default.instanceOf(Promise)]).isRequired,elementsOptions:k.default.object}).isRequired;var q=function(e){var t=l.useContext(K),n=l.useContext(pe);if(t){if(n)throw Error(`You cannot wrap the part of your app that ${e} in both <CheckoutProvider> and <Elements> providers.`);return t}else return W(n,e)},_e=[`mode`],J=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},Y=function(e,t){var n=`${J(e)}Element`,r=t?function(e){q(`mounts <${n}>`);var t=e.id,r=e.className;return l.createElement(`div`,{id:t,className:r})}:function(t){var r=t.id,i=t.className,a=t.options,o=a===void 0?{}:a,s=t.onBlur,c=t.onFocus,u=t.onReady,d=t.onChange,f=t.onEscape,p=t.onClick,ee=t.onLoadError,m=t.onLoaderStart,h=t.onNetworksChange,g=t.onConfirm,_=t.onCancel,v=t.onShippingAddressChange,te=t.onShippingRateChange,y=t.onSavedPaymentMethodRemove,b=t.onSavedPaymentMethodUpdate,x=q(`mounts <${n}>`),S=`elements`in x?x.elements:null,C=`checkoutState`in x?x.checkoutState:null,w=C?.type===`success`||C?.type===`loading`?C.sdk:null,T=P(l.useState(null),2),E=T[0],D=T[1],O=l.useRef(null),ne=l.useRef(null);L(E,`blur`,s),L(E,`focus`,c),L(E,`escape`,f),L(E,`click`,p),L(E,`loaderror`,ee),L(E,`loaderstart`,m),L(E,`networkschange`,h),L(E,`confirm`,g),L(E,`cancel`,_),L(E,`shippingaddresschange`,v),L(E,`shippingratechange`,te),L(E,`savedpaymentmethodremove`,y),L(E,`savedpaymentmethodupdate`,b),L(E,`change`,d);var k;u&&(k=e===`expressCheckout`?u:function(){u(E)}),L(E,`ready`,k),l.useLayoutEffect(function(){if(O.current===null&&ne.current!==null&&(S||w)){var t=null;if(w)switch(e){case`paymentForm`:t=w.createPaymentFormElement();break;case`payment`:t=w.createPaymentElement(o);break;case`address`:if(`mode`in o){var r=o.mode,i=ie(o,_e);if(r===`shipping`)t=w.createShippingAddressElement(i);else if(r===`billing`)t=w.createBillingAddressElement(i);else throw Error(`Invalid options.mode. mode must be 'billing' or 'shipping'.`)}else throw Error(`You must supply options.mode. mode must be 'billing' or 'shipping'.`);break;case`expressCheckout`:t=w.createExpressCheckoutElement(o);break;case`currencySelector`:t=w.createCurrencySelectorElement();break;case`taxId`:t=w.createTaxIdElement(o);break;default:throw Error(`Invalid Element type ${n}. You must use either the <PaymentElement />, <AddressElement options={{mode: 'shipping'}} />, <AddressElement options={{mode: 'billing'}} />, or <ExpressCheckoutElement />.`)}else S&&(t=S.create(e,o));O.current=t,D(t),t&&t.mount(ne.current)}},[S,w,o]);var A=R(o);return l.useEffect(function(){if(O.current){var e=de(o,A,[`paymentRequest`]);e&&`update`in O.current&&O.current.update(e)}},[o,A]),l.useLayoutEffect(function(){return function(){if(O.current&&typeof O.current.destroy==`function`)try{O.current.destroy(),O.current=null}catch{}}},[]),l.createElement(`div`,{id:r,className:i,ref:ne})};return r.propTypes={id:k.default.string,className:k.default.string,onChange:k.default.func,onBlur:k.default.func,onFocus:k.default.func,onReady:k.default.func,onEscape:k.default.func,onClick:k.default.func,onLoadError:k.default.func,onLoaderStart:k.default.func,onNetworksChange:k.default.func,onConfirm:k.default.func,onCancel:k.default.func,onShippingAddressChange:k.default.func,onShippingRateChange:k.default.func,onSavedPaymentMethodRemove:k.default.func,onSavedPaymentMethodUpdate:k.default.func,options:k.default.object},r.displayName=n,r.__elementType=e,r},X=typeof window>`u`,ve=l.createContext(null);ve.displayName=`EmbeddedCheckoutProviderContext`;var ye=function(){return q(`calls useStripe()`).stripe};Y(`auBankAccount`,X),Y(`card`,X),Y(`cardNumber`,X),Y(`cardExpiry`,X),Y(`cardCvc`,X),Y(`iban`,X);var be=Y(`payment`,X);Y(`expressCheckout`,X),Y(`paymentRequestButton`,X),Y(`linkAuthentication`,X),Y(`address`,X),Y(`shippingAddress`,X),Y(`paymentMethodMessaging`,X),Y(`taxId`,X);var Z=t(a(),1),xe=o,Q=e=>globalThis[e],Se=()=>{let e=Q(`kaiPulseNowBridge`)??Q(`kaiPulseNow`);if(typeof e==`function`)return e();let t=i();return Number(t)/Number(r)},$=(e,t,n)=>Math.max(t,Math.min(n,e)),Ce=e=>Math.round(e*100)/100,we=e=>e.toLocaleString(`en-US`,{style:`currency`,currency:`USD`,minimumFractionDigits:2,maximumFractionDigits:2}),Te=(e,t)=>{let n=(1+Math.sqrt(5))/2,r=Math.sin(2*Math.PI*e/44)*.85,i=Math.sin(2*Math.PI*n*e)*.42,a=Math.sin(2*Math.PI*(n-1)*e)*.28,o=Math.sin(e*.1618)*.35;return Ce(t+r+i+a+o)},Ee=e=>$(.35+.65*Math.abs(Math.sin(2*Math.PI*e/11)),0,1),De=Object.freeze([]),Oe=Object.freeze([]),ke=`
.kai-price-wrap { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Apple Color Emoji","Segoe UI Emoji"; color: #e7fbf7; }
.kai-price-chart { display:block; width:100%; height:auto; }
.kpc-title { fill:#a2bbb6; font-size:12px; font-weight:600; letter-spacing:0.4px; }
.kpc-gridline { stroke:#ffffff22; stroke-width:1; shape-rendering:crispEdges; }
.kpc-band { stroke:#81fff133; stroke-width:1; stroke-dasharray:4 4; }
.kpc-line { fill:none; stroke:#37e6d4; stroke-width:2.25; }
.kpc-area { opacity:1; }
.kpc-axes .kpc-axis-text { fill:#a2bbb6; font-size:11px; dominant-baseline:middle; }
.kpc-dot { fill:#37e6d4; stroke:#0a0f12; stroke-width:2; }
.kpc-badge { fill:#0a0f12cc; stroke:#ffffff22; stroke-width:1; }
.kpc-badge-text { fill:#e7fbf7; font-size:11px; font-weight:600; }
.kpc-xhair-line { stroke:#ffffff33; stroke-width:1; shape-rendering:crispEdges; }
.kpc-tip { fill:#0a0f12f2; stroke:#ffffff22; }
.kpc-tip-text { fill:#e7fbf7; font-size:11px; font-weight:600; }
.kpc-header text { user-select:none; }
.kpc-ticker { display:flex; align-items:center; gap:10px; margin-bottom:6px; font-size:12px; color:#a2bbb6; }
.kpc-live-dot { width:8px; height:8px; border-radius:9999px; background:#28c76f; box-shadow:0 0 0 6px #28c76f22; }
.kpc-live { font-weight:700; letter-spacing:0.08em; color:#a2bbb6; }
.kpc-last { font-weight:700; color:#e7fbf7; }
.kpc-last.up { color:#c1ffe9; }
.kpc-last.down { color:#ffd1d1; }
.kpc-delta.up { color:#28c76f; }
.kpc-delta.down { color:#ff4d4f; }
.kpc-pulse { color:#a2bbb6; }
.kpc-empty { display:flex; align-items:center; justify-content:center; color:#a2bbb6; height:100%; font-size:12px; }
`,Ae={l:64,r:20,t:28,b:36},je=(e,t,n,r)=>{let i=Math.floor(t),a=Math.floor(n),o=Math.max(String(i).length,String(a).length,1)*7+18,s=$(Math.ceil(o+14),56,140),c=Math.max(1,Math.floor(e/s));return $(Math.min(r,c),1,Math.max(1,r))},Me=({points:e,width:t=720,height:n=280,title:r=`Φ Value — Live (☤Kai)`,className:i,style:a,formatter:o=we,gridXTicks:s=6,gridYTicks:c=4,bandLevels:u=[.236,.382,.5,.618],showVWAP:d=!0,autoWidth:f=!1,includeStyles:p=!0,onHoverPoint:ee,live:m=!0,windowPoints:h=240,priceFn:g,volFn:_,tickAlignToPulse:v=!0,tickMs:te=xe,fetchSigilMeta:y,buildExchangeSeries:b,issuancePolicy:x,onTick:S})=>{let C=Ae,w=l.useRef(null),[T,E]=l.useState(t),D=l.useRef(y??Q(`fetchSigilMeta`)),O=l.useRef(b??Q(`buildExchangeSeries`)),ne=l.useRef(x??Q(`DEFAULT_ISSUANCE_POLICY`));l.useEffect(()=>{D.current=y??Q(`fetchSigilMeta`)},[y]),l.useEffect(()=>{O.current=b??Q(`buildExchangeSeries`)},[b]),l.useEffect(()=>{ne.current=x??Q(`DEFAULT_ISSUANCE_POLICY`)},[x]);let[k,A]=l.useState([]),j=l.useRef(null),M=l.useRef(null),[N,re]=l.useState(null);l.useLayoutEffect(()=>{if(!w.current)return;let e=w.current,n=()=>{let n=Math.floor(e.getBoundingClientRect().width||t);n>0&&E(n)};if(n(),typeof ResizeObserver>`u`)return;let r=new ResizeObserver(()=>n());return r.observe(e),()=>r.disconnect()},[t]),l.useEffect(()=>{let e=!0,t=D.current;return t&&t().then(t=>{e&&re(t)}).catch(()=>{}),()=>{e=!1}},[]);let ie=l.useCallback((e,t)=>{if(g)return{price:Ce(Math.max(1e-4,g(e))),vol:_?$(_(e),0,1):Ee(e)};let n=O.current,r=ne.current;if(N&&typeof n==`function`&&r)try{let t=Math.max(0,e-11),i=n({meta:N,usdSample:100},r,t,e,11),a=i?.[i.length-1];if(a&&typeof a.usdPerPhi==`number`){let e=a.choirActive||a.festivalActive?.5:.25;return{price:Ce(Math.max(1e-4,a.usdPerPhi)),vol:e}}}catch{}let i=t??1.618,a=Math.max(1e-4,Te(e,i)),o=Ee(e);return{price:Ce(a),vol:o}},[N,g,_]);l.useEffect(()=>{if(!m)return;let t=Se(),n=Math.floor(t),r=n-(Math.max(2,h)-1),i=e??De,a=[],o=i.length>0?i[i.length-1].price:null;for(let e=r;e<=n;e++){let{price:t,vol:n}=ie(e,o);a.push({p:e,price:t,vol:n}),o=t}if(A(a),j.current=n,M.current=a.length>0?a[a.length-1].price:null,S&&a.length>0){let e=a[a.length-1];S({p:e.p,price:e.price})}},[m,h,ie,N,S,e]),l.useEffect(()=>{if(!m)return;let e,t=()=>{let e=Se(),t=Math.floor(e);if(j.current==null||t>j.current){let e=M.current,n=ie(t,e);A(e=>{let r=[...e,{p:t,price:n.price,vol:n.vol}];return r.length>h?r.slice(r.length-h):r}),j.current=t,M.current=n.price,S&&S({p:t,price:n.price})}n()},n=()=>{if(v){let n=Se(),r=n-Math.floor(n),i=Math.max(1,(1-r)*xe);e=window.setTimeout(t,i+2)}else e=window.setTimeout(t,te)};return n(),()=>{e&&window.clearTimeout(e)}},[m,h,ie,v,te,S]);let P=l.useMemo(()=>m?k:e??De,[m,k,e]),ae=f?T:t,F=Math.max(10,ae-C.l-C.r),I=Math.max(10,n-C.t-C.b),oe=Math.max(10,T||t),se=Math.max(10,oe-C.l-C.r),{minX:L,maxX:R,minY:z,maxY:B,vwap:ce}=l.useMemo(()=>{if(P.length===0)return{minX:0,maxX:1,minY:1,maxY:2,vwap:0};let e=P.map(e=>e.p),t=P.map(e=>e.price),n=P.map(e=>e.vol??0),r=Math.min(...e),i=Math.max(...e),a=Math.min(...t),o=Math.max(...t),s=n.reduce((e,t)=>e+t,0)||1,c=P.reduce((e,t)=>e+t.price*(t.vol??0),0)/s,l=(o-a)*.12||.5;return{minX:r,maxX:i,minY:Math.max(0,a-l),maxY:o+l,vwap:c}},[P]),le=l.useMemo(()=>je(se,L,R,Math.max(1,s)),[se,L,R,s]),ue=l.useCallback(e=>R===L?0:(e-L)/(R-L),[L,R]),de=l.useCallback(e=>B===z?1:1-(e-z)/(B-z),[z,B]),V=l.useCallback(e=>ue(e)*F+C.l,[ue,F,C.l]),H=l.useCallback(e=>de(e)*I+C.t,[de,I,C.t]),U=l.useMemo(()=>P.map(e=>({x:V(e.p),y:H(e.price)})),[P,V,H]),fe=l.useMemo(()=>{if(U.length<2)return``;let e=(e,t,n,r)=>{let i=.5;return{c1x:t.x+(n.x-e.x)*i/6,c1y:t.y+(n.y-e.y)*i/6,c2x:n.x-(r.x-t.x)*i/6,c2y:n.y-(r.y-t.y)*i/6}},t=`M${U[0].x.toFixed(2)} ${U[0].y.toFixed(2)}`;for(let n=0;n<U.length-1;n++){let r=U[n-1]||U[n],i=U[n],a=U[n+1],{c1x:o,c1y:s,c2x:c,c2y:l}=e(r,i,a,U[n+2]||a);t+=` C${o.toFixed(2)} ${s.toFixed(2)}, ${c.toFixed(2)} ${l.toFixed(2)}, ${a.x.toFixed(2)} ${a.y.toFixed(2)}`}return t},[U]),pe=l.useMemo(()=>{if(!fe||U.length===0)return``;let e=C.t+I,t=U[U.length-1],n=U[0];return`${fe} L${t.x.toFixed(2)} ${e.toFixed(2)} L${n.x.toFixed(2)} ${e.toFixed(2)} Z`},[fe,U,I,C.t]),[W,me]=l.useState(null),he=e=>{let t=e.currentTarget.getBoundingClientRect(),n=L+($(e.clientX-t.left,C.l,C.l+F)-C.l)/F*(R-L);if(P.length===0){me(null),ee?.(null);return}let r=P[0],i=Math.abs(r.p-n);for(let e of P){let t=Math.abs(e.p-n);t<i&&(i=t,r=e)}me({x:V(r.p),y:H(r.price),p:r.p,price:r.price}),ee?.({p:r.p,price:r.price})},ge=()=>{me(null),ee?.(null)},G=P.length>0?P[P.length-1]:void 0,K=P.length>1?P[P.length-2]:void 0,q=G&&K?Ce(G.price-K.price):0,_e=G&&K&&K.price!==0?q/K.price*100:0,J=l.useMemo(()=>{if(!W)return null;let e=C.l,t=C.l+F,n=C.t,r=C.t+I,i=W.x+10;i+184>t&&(i=W.x-10-184);let a=e+6,o=Math.max(a,t-184-6);i=$(i,a,o);let s=W.y-22;s<n+6&&(s=W.y+10);let c=n+6,l=Math.max(c,r-36-6);return s=$(s,c,l),{x:i,y:s,w:184,h:36,textX:i+8,textY:s+20}},[W,F,I,C.l,C.t]);return(0,Z.jsxs)(`div`,{ref:w,className:`kai-price-wrap ${i??``}`,style:a,children:[p&&(0,Z.jsx)(`style`,{dangerouslySetInnerHTML:{__html:ke}}),(0,Z.jsxs)(`div`,{className:`kpc-ticker`,"aria-live":`polite`,children:[(0,Z.jsx)(`div`,{className:`kpc-live-dot`,"aria-hidden":!0}),(0,Z.jsx)(`div`,{className:`kpc-live`,children:`LIVE`}),(0,Z.jsx)(`div`,{className:`kpc-last ${q>=0?`up`:`down`}`,children:G?o(G.price):`—`}),(0,Z.jsxs)(`div`,{className:`kpc-delta ${q>=0?`up`:`down`}`,children:[q>=0?`▲`:`▼`,` `,o(Math.abs(q)),` (`,_e>=0?`+`:``,_e.toFixed(2),`%)`]}),G&&(0,Z.jsxs)(`div`,{className:`kpc-pulse`,children:[`☤KAI `,Math.floor(G.p)]})]}),(0,Z.jsxs)(`svg`,{width:f?T:t,height:n,className:`kai-price-chart`,onMouseMove:he,onMouseLeave:ge,role:`img`,"aria-label":`Live Φ value in fiat over ☤KAI Pulses`,children:[(0,Z.jsxs)(`defs`,{children:[(0,Z.jsxs)(`filter`,{id:`kpc-glow`,x:`-50%`,y:`-50%`,width:`200%`,height:`200%`,children:[(0,Z.jsx)(`feGaussianBlur`,{stdDeviation:`4`,result:`coloredBlur`}),(0,Z.jsxs)(`feMerge`,{children:[(0,Z.jsx)(`feMergeNode`,{in:`coloredBlur`}),(0,Z.jsx)(`feMergeNode`,{in:`SourceGraphic`})]})]}),(0,Z.jsxs)(`linearGradient`,{id:`kpc-fill`,x1:`0`,y1:`0`,x2:`0`,y2:`1`,children:[(0,Z.jsx)(`stop`,{offset:`0%`,stopColor:`rgba(55,255,228,0.28)`}),(0,Z.jsx)(`stop`,{offset:`100%`,stopColor:`rgba(55,255,228,0.00)`})]}),(0,Z.jsxs)(`linearGradient`,{id:`kpc-band`,x1:`0`,y1:`0`,x2:`0`,y2:`1`,children:[(0,Z.jsx)(`stop`,{offset:`0%`,stopColor:`rgba(167,139,250,0.12)`}),(0,Z.jsx)(`stop`,{offset:`100%`,stopColor:`rgba(55,255,228,0.12)`})]})]}),(0,Z.jsx)(`g`,{className:`kpc-header`,children:(0,Z.jsx)(`text`,{x:C.l,y:C.t-8,className:`kpc-title`,children:r})}),P.length===0?(0,Z.jsx)(`g`,{className:`kpc-empty`,children:(0,Z.jsx)(`text`,{x:C.l+Math.max(10,(f?T:t)-C.l-C.r)/2,y:C.t+Math.max(10,n-C.t-C.b)/2,textAnchor:`middle`,alignmentBaseline:`middle`,className:`kpc-axis-text`,children:`Waiting for Φ ticks…`})}):(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsxs)(`g`,{className:`kpc-grid`,children:[Array.from({length:le+1}).map((e,t)=>{let n=V(L+t*(R-L)/Math.max(1,le));return(0,Z.jsx)(`line`,{x1:n,x2:n,y1:C.t,y2:C.t+I,className:`kpc-gridline`},`x-${t}`)}),Array.from({length:Math.max(1,c)+1}).map((e,t)=>{let n=H(z+t*(B-z)/Math.max(1,c));return(0,Z.jsx)(`line`,{x1:C.l,x2:C.l+F,y1:n,y2:n,className:`kpc-gridline`},`y-${t}`)})]}),(0,Z.jsx)(`g`,{className:`kpc-bands`,children:(u?.length?u:Oe).map((e,t)=>{let n=H(z+e*(B-z));return(0,Z.jsx)(`line`,{x1:C.l,x2:C.l+F,y1:n,y2:n,className:`kpc-band`},`fb-${t}`)})}),d&&P.length>=3&&(0,Z.jsx)(`g`,{className:`kpc-vwap`,children:(0,Z.jsx)(`rect`,{x:C.l,width:F,y:H(ce*1.015),height:Math.max(2,Math.abs(H(ce*.985)-H(ce*1.015))),fill:`url(#kpc-band)`,rx:`3`})}),pe&&(0,Z.jsx)(`path`,{d:pe,fill:`url(#kpc-fill)`,className:`kpc-area`}),fe&&(0,Z.jsx)(`path`,{d:fe,className:`kpc-line`,filter:`url(#kpc-glow)`}),(0,Z.jsxs)(`g`,{className:`kpc-axes`,children:[Array.from({length:le+1}).map((e,t)=>{let n=L+t*(R-L)/Math.max(1,le);return(0,Z.jsx)(`text`,{x:V(n),y:C.t+I+22,textAnchor:`middle`,className:`kpc-axis-text`,children:Math.floor(n)},`xl-${t}`)}),(0,Z.jsx)(`text`,{x:C.l,y:C.t+I+36,textAnchor:`start`,className:`kpc-axis-text`,children:`☤KAI`}),Array.from({length:Math.max(1,c)+1}).map((e,t)=>{let n=z+t*(B-z)/Math.max(1,c),r=H(n);return(0,Z.jsx)(`text`,{x:C.l-10,y:r+4,textAnchor:`end`,className:`kpc-axis-text`,children:o(n)},`yl-${t}`)})]}),G&&(0,Z.jsxs)(`g`,{className:`kpc-last-tag`,children:[(0,Z.jsx)(`circle`,{cx:V(G.p),cy:H(G.price),r:`4.5`,className:`kpc-dot`}),(0,Z.jsx)(`rect`,{x:C.l+F-158,y:H(G.price)-12,width:`150`,height:`24`,rx:`12`,className:`kpc-badge`}),(0,Z.jsxs)(`text`,{x:C.l+F-150,y:H(G.price)+5,className:`kpc-badge-text`,children:[o(G.price),` `,q>=0?`▲`:`▼`,` `,Math.abs(_e).toFixed(2),`%`]})]}),W&&J&&(0,Z.jsxs)(`g`,{className:`kpc-xhair`,children:[(0,Z.jsx)(`line`,{x1:W.x,x2:W.x,y1:C.t,y2:C.t+I,className:`kpc-xhair-line`}),(0,Z.jsx)(`line`,{x1:C.l,x2:C.l+F,y1:W.y,y2:W.y,className:`kpc-xhair-line`}),(0,Z.jsx)(`rect`,{x:J.x,y:J.y,width:J.w,height:J.h,rx:`8`,ry:`8`,className:`kpc-tip`}),(0,Z.jsxs)(`text`,{x:J.textX,y:J.textY,className:`kpc-tip-text`,children:[`☤KAI `,Math.floor(W.p),` • `,o(W.price)]})]})]})]})]})},Ne=`https://pay.kaiklok.com`,Pe=`pk_live_51SNLMpRzKZKauLy5RLZFDy8FzHTt50YH1BRbXof1Db79yr1xchPQLzLF43pixjKLUbwKr2nc3WT6eq7TZZInfnhT00IMTw0M8N`,Fe=17491,Ie={ip:{expectedCashflowPhi:[]}},Le=[],Re=[144,233,987],ze={position:`fixed`,left:-1e4,top:-1e4,width:1,height:1,opacity:0,visibility:`hidden`,pointerEvents:`none`,overflow:`hidden`,clipPath:`inset(50%)`,contain:`layout paint size style`};function Be(e,t=15e3){let n=new AbortController,r=setTimeout(()=>n.abort(),t);return e(n.signal).finally(()=>clearTimeout(r))}async function Ve(e,t){return Be(async n=>{let r=await fetch(`${e}/api/payments/intent`,{method:`POST`,headers:{"Content-Type":`application/json`},credentials:`omit`,mode:`cors`,signal:n,body:JSON.stringify({amount:Math.max(1,Math.round(t)),currency:`usd`,description:`Kairos Sovereign Inhale`})});if(!r.ok){let e=await r.text().catch(()=>``)||`Failed to create payment intent (${r.status})`;throw Error(e)}return await r.json()})}function He(){return(0,Z.jsx)(`img`,{className:`hp-phi-icon`,src:`/phi.svg`,alt:`Φ`})}var Ue=()=>{let[e]=(0,l.useState)(Ie);return e},We=({amountUsd:e,intentId:t,onClose:n,onSuccess:r})=>{let i=ye(),a=ge(),[o,s]=(0,l.useState)(!1),[c,u]=(0,l.useState)(``),d=(0,l.useCallback)(async()=>{if(!(!i||!a||o)){s(!0),u(``);try{let{error:e,paymentIntent:t}=await i.confirmPayment({elements:a,redirect:`if_required`,confirmParams:{return_url:typeof window<`u`?window.location.href:void 0}});if(e){u(e.message||`Payment confirmation failed.`);return}if(t?.status===`succeeded`){r?.();return}u(`Payment is not complete yet. Please try again.`)}catch(e){u(e instanceof Error?e.message:`Unable to confirm payment.`)}finally{s(!1)}}},[i,a,o,r]);return(0,Z.jsxs)(`div`,{className:`hp-popover`,role:`dialog`,"aria-label":`Inline sovereign checkout`,"data-intent-id":t,children:[(0,Z.jsxs)(`div`,{className:`hp-pop-head`,children:[(0,Z.jsxs)(`div`,{className:`hp-pop-title`,children:[`Seal `,` `,e.toLocaleString(void 0,{style:`currency`,currency:`USD`}),`: To ΦKey`]}),(0,Z.jsx)(`button`,{type:`button`,className:`hp-x`,onClick:n,"aria-label":`Close checkout`,children:`×`})]}),(0,Z.jsxs)(`div`,{className:`hp-pop-body`,children:[(0,Z.jsx)(`div`,{className:`hp-payment`,"aria-busy":!a,children:(0,Z.jsx)(be,{})}),(0,Z.jsxs)(`div`,{className:`hp-actions`,children:[(0,Z.jsx)(`button`,{type:`button`,className:`hp-primary`,onClick:d,disabled:o||!i||!a,children:o?`Confirming…`:`Mint Premium ΦKey `}),(0,Z.jsx)(`button`,{type:`button`,className:`hp-secondary`,onClick:n,children:`Cancel`})]}),c&&(0,Z.jsx)(`div`,{className:`hp-error`,children:c}),(0,Z.jsx)(`p`,{className:`hp-fine`,children:`3-D Secure via Stripe (PCI). No securities. No fiat ROI.`})]})]})};function Ge({ctaAmountUsd:e=250,apiBase:t=Ne,title:r=`Value Index`,chartHeight:i=120,onError:a,stripePk:o=Pe,onExpandChange:c}){let u=Ue(),[d,f]=(0,l.useState)(e),[p,ee]=(0,l.useState)(!1),m=(0,l.useRef)(c);(0,l.useEffect)(()=>{m.current=c},[c]),(0,l.useEffect)(()=>{m.current?.(!1)},[]);let h=(0,l.useMemo)(()=>ne(o),[o]),[g,_]=(0,l.useState)(null),[v,te]=(0,l.useState)(null),[y,b]=(0,l.useState)(0),[x,S]=(0,l.useState)(!1),[C,w]=(0,l.useState)(``),T=(0,l.useCallback)(e=>{let t=Math.max(1,Math.round(Number.isFinite(d)?d:1)),r=n({meta:u,nowPulse:Math.floor(e),usd:t,currentStreakDays:0,lifetimeUsdSoFar:0,plannedHoldBeats:0},s);return r.phiPerUsd>0?1/r.phiPerUsd:0},[u,d]),E=(0,l.useCallback)(e=>T(e),[T]),[D,O]=(0,l.useState)(null),k=(0,l.useCallback)(({p:e,price:t})=>{O({pulse:e,price:t})},[]),A=(0,l.useMemo)(()=>{if(!D)return null;let e=T(D.pulse-Fe);return e>0?(D.price-e)/e*100:0},[D,T]),j=!!(D&&Number.isFinite(D.price)&&D.price>0),M=j?`$${D.price.toFixed(2)} / Φ`:`—`,N=j?(0,Z.jsxs)(`span`,{className:`hp-price-row`,"aria-label":M,children:[(0,Z.jsx)(`span`,{className:`hp-price-usd`,children:`$${D.price.toFixed(2)}`}),(0,Z.jsxs)(`span`,{className:`hp-price-slash`,"aria-hidden":!0,children:[` `,`/`,` `]}),(0,Z.jsx)(He,{})]}):`—`,re=(()=>A==null||!Number.isFinite(A)?`0.00%`:`${A>=0?`+`:`−`}${Math.abs(A).toFixed(2)}%`)(),ie=A!=null&&A>=0?`hp-up`:`hp-down`,P=(0,l.useCallback)(async()=>{w(``);try{let{clientSecret:n,intentId:r}=await Ve(t,Number.isFinite(d)?Math.max(1,Math.round(d)):e);_(n),te(r),b(e=>e+1),S(!1)}catch(e){w(e instanceof Error?e.message:`Unable to start checkout.`),a?.(e)}},[d,e,t,a]),ae=(0,l.useCallback)(()=>{_(null),te(null),b(e=>e+1)},[]),F=(0,l.useCallback)(()=>{S(!0);try{let t={amount:Number.isFinite(d)?Math.max(1,Math.round(d)):e,method:`card`};typeof window<`u`&&window.dispatchEvent(new CustomEvent(`investor:contribution`,{detail:t}))}catch(e){a?.(e)}ae()},[d,e,a,ae]),I=(0,l.useId)(),oe=(0,l.useCallback)(()=>{ee(e=>{let t=!e;return m.current?.(t),t})},[]);return(0,Z.jsxs)(`div`,{className:`hp-card ${p?`is-expanded`:`is-collapsed`}`,role:`group`,"aria-label":`Sovereign asset`,children:[(0,Z.jsxs)(`div`,{className:`hp-ticker`,role:`button`,tabIndex:0,"aria-expanded":p,"aria-controls":I,onClick:oe,onKeyDown:e=>{(e.key===`Enter`||e.key===` `)&&(e.preventDefault(),oe())},children:[(0,Z.jsx)(`div`,{className:`hp-left`,children:(0,Z.jsx)(`span`,{className:`hp-title`,"aria-label":r,children:(0,Z.jsx)(`span`,{className:`hp-titleText`,children:r})})}),(0,Z.jsxs)(`div`,{className:`hp-right`,children:[(0,Z.jsx)(`span`,{className:`hp-price`,"aria-live":`polite`,"aria-label":M,children:N}),(0,Z.jsxs)(`span`,{className:`hp-pct ${ie}`,"aria-live":`polite`,children:[A!=null&&A>=0?`▲`:`▼`,` `,re]})]})]}),(0,Z.jsx)(`div`,{className:`hp-chart-wrap`,"aria-hidden":!p,style:p?{marginTop:8}:ze,children:(0,Z.jsx)(`div`,{className:`hp-chart`,children:(0,Z.jsx)(Me,{points:Le,autoWidth:!0,height:i,title:void 0,priceFn:E,onTick:k,live:!0})})}),(0,Z.jsxs)(`div`,{id:I,className:`hp-expand ${p?`is-open`:`is-closed`}`,role:`region`,"aria-label":`Live chart and inhale controls`,style:p?{}:{height:0,overflow:`hidden`,visibility:`hidden`,pointerEvents:`none`},children:[(0,Z.jsxs)(`div`,{className:`hp-controls`,children:[(0,Z.jsxs)(`div`,{className:`hp-chips`,children:[(0,Z.jsx)(`span`,{className:`dim`,children:`Exhale:`}),Re.map(e=>(0,Z.jsxs)(`button`,{type:`button`,className:`chip ${e===d?`active`:``}`,onClick:t=>{t.stopPropagation(),f(e)},"aria-label":`Set sample to $${e}`,children:[`$`,e.toLocaleString()]},e)),(0,Z.jsx)(`button`,{type:`button`,className:`chip ghost`,"aria-label":`Increase sample by 5%`,onClick:e=>{e.stopPropagation(),f(e=>Math.max(1,Math.round(e*1.05)))},children:`+5%`})]}),(0,Z.jsx)(`div`,{className:`hp-actions-row`,children:(0,Z.jsx)(`button`,{type:`button`,className:`hp-primary`,onClick:e=>{e.stopPropagation(),P()},"aria-haspopup":`dialog`,children:`Premium ΦKey`})}),C&&(0,Z.jsx)(`div`,{className:`hp-error`,children:C})]}),g&&v&&(0,Z.jsx)(me,{stripe:h,options:{clientSecret:g,appearance:{theme:`night`,variables:{colorPrimary:`#37FFE4`,colorBackground:`rgba(8,14,16,.7)`,colorText:`#E8FBF8`,colorTextSecondary:`#AEE8DF`,colorIcon:`#E8FBF8`,borderRadius:`10px`},rules:{".Tab":{borderRadius:`10px`},".Input":{borderRadius:`10px`,backgroundColor:`rgba(255,255,255,0.06)`}}}},children:(0,Z.jsx)(We,{amountUsd:Number.isFinite(d)?Math.max(1,Math.round(d)):e,intentId:v,onClose:ae,onSuccess:F})},y),x&&(0,Z.jsxs)(`div`,{className:`hp-toast`,role:`status`,"aria-live":`polite`,children:[(0,Z.jsx)(`span`,{className:`hp-dot`,"aria-hidden":!0}),`Inhale sealed. Thank you, sovereign.`]})]})]})}export{Ge as default};